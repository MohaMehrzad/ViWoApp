<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViWO Protocol - Ultimate Economics Simulator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #191919;
            --secondary-color: #242424;
            --success-color: #10b91e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --module-identity: #8b5cf6;
            --module-content: #ec4899;
            --module-rewards: #f59e0b;
            --module-community: #10b981;
            --module-advertising: #3b82f6;
            --module-messaging: #06b6d4;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #e5e5e5;
            --gray-600: #525252;
            --gray-900: #171717;
            --text-primary: var(--gray-900);
            --text-secondary: var(--gray-600);
            --bg-primary: #ffffff;
            --bg-secondary: var(--gray-50);
            --bg-tertiary: var(--gray-100);
            --border-primary: var(--gray-200);
        }
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        body {
            background: var(--bg-secondary);
            min-height: 100vh;
            padding: 24px 0;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.6;
        }
        .main-container {
            background: var(--bg-primary);
            border-radius: 20px;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.05), 0 20px 25px -5px rgb(0 0 0 / 0.05);
            max-width: 1600px;
            margin: 0 auto;
            border: 1px solid var(--border-primary);
        }
        .header-section {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 24px 32px 20px 32px;
            border-radius: 20px 20px 0 0;
            position: relative;
            overflow: hidden;
        }
        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
        }
        .header-section h1 {
            font-weight: 800;
            font-size: 2rem;
            margin-bottom: 6px;
            letter-spacing: -0.025em;
            position: relative;
            z-index: 1;
        }
        .header-section .subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        .header-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }
        .header-stat {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }
        .header-stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 2px;
        }
        .header-stat-label {
            font-size: 0.7rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }
        .module-nav {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-primary);
            padding: 20px 40px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .module-nav-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .module-nav-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.2s;
        }
        .module-nav-link:hover {
            background: var(--bg-tertiary);
            transform: translateY(-1px);
        }
        .module-nav-link.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        .content-section {
            padding: 40px;
        }
        .module-section {
            margin-bottom: 60px;
            scroll-margin-top: 100px;
        }
        .module-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 2px solid var(--border-primary);
        }
        .module-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }
        .module-title h2 {
            font-size: 2rem;
            font-weight: 800;
            margin: 0;
            letter-spacing: -0.02em;
        }
        .module-title p {
            font-size: 1rem;
            color: var(--text-secondary);
            margin: 4px 0 0 0;
        }
        .card-custom {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            border: 1px solid var(--border-primary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .subsection {
            margin-bottom: 32px;
        }
        .subsection-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .table-custom {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 13px;
        }
        .table-custom thead th {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.05em;
            padding: 10px 12px;
            border-bottom: 2px solid var(--border-primary);
        }
        .table-custom tbody td {
            padding: 12px;
            border-bottom: 1px solid var(--border-primary);
            font-weight: 500;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .metric-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        .metric-box-value {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .metric-box-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .chart-container {
            position: relative;
            height: 350px;
            margin-bottom: 24px;
        }
        .alert-box {
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid;
            display: flex;
            gap: 12px;
            font-size: 14px;
        }
        .alert-info {
            background: #eff6ff;
            border-color: #bfdbfe;
            color: #1e40af;
        }
        .alert-success {
            background: #f0fdf4;
            border-color: #bbf7d0;
            color: #166534;
        }
        .alert-warning {
            background: #fffbeb;
            border-color: #fde68a;
            color: #92400e;
        }
        .feature-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .feature-list li {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: start;
            gap: 12px;
        }
        .feature-list li:last-child {
            border-bottom: none;
        }
        .feature-list li i {
            color: var(--success-color);
            margin-top: 2px;
        }
        .controls-section {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 20px 32px;
            border-bottom: 1px solid var(--border-primary);
        }
        .controls-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-group {
            margin-bottom: 14px;
        }
        .control-label {
            display: block;
            font-weight: 600;
            font-size: 12px;
            margin-bottom: 6px;
            color: white;
        }
        .control-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            background: rgba(255,255,255,0.95);
            transition: all 0.2s;
        }
        .control-input:focus {
            outline: none;
            border-color: white;
            background: white;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }
        .control-range {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.3);
            outline: none;
            -webkit-appearance: none;
        }
        .control-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .control-value {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 13px;
            margin-top: 8px;
        }
        .preset-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 16px;
        }
        .btn-preset {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            border: 2px solid white;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-preset:hover {
            background: white;
            color: var(--warning-color);
            transform: translateY(-2px);
        }
        .btn-export {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-export:hover {
            opacity: 0.85;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .recapture-visual {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .recapture-bar {
            height: 40px;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            margin-bottom: 20px;
        }
        .recapture-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 12px;
            transition: all 0.3s;
        }
        .recapture-segment:hover {
            filter: brightness(1.1);
        }
        @media (max-width: 768px) {
            .content-section { padding: 24px; }
            .metrics-grid { grid-template-columns: 1fr; }
            .preset-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container-fluid px-3">
        <div class="main-container">
            <div class="header-section">
                <h1><i class="fas fa-cube"></i> ViWO Protocol - Interactive Simulator</h1>
                <p class="subtitle">Economic Analysis - All Modules Profitable with Reward Recapture Tracking</p>
                <div class="header-stats">
                    <div class="header-stat">
                        <div class="header-stat-value" id="headerModules">6</div>
                        <div class="header-stat-label">Revenue Modules</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="headerRevenue">$0</div>
                        <div class="header-stat-label">M1 Total Revenue</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="headerProfit">$0</div>
                        <div class="header-stat-label">M1 Net Profit</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="headerMargin">0%</div>
                        <div class="header-stat-label">Profit Margin</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="headerRewards">194.4K</div>
                        <div class="header-stat-label">Daily Rewards (VIWO)</div>
                    </div>
                    <div class="header-stat">
                        <div class="header-stat-value" id="headerRecapture">0%</div>
                        <div class="header-stat-label">Reward Recapture</div>
                    </div>
                </div>
            </div>

            <div class="controls-section">
                <div class="controls-title">
                    <i class="fas fa-sliders-h"></i> Interactive Controls - Adjust & See Real-Time Updates
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-dollar-sign"></i> VIWO Token Price (USD)
                            </label>
                            <input type="number" class="control-input" id="tokenPrice"
                                   value="0.03" step="0.01" min="0.001" max="1.0"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-users"></i> Starting Users (Month 1)
                            </label>
                            <input type="number" class="control-input" id="startingUsers"
                                   value="1000" min="100" max="100000"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-chart-line"></i> Monthly Growth Rate
                            </label>
                            <input type="range" class="control-range" id="growthRate"
                                   value="7" min="1" max="20"
                                   oninput="updateSliderValue('growthRate'); recalculateAll()">
                            <div class="control-value" id="growthRateValue">7%</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-fire"></i> Burn Rate (% of Fees)
                            </label>
                            <input type="range" class="control-range" id="burnRate"
                                   value="20" min="10" max="50"
                                   oninput="updateSliderValue('burnRate'); recalculateAll()">
                            <div class="control-value" id="burnRateValue">20%</div>
                            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 4px;">
                                Actual: <span id="burnRateActual" style="color: #3b82f6; font-weight: 600;">20%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-percentage"></i> Verification Rate
                            </label>
                            <input type="range" class="control-range" id="verificationRate"
                                   value="25" min="10" max="50"
                                   oninput="updateSliderValue('verificationRate'); recalculateAll()">
                            <div class="control-value" id="verificationRateValue">25%</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-file-alt"></i> Posts per User/Month
                            </label>
                            <input type="range" class="control-range" id="postsPerUser"
                                   value="20" min="5" max="50"
                                   oninput="updateSliderValue('postsPerUser'); recalculateAll()">
                            <div class="control-value" id="postsPerUserValue">20</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-hand-holding-usd"></i> Buyback % of Profits
                            </label>
                            <input type="range" class="control-range" id="buybackPercent"
                                   value="25" min="0" max="50"
                                   oninput="updateSliderValue('buybackPercent'); recalculateAll()">
                            <div class="control-value" id="buybackPercentValue">25%</div>
                            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 4px;">
                                Actual: <span id="buybackPercentActual" style="color: #3b82f6; font-weight: 600;">25%</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-bullhorn"></i> Ad CPM Multiplier
                            </label>
                            <input type="range" class="control-range" id="adCPM"
                                   value="100" min="50" max="200"
                                   oninput="updateSliderValue('adCPM'); recalculateAll()">
                            <div class="control-value" id="adCPMValue">100%</div>
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-12">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-gift"></i> Daily Reward Pool Allocation (% of Daily Emission)
                            </label>
                            <input type="range" class="control-range" id="rewardAllocationPercent"
                                   value="90" min="10" max="90"
                                   oninput="updateSliderValue('rewardAllocationPercent'); recalculateAll()">
                            <div class="control-value" id="rewardAllocationPercentValue">90%</div>
                            <p style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 6px; margin-bottom: 0;">
                                How much of daily emission goes to user rewards. Higher % = more rewards for quality users. Recommended: 70-90% for sustainable growth and user incentives.
                            </p>
                        </div>
                    </div>
                </div>

                <hr style="border-color: rgba(255,255,255,0.3); margin: 30px 0;">

                <h5 style="color: white; font-weight: 700; margin-bottom: 20px;">
                    <i class="fas fa-user-circle"></i> Identity Module Pricing (USD)
                </h5>

                <div class="row">
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-star"></i> Basic Tier Price ($)
                            </label>
                            <input type="number" class="control-input" id="basicPrice"
                                   value="1" step="0.5" min="0.5" max="10"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-check-circle"></i> Verified Tier Price ($)
                            </label>
                            <input type="number" class="control-input" id="verifiedPrice"
                                   value="7" step="1" min="1" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-crown"></i> Premium Tier Price ($)
                            </label>
                            <input type="number" class="control-input" id="premiumPrice"
                                   value="19" step="1" min="5" max="100"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-building"></i> Enterprise Tier Price ($)
                            </label>
                            <input type="number" class="control-input" id="enterprisePrice"
                                   value="124" step="5" min="50" max="500"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-exchange-alt"></i> Profile Transfer Fee ($)
                            </label>
                            <input type="number" class="control-input" id="transferFee"
                                   value="3" step="0.5" min="0" max="20"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-percentage"></i> Profile Sale Commission (%)
                            </label>
                            <input type="range" class="control-range" id="saleCommission"
                                   value="5" min="0" max="15"
                                   oninput="updateSliderValue('saleCommission'); recalculateAll()">
                            <div class="control-value" id="saleCommissionValue">5%</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-shopping-cart"></i> Monthly Profile Sales (est.)
                            </label>
                            <input type="number" class="control-input" id="monthlySales"
                                   value="20" step="5" min="0" max="200"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <hr style="border-color: rgba(255,255,255,0.3); margin: 30px 0;">

                <h5 style="color: white; font-weight: 700; margin-bottom: 20px;">
                    <i class="fas fa-file-alt"></i> Content Module Pricing (USD)
                </h5>

                <div class="row">
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-align-left"></i> Text Post Fee ($)
                            </label>
                            <input type="number" class="control-input" id="textPostFee"
                                   value="0.05" step="0.01" min="0" max="1"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-image"></i> Image Post Fee ($)
                            </label>
                            <input type="number" class="control-input" id="imagePostFee"
                                   value="0.10" step="0.01" min="0" max="2"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-video"></i> Video Post Fee ($)
                            </label>
                            <input type="number" class="control-input" id="videoPostFee"
                                   value="0.25" step="0.05" min="0" max="5"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-gem"></i> NFT Minting Fee ($)
                            </label>
                            <input type="number" class="control-input" id="nftMintFee"
                                   value="2" step="0.5" min="0" max="20"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-crown"></i> Premium Content Subscription ($)
                            </label>
                            <input type="number" class="control-input" id="premiumContentSub"
                                   value="5" step="1" min="0" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-rocket"></i> Content Boost Fee ($)
                            </label>
                            <input type="number" class="control-input" id="contentBoostFee"
                                   value="1" step="0.25" min="0" max="10"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-percentage"></i> Content Sale Commission (%)
                            </label>
                            <input type="range" class="control-range" id="contentSaleCommission"
                                   value="10" min="0" max="20"
                                   oninput="updateSliderValue('contentSaleCommission'); recalculateAll()">
                            <div class="control-value" id="contentSaleCommissionValue">10%</div>
                        </div>
                    </div>
                </div>

                <hr style="border-color: rgba(255,255,255,0.3); margin: 30px 0;">

                <h5 style="color: white; font-weight: 700; margin-bottom: 20px;">
                    <i class="fas fa-users"></i> Community Module Pricing (USD)
                </h5>

                <div class="row">
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-user-friends"></i> Small Community ($)
                            </label>
                            <input type="number" class="control-input" id="smallCommunityFee"
                                   value="3" step="0.5" min="0" max="20"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-users"></i> Medium Community ($)
                            </label>
                            <input type="number" class="control-input" id="mediumCommunityFee"
                                   value="10" step="1" min="0" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-users-cog"></i> Large Community ($)
                            </label>
                            <input type="number" class="control-input" id="largeCommunityFee"
                                   value="25" step="5" min="0" max="100"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-building"></i> Enterprise Community ($)
                            </label>
                            <input type="number" class="control-input" id="enterpriseCommunityFee"
                                   value="100" step="10" min="0" max="500"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-calendar-alt"></i> Event Hosting Fee ($)
                            </label>
                            <input type="number" class="control-input" id="eventHostingFee"
                                   value="5" step="1" min="0" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-shield-alt"></i> Community Verification ($)
                            </label>
                            <input type="number" class="control-input" id="communityVerificationFee"
                                   value="20" step="5" min="0" max="100"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-chart-bar"></i> Analytics Access ($)
                            </label>
                            <input type="number" class="control-input" id="communityAnalyticsFee"
                                   value="15" step="5" min="0" max="100"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <hr style="border-color: rgba(255,255,255,0.3); margin: 30px 0;">

                <h5 style="color: white; font-weight: 700; margin-bottom: 20px;">
                    <i class="fas fa-bullhorn"></i> Advertising Module Pricing (USD)
                </h5>

                <div class="row">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-ad"></i> Banner Ad (per 1000 imp)
                            </label>
                            <input type="number" class="control-input" id="bannerCPM"
                                   value="15" step="1" min="1" max="100"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-video"></i> Video Ad (per 1000 imp)
                            </label>
                            <input type="number" class="control-input" id="videoCPM"
                                   value="40" step="5" min="5" max="200"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-thumbtack"></i> Promoted Post Fee ($)
                            </label>
                            <input type="number" class="control-input" id="promotedPostFee"
                                   value="3" step="0.5" min="0" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-briefcase"></i> Campaign Management Fee ($)
                            </label>
                            <input type="number" class="control-input" id="campaignManagementFee"
                                   value="50" step="10" min="0" max="500"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-chart-line"></i> Ad Analytics Dashboard ($)
                            </label>
                            <input type="number" class="control-input" id="adAnalyticsFee"
                                   value="30" step="5" min="0" max="200"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <hr style="border-color: rgba(255,255,255,0.3); margin: 30px 0;">

                <h5 style="color: white; font-weight: 700; margin-bottom: 20px;">
                    <i class="fas fa-gift"></i> Reward Distribution Parameters
                </h5>

                <div class="row">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-fire"></i> Text Post Points
                            </label>
                            <input type="number" class="control-input" id="textPostPoints"
                                   value="10" step="1" min="1" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-image"></i> Image Post Points
                            </label>
                            <input type="number" class="control-input" id="imagePostPoints"
                                   value="20" step="2" min="1" max="100"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-video"></i> Video Post Points
                            </label>
                            <input type="number" class="control-input" id="videoPostPoints"
                                   value="50" step="5" min="1" max="200"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-heart"></i> Like Points
                            </label>
                            <input type="number" class="control-input" id="likePoints"
                                   value="1" step="0.1" min="0.1" max="10"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-comment"></i> Comment Points
                            </label>
                            <input type="number" class="control-input" id="commentPoints"
                                   value="8" step="1" min="1" max="30"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-share"></i> Share Points
                            </label>
                            <input type="number" class="control-input" id="sharePoints"
                                   value="10" step="1" min="1" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-user-plus"></i> Follow Points
                            </label>
                            <input type="number" class="control-input" id="followPoints"
                                   value="2" step="0.5" min="0.5" max="20"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-ban"></i> Max Posts/Day (Anti-Bot)
                            </label>
                            <input type="number" class="control-input" id="maxPostsPerDay"
                                   value="50" step="5" min="10" max="200"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-ban"></i> Max Likes/Day (Anti-Bot)
                            </label>
                            <input type="number" class="control-input" id="maxLikesPerDay"
                                   value="500" step="50" min="100" max="2000"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-ban"></i> Max Comments/Day (Anti-Bot)
                            </label>
                            <input type="number" class="control-input" id="maxCommentsPerDay"
                                   value="200" step="20" min="50" max="1000"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-medal"></i> Quality Multiplier (High)
                            </label>
                            <input type="number" class="control-input" id="highQualityMultiplier"
                                   value="3.0" step="0.5" min="1" max="10"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-star"></i> Reputation Multiplier (Verified)
                            </label>
                            <input type="number" class="control-input" id="verifiedMultiplier"
                                   value="1.4" step="0.1" min="1" max="5"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-crown"></i> Reputation Multiplier (Premium)
                            </label>
                            <input type="number" class="control-input" id="premiumMultiplier"
                                   value="1.8" step="0.1" min="1" max="5"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-clock"></i> Day 7 Content Decay %
                            </label>
                            <input type="number" class="control-input" id="day7Decay"
                                   value="70" step="5" min="20" max="100"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-hourglass"></i> Day 30 Content Decay %
                            </label>
                            <input type="number" class="control-input" id="day30Decay"
                                   value="20" step="5" min="5" max="80"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-dollar-sign"></i> Max Reward/User/Day (USD)
                            </label>
                            <input type="number" class="control-input" id="maxDailyRewardUSD"
                                   value="50" step="5" min="10" max="500"
                                   oninput="recalculateAll()">
                            <p style="font-size: 10px; color: rgba(255,255,255,0.6); margin-top: 4px; margin-bottom: 0;">
                                Prevents excessive rewards in early days with few users
                            </p>
                        </div>
                    </div>
                </div>

                <hr style="border-color: rgba(255,255,255,0.3); margin: 30px 0;">

                <h5 style="color: white; font-weight: 700; margin-bottom: 20px;">
                    <i class="fas fa-comments"></i> Messaging Module Pricing (USD)
                </h5>

                <div class="row">
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-lock"></i> Encrypted DM (per msg)
                            </label>
                            <input type="number" class="control-input" id="encryptedDMFee"
                                   value="0.02" step="0.01" min="0" max="0.5"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-users"></i> Group Chat Fee ($)
                            </label>
                            <input type="number" class="control-input" id="groupChatFee"
                                   value="1" step="0.25" min="0" max="10"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-file"></i> File Transfer Fee ($)
                            </label>
                            <input type="number" class="control-input" id="fileTransferFee"
                                   value="0.10" step="0.05" min="0" max="2"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-phone"></i> Voice/Video Call (per min)
                            </label>
                            <input type="number" class="control-input" id="voiceCallFee"
                                   value="0.05" step="0.01" min="0" max="1"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-database"></i> Message Storage (monthly)
                            </label>
                            <input type="number" class="control-input" id="messageStorageFee"
                                   value="2" step="0.5" min="0" max="20"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-star"></i> Premium Features ($)
                            </label>
                            <input type="number" class="control-input" id="messagingPremiumFee"
                                   value="5" step="1" min="0" max="50"
                                   oninput="recalculateAll()">
                        </div>
                    </div>
                </div>

                <div class="preset-buttons">
                    <button class="btn-preset" onclick="loadPreset('conservative')">
                        <i class="fas fa-shield-alt"></i> Conservative Scenario
                    </button>
                    <button class="btn-preset" onclick="loadPreset('base')">
                        <i class="fas fa-balance-scale"></i> Base Case (Default)
                    </button>
                    <button class="btn-preset" onclick="loadPreset('aggressive')">
                        <i class="fas fa-rocket"></i> Aggressive Growth
                    </button>
                    <button class="btn-preset" onclick="loadPreset('bull')">
                        <i class="fas fa-chart-line"></i> Bull Market (High Price)
                    </button>
                    <button class="btn-preset" onclick="resetToDefaults()">
                        <i class="fas fa-redo"></i> Reset to Defaults
                    </button>
                </div>

                <div class="preset-buttons" style="margin-top: 16px; border-top: 1px solid var(--border-primary); padding-top: 16px;">
                    <button class="btn-export" onclick="exportParameters()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <i class="fas fa-download"></i> Export Parameters
                    </button>
                    <button class="btn-export" onclick="document.getElementById('importParamsFile').click()" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                        <i class="fas fa-upload"></i> Import Parameters
                    </button>
                    <input type="file" id="importParamsFile" accept=".json" style="display: none;" onchange="importParameters(event)">
                    <button class="btn-export" onclick="exportFullReport()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <i class="fas fa-file-export"></i> Export Full Report
                    </button>
                </div>
            </div>

            <nav class="module-nav">
                <ul class="module-nav-list">
                    <li><a href="#overview" class="module-nav-link active"><i class="fas fa-chart-line"></i> Overview</a></li>
                    <li><a href="#module-identity" class="module-nav-link"><i class="fas fa-user"></i> Identity</a></li>
                    <li><a href="#module-content" class="module-nav-link"><i class="fas fa-file-alt"></i> Content</a></li>
                    <li><a href="#module-community" class="module-nav-link"><i class="fas fa-users"></i> Community</a></li>
                    <li><a href="#module-advertising" class="module-nav-link"><i class="fas fa-bullhorn"></i> Advertising</a></li>
                    <li><a href="#module-messaging" class="module-nav-link"><i class="fas fa-comments"></i> Messaging</a></li>
                    <li><a href="#module-rewards" class="module-nav-link"><i class="fas fa-gift"></i> Rewards</a></li>
                    <li><a href="#reward-flow" class="module-nav-link"><i class="fas fa-exchange-alt"></i> Reward Flow</a></li>
                    <li><a href="#liquidity" class="module-nav-link"><i class="fas fa-water"></i> Liquidity & ADTV</a></li>
                    <li><a href="#velocity" class="module-nav-link"><i class="fas fa-chart-line"></i> 60-Month Velocity</a></li>
                    <li><a href="#system-summary" class="module-nav-link"><i class="fas fa-chart-pie"></i> Summary</a></li>
                </ul>
            </nav>

            <div class="content-section">

                <!-- OVERVIEW SECTION -->
                <section id="overview" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #191919 0%, #242424 100%);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="module-title">
                            <h2>System Overview</h2>
                            <p id="overviewSubtitle">Starting with 1000 Users - All Modules Profitable Day 1</p>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div id="overviewMissionSummary">
                            <strong>Mission Accomplished:</strong> Loading...
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-dollar-sign"></i> Month 1 Economics Summary (<span id="overviewUsersCount">1000</span> Users)</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Module</th><th>Revenue</th><th>Costs</th><th>Profit</th><th>Margin</th><th>Status</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Identity</strong></td>
                                    <td id="identityRevenue">$0</td>
                                    <td id="identityCosts">$0</td>
                                    <td id="identityProfit" style="font-weight: 600;">$0</td>
                                    <td id="identityMargin">0%</td>
                                    <td><span class="badge bg-success">PROFITABLE</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Content</strong></td>
                                    <td id="contentRevenue">$0</td>
                                    <td id="contentCosts">$0</td>
                                    <td id="contentProfit" style="font-weight: 600;">$0</td>
                                    <td id="contentMargin">0%</td>
                                    <td><span class="badge bg-success">PROFITABLE</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Advertising</strong></td>
                                    <td id="advertisingRevenue">$0</td>
                                    <td id="advertisingCosts">$0</td>
                                    <td id="advertisingProfit" style="font-weight: 600;">$0</td>
                                    <td id="advertisingMargin">0%</td>
                                    <td><span class="badge bg-success">PROFITABLE</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Community</strong></td>
                                    <td id="communityRevenue">$0</td>
                                    <td id="communityCosts">$0</td>
                                    <td id="communityProfit" style="font-weight: 600;">$0</td>
                                    <td id="communityMargin">0%</td>
                                    <td><span class="badge bg-success">PROFITABLE</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Messaging</strong></td>
                                    <td id="messagingRevenue">$0</td>
                                    <td id="messagingCosts">$0</td>
                                    <td id="messagingProfit" style="font-weight: 600;">$0</td>
                                    <td id="messagingMargin">0%</td>
                                    <td><span class="badge bg-success">PROFITABLE</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Rewards (Operations)</strong></td>
                                    <td>$0</td>
                                    <td id="rewardsCosts">$200</td>
                                    <td id="rewardsProfit" style="color: var(--danger-color); font-weight: 600;">-$200</td>
                                    <td>N/A</td>
                                    <td><span class="badge bg-info">OPERATIONAL</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Rewards (Token Emission)</strong></td>
                                    <td>-</td>
                                    <td id="rewardsEmission">5.83M VIWO</td>
                                    <td id="rewardsEmissionUSD">($175,000)</td>
                                    <td>-</td>
                                    <td><span class="badge bg-warning">EMISSION</span></td>
                                </tr>
                                <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                    <td><strong>TOTAL (Cash)</strong></td>
                                    <td id="totalRevenue">$0</td>
                                    <td id="totalCosts">$0</td>
                                    <td id="totalProfit" style="color: var(--success-color);">$0</td>
                                    <td id="totalMargin">0%</td>
                                    <td><span class="badge bg-success">EXCELLENT</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-recycle"></i> Rewards & Recapture Economics Explained</div>

                        <div class="alert-box alert-info">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>What is Recapture Rate?</strong> Of the <span id="monthlyEmission">5.83M VIWO</span> emitted monthly as rewards, the <strong>Recapture Rate</strong> shows what percentage flows back to the protocol through transaction fees, buybacks, and staking. Higher recapture = more sustainable tokenomics.
                            </div>
                        </div>

                        <div class="recapture-visual">
                            <h6 style="font-weight: 700; margin-bottom: 15px;">Monthly Reward Flow (<span id="monthlyRewardFlowAmount">5.83M</span> VIWO)</h6>
                            <div class="recapture-bar">
                                <div class="recapture-segment" id="burnSegment"
                                     style="background: #ef4444;"
                                     title="Burned forever">
                                    <span id="burnPercent">0%</span>
                                </div>
                                <div class="recapture-segment" id="buybackSegment"
                                     style="background: #f59e0b;"
                                     title="Bought back from market">
                                    <span id="buybackPercent">0%</span>
                                </div>
                                <div class="recapture-segment" id="stakingSegment"
                                     style="background: #8b5cf6;"
                                     title="Locked in staking">
                                    <span id="stakingPercent">0%</span>
                                </div>
                                <div class="recapture-segment" id="circulationSegment"
                                     style="background: #10b981;"
                                     title="Stays in circulation">
                                    <span id="circulationPercent">0%</span>
                                </div>
                            </div>

                            <div class="row mt-3">
                                <div class="col-md-3">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <div style="width: 20px; height: 20px; background: #ef4444; border-radius: 4px;"></div>
                                        <strong>Burns</strong>
                                    </div>
                                    <div id="burnAmount" style="font-size: 18px; font-weight: 700; color: #ef4444;">0 VIWO</div>
                                    <small style="color: var(--text-secondary);">Destroyed forever (deflationary)</small>
                                </div>
                                <div class="col-md-3">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <div style="width: 20px; height: 20px; background: #f59e0b; border-radius: 4px;"></div>
                                        <strong>Buybacks</strong>
                                    </div>
                                    <div id="buybackAmount" style="font-size: 18px; font-weight: 700; color: #f59e0b;">0 VIWO</div>
                                    <small style="color: var(--text-secondary);">Bought from market with USD profits</small>
                                </div>
                                <div class="col-md-3">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <div style="width: 20px; height: 20px; background: #8b5cf6; border-radius: 4px;"></div>
                                        <strong>Staking</strong>
                                    </div>
                                    <div id="stakingAmount" style="font-size: 18px; font-weight: 700; color: #8b5cf6;">0 VIWO</div>
                                    <small style="color: var(--text-secondary);">Locked for premium features</small>
                                </div>
                                <div class="col-md-3">
                                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                        <div style="width: 20px; height: 20px; background: #10b981; border-radius: 4px;"></div>
                                        <strong>Net Emission</strong>
                                    </div>
                                    <div id="netEmission" style="font-size: 18px; font-weight: 700; color: #10b981;">0 VIWO</div>
                                    <small style="color: var(--text-secondary);">Stays in circulation (rewards users)</small>
                                </div>
                            </div>
                        </div>

                        <div class="metrics-grid mt-4">
                            <div class="metric-box">
                                <div class="metric-box-value" id="totalRecapture">0</div>
                                <div class="metric-box-label">Total Recaptured (VIWO)</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="recaptureRate">0%</div>
                                <div class="metric-box-label">Recapture Rate</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="emissionValue">$0</div>
                                <div class="metric-box-label">Monthly Emission Value</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="recaptureValue">$0</div>
                                <div class="metric-box-label">Monthly Recapture Value</div>
                            </div>
                        </div>

                        <div class="alert-box alert-success mt-3">
                            <i class="fas fa-check-circle"></i>
                            <div id="recaptureInterpretation">
                                Calculating...
                            </div>
                        </div>
                    </div>
                </section>

                <!-- IDENTITY MODULE -->
                <section id="module-identity" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="module-title">
                            <h2>Identity Module</h2>
                            <p>Decentralized Identity, Profile NFTs & Verification - PROFITABLE Day 1</p>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div id="identityProfitabilitySummary">
                            <strong>Profitability:</strong> Real-time calculations based on your selected parameters. Adjust prices in Interactive Controls above to see updates!
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-info-circle"></i> Core Features</div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i><div><strong>Decentralized Identity (DID):</strong> W3C-compliant DIDs linked to Solana wallets</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Profile NFTs:</strong> Metaplex standard NFTs containing user metadata</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Paid Verification Tiers:</strong> Basic ($1), Verified ($7), Premium ($19), Enterprise ($124) - Pricing in USD, converted to VIWO at current token price</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Free Centralized Profiles:</strong> Non-paying users get basic centralized profiles (not on blockchain)</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Privacy Controls:</strong> Selective encryption of profile data using ECIES</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Reward Multipliers:</strong> Verified users earn 1.2x-1.5x rewards across all modules</div></li>
                        </ul>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-dollar-sign"></i> Revenue Model</div>
                        <div class="subsection">
                            <div class="subsection-title">Verification Tiers & Pricing (Dollar-Based)</div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                                <strong>Note:</strong> Pricing is set in USD to maintain stable value. VIWO cost adjusts automatically based on token price. Free users get centralized profiles (not on blockchain).
                            </p>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Tier</th><th>Price (USD)</th><th>Cost (VIWO)</th><th>Multiplier</th><th>Benefits</th><th>Est. Users</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Basic</strong></td>
                                        <td id="identityBasicUSD">$1.00</td>
                                        <td id="identityBasicVIWO">33.3 VIWO</td>
                                        <td>1.0x</td>
                                        <td>On-chain profile, reward eligibility</td>
                                        <td id="identityBasicUsers">0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Verified</strong></td>
                                        <td id="identityVerifiedUSD">$7.00</td>
                                        <td id="identityVerifiedVIWO">233.3 VIWO</td>
                                        <td>1.2x</td>
                                        <td>Blue check, priority support, 20% bonus rewards</td>
                                        <td id="identityVerifiedUsers">0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Premium</strong></td>
                                        <td id="identityPremiumUSD">$19.00</td>
                                        <td id="identityPremiumVIWO">633.3 VIWO</td>
                                        <td>1.4x</td>
                                        <td>Full features, API access, 40% bonus rewards</td>
                                        <td id="identityPremiumUsers">0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Enterprise</strong></td>
                                        <td id="identityEnterpriseUSD">$124.00</td>
                                        <td id="identityEnterpriseVIWO">4,133.3 VIWO</td>
                                        <td>1.5x</td>
                                        <td>Multi-admin, white label, 50% bonus rewards</td>
                                        <td id="identityEnterpriseUsers">0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title">Transaction Fee Distribution</div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                                All tier subscription transactions include a small blockchain fee distributed as follows:
                            </p>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Action</th><th>Base Fee (USD)</th><th>Fee (VIWO)</th><th>Burn (20%)</th><th>Treasury (50%)</th><th>Rewards (30%)</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Tier Subscription (Basic)</td>
                                        <td>$<span id="feeBasic">1.00</span></td>
                                        <td id="feeBasicVIWO">33.3</td>
                                        <td id="feeBasicBurn">6.7</td>
                                        <td id="feeBasicTreasury">16.7</td>
                                        <td id="feeBasicRewards">10.0</td>
                                    </tr>
                                    <tr>
                                        <td>Tier Subscription (Verified)</td>
                                        <td>$<span id="feeVerified">7.00</span></td>
                                        <td id="feeVerifiedVIWO">233.3</td>
                                        <td id="feeVerifiedBurn">46.7</td>
                                        <td id="feeVerifiedTreasury">116.7</td>
                                        <td id="feeVerifiedRewards">70.0</td>
                                    </tr>
                                    <tr>
                                        <td>Tier Subscription (Premium)</td>
                                        <td>$<span id="feePremium">19.00</span></td>
                                        <td id="feePremiumVIWO">633.3</td>
                                        <td id="feePremiumBurn">126.7</td>
                                        <td id="feePremiumTreasury">316.7</td>
                                        <td id="feePremiumRewards">190.0</td>
                                    </tr>
                                    <tr>
                                        <td>Tier Subscription (Enterprise)</td>
                                        <td>$<span id="feeEnterprise">124.00</span></td>
                                        <td id="feeEnterpriseVIWO">4,133.3</td>
                                        <td id="feeEnterpriseBurn">826.7</td>
                                        <td id="feeEnterpriseTreasury">2,066.7</td>
                                        <td id="feeEnterpriseRewards">1,240.0</td>
                                    </tr>
                                    <tr>
                                        <td>Profile Transfer</td>
                                        <td>$<span id="feeTransfer">3.00</span></td>
                                        <td id="feeTransferVIWO">100.0</td>
                                        <td id="feeTransferBurn">20.0</td>
                                        <td id="feeTransferTreasury">50.0</td>
                                        <td id="feeTransferRewards">30.0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title">Month 1 Revenue Breakdown (Real-Time)</div>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Revenue Source</th><th>Description</th><th>Monthly Revenue (USD)</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Tier Subscriptions</strong></td>
                                        <td>Monthly recurring fees from Basic, Verified, Premium, Enterprise tiers</td>
                                        <td id="identityTierRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Profile Transfers</strong></td>
                                        <td>Fee charged when users transfer profile ownership (~10% of paid users monthly)</td>
                                        <td id="identityTransferRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Marketplace Sales</strong></td>
                                        <td>Commission on profile NFT secondary sales (paid in VIWO)</td>
                                        <td id="identitySaleRevenue">$0</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td colspan="2"><strong>TOTAL REVENUE</strong></td>
                                        <td id="identityTotalRevenue">$0</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 16px; font-size: 13px;">
                                <strong>Monthly Costs:</strong> <span id="identityCostsDetail">$500</span> (Solana tx fees, IPFS storage, compute, KYC verification, support)<br>
                                <strong>Net Profit:</strong> <span id="identityProfitDetail" style="color: var(--success-color); font-weight: 700;">$0 (0% margin)</span>
                            </p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-recycle"></i> Reward Recapture Mechanisms (Real-Time)</div>
                        <div class="subsection">
                            <div class="subsection-title">How Identity Module Recaptures Distributed Rewards</div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                                <strong>Allocation:</strong> Identity Module receives <span id="identityEmissionPercent">5%</span> of total monthly emissions = <span id="identityEmissionAmount">291,667 VIWO</span>/month
                            </p>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Mechanism</th><th>Description</th><th>Monthly Recapture (VIWO)</th><th>% of Module Emissions</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Transaction Fees (Burn)</strong></td>
                                        <td>20% of all tier subscription & transfer fees burned permanently</td>
                                        <td id="identityRecaptureBurn">0</td>
                                        <td id="identityRecaptureBurnPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Transaction Fees (Treasury)</strong></td>
                                        <td>50% of fees go to protocol treasury for operations</td>
                                        <td id="identityRecaptureTreasury">0</td>
                                        <td id="identityRecaptureTreasuryPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Staking for Premium Tiers</strong></td>
                                        <td>Users stake VIWO to unlock higher verification tiers (temporarily locked)</td>
                                        <td id="identityRecaptureStaking">0</td>
                                        <td id="identityRecaptureStakingPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Profile NFT Marketplace</strong></td>
                                        <td><span id="identitySaleCommissionPercent">5%</span> commission on secondary profile sales (paid in VIWO)</td>
                                        <td id="identityRecaptureRoyalties">0</td>
                                        <td id="identityRecaptureRoyaltiesPercent">0%</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td>TOTAL RECAPTURED</td>
                                        <td>-</td>
                                        <td id="identityRecaptureTotal">0 VIWO/month</td>
                                        <td id="identityRecaptureTotalPercent">0%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                                <strong>Net Impact:</strong> <span id="identityRecaptureSummary">Identity module activities receive approximately 291,667 VIWO/month in rewards, and recapture through fees, staking, and marketplace commissions. This creates a circular economy where the module helps offset its own reward emissions.</span>
                            </p>
                        </div>
                    </div>
                </section>

                <!-- CONTENT MODULE (continuing with same detail level) -->
                <section id="module-content" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="module-title">
                            <h2>Content Module</h2>
                            <p>Content Creation, Storage, Monetization & NFT Minting - PROFITABLE Day 1</p>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div id="contentProfitabilitySummary">
                            <strong>Profitability:</strong> Real-time calculations based on your selected parameters. Adjust prices in Interactive Controls above!
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-info-circle"></i> Core Features</div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i><div><strong>Multi-Format Support:</strong> Text ($<span id="contentTextFeeDisplay">0.05</span>), images ($<span id="contentImageFeeDisplay">0.10</span>), videos ($<span id="contentVideoFeeDisplay">0.25</span>) - Pricing in USD</div></li>
                            <li><i class="fas fa-check"></i><div><strong>NFT Minting:</strong> Convert content to Metaplex NFTs for $<span id="contentNFTFeeDisplay">2.00</span></div></li>
                            <li><i class="fas fa-check"></i><div><strong>Premium Creator Subscriptions:</strong> $<span id="contentPremiumSubDisplay">5.00</span>/month for advanced features</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Content Boost:</strong> Promote posts for $<span id="contentBoostFeeDisplay">1.00</span> each</div></li>
                            <li><i class="fas fa-check"></i><div><strong>NFT Marketplace:</strong> <span id="contentCommissionDisplay">10%</span> commission on secondary sales</div></li>
                        </ul>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-dollar-sign"></i> Revenue Model</div>
                        <div class="subsection">
                            <div class="subsection-title">Revenue Breakdown (Real-Time)</div>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Revenue Source</th><th>Description</th><th>Monthly Revenue (USD)</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Post Fees</strong></td>
                                        <td>Fees from text, image, video posts, and NFT minting</td>
                                        <td id="contentPostFeesRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Premium Subscriptions</strong></td>
                                        <td><span id="contentPremiumSubsCount">0</span> creators paying $<span id="contentPremiumSubPrice">5</span>/month</td>
                                        <td id="contentPremiumRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Content Boosts</strong></td>
                                        <td><span id="contentBoostedPostsCount">0</span> boosted posts @ $<span id="contentBoostPrice">1</span> each</td>
                                        <td id="contentBoostRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>NFT Marketplace</strong></td>
                                        <td><span id="contentNFTSalesCount">50</span> sales/month with <span id="contentCommissionRate">10%</span> commission</td>
                                        <td id="contentNFTSalesRevenue">$0</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td colspan="2"><strong>TOTAL REVENUE</strong></td>
                                        <td id="contentTotalRevenue">$0</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 16px; font-size: 13px;">
                                <strong>Monthly Costs:</strong> <span id="contentCostsDetail">$800</span> (Storage, CDN, moderation, compute)<br>
                                <strong>Net Profit:</strong> <span id="contentProfitDetail" style="color: var(--success-color); font-weight: 700;">$0 (0% margin)</span>
                            </p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-recycle"></i> Reward Recapture Mechanisms (Real-Time)</div>
                        <div class="subsection">
                            <div class="subsection-title">How Content Module Recaptures Distributed Rewards</div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                                <strong>Allocation:</strong> Content Module receives <span id="contentEmissionPercent">40%</span> of total monthly emissions = <span id="contentEmissionAmount">2,333,333 VIWO</span>/month
                            </p>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Mechanism</th><th>Description</th><th>Monthly Recapture (VIWO)</th><th>% of Module Emissions</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Transaction Fees (Burn)</strong></td>
                                        <td>20% of post fees and subscriptions burned permanently</td>
                                        <td id="contentRecaptureBurn">0</td>
                                        <td id="contentRecaptureBurnPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Transaction Fees (Treasury)</strong></td>
                                        <td>50% of fees go to protocol treasury</td>
                                        <td id="contentRecaptureTreasury">0</td>
                                        <td id="contentRecaptureTreasuryPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Creator Staking</strong></td>
                                        <td>Premium creators stake VIWO for advanced features</td>
                                        <td id="contentRecaptureStaking">0</td>
                                        <td id="contentRecaptureStakingPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>NFT Marketplace</strong></td>
                                        <td><span id="contentNFTCommissionPercent">10%</span> commission on content NFT sales (paid in VIWO)</td>
                                        <td id="contentRecaptureRoyalties">0</td>
                                        <td id="contentRecaptureRoyaltiesPercent">0%</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td>TOTAL RECAPTURED</td>
                                        <td>-</td>
                                        <td id="contentRecaptureTotal">0 VIWO/month</td>
                                        <td id="contentRecaptureTotalPercent">0%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                                <strong>Net Impact:</strong> <span id="contentRecaptureSummary">Content module receives 2.33M VIWO/month in rewards and recaptures through fees, staking, and marketplace commissions.</span>
                            </p>
                        </div>
                    </div>
                </section>

                <!-- COMMUNITY MODULE -->
                <section id="module-community" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="module-title">
                            <h2>Community Module</h2>
                            <p>DAOs, Token-Gated Communities & Group Management - PROFITABLE Day 1</p>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div id="communityProfitabilitySummary">
                            <strong>Profitability:</strong> Loading...
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-info-circle"></i> Core Features</div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i><div><strong>DAO Framework:</strong> On-chain governance with Squads multisig integration</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Token-Gated Access:</strong> NFT and SPL token-based community access control</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Treasury Management:</strong> Built-in treasury with proposal and voting systems</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Event Coordination:</strong> Virtual and IRL event planning for $<span id="communityEventFeeDisplay">5.00</span>/event</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Membership Tiers:</strong> Small ($<span id="communitySmallFeeDisplay">3</span>), Medium ($<span id="communityMediumFeeDisplay">10</span>), Large ($<span id="communityLargeFeeDisplay">25</span>), Enterprise ($<span id="communityEnterpriseFeeDisplay">100</span>)</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Verification Badge:</strong> $<span id="communityVerificationFeeDisplay">20.00</span> for official community status</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Community Analytics:</strong> $<span id="communityAnalyticsFeeDisplay">15.00</span>/month for insights dashboard</div></li>
                        </ul>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-dollar-sign"></i> Revenue Model</div>
                        <div class="subsection">
                            <div class="subsection-title">Community Revenue Streams (Real-Time)</div>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Revenue Source</th><th>Description</th><th>Monthly Revenue (USD)</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Community Tier Fees</strong></td>
                                        <td><span id="communitySmallCount">0</span> small @ $<span id="communitySmallPrice">3</span>, <span id="communityMediumCount">0</span> medium @ $<span id="communityMediumPrice">10</span>, <span id="communityLargeCount">0</span> large @ $<span id="communityLargePrice">25</span>, <span id="communityEnterpriseCount">0</span> enterprise @ $<span id="communityEnterprisePrice">100</span></td>
                                        <td id="communityTierRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Event Hosting</strong></td>
                                        <td><span id="communityEventsCount">0</span> events/month @ $<span id="communityEventPrice">5</span> each</td>
                                        <td id="communityEventRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Verification Badges</strong></td>
                                        <td><span id="communityVerificationsCount">0</span> verifications @ $<span id="communityVerificationPrice">20</span> each</td>
                                        <td id="communityVerificationRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Analytics Subscriptions</strong></td>
                                        <td><span id="communityAnalyticsCount">0</span> subscriptions @ $<span id="communityAnalyticsPrice">15</span>/month</td>
                                        <td id="communityAnalyticsRevenue">$0</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td colspan="2"><strong>TOTAL REVENUE</strong></td>
                                        <td id="communityTotalRevenue">$0</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px;">
                                <strong>Monthly Costs:</strong> $<span id="communityCostsDetail">0</span> (scales with community count)<br>
                                <strong>Net Profit:</strong> <span id="communityProfitDetail" style="color: var(--success-color); font-weight: 700;">$0 (0% margin)</span>
                            </p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-recycle"></i> Reward Recapture Mechanisms (Real-Time)</div>
                        <div class="subsection">
                            <div class="subsection-title">How Community Module Recaptures Distributed Rewards</div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                                <strong>Allocation:</strong> Community Module receives <span id="communityEmissionPercent">10%</span> of total monthly emissions = <span id="communityEmissionAmount">583,333 VIWO</span>/month
                            </p>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Mechanism</th><th>Description</th><th>Monthly Recapture (VIWO)</th><th>% of Module Emissions</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Transaction Fees (Burn)</strong></td>
                                        <td>20% of community fees burned permanently</td>
                                        <td id="communityRecaptureBurn">0</td>
                                        <td id="communityRecaptureBurnPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Transaction Fees (Treasury)</strong></td>
                                        <td>50% of fees go to protocol treasury</td>
                                        <td id="communityRecaptureTreasury">0</td>
                                        <td id="communityRecaptureTreasuryPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>DAO Staking</strong></td>
                                        <td>Communities stake VIWO for advanced governance features</td>
                                        <td id="communityRecaptureStaking">0</td>
                                        <td id="communityRecaptureStakingPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Event Revenue</strong></td>
                                        <td>Event hosting fees paid in VIWO</td>
                                        <td id="communityRecaptureEvents">0</td>
                                        <td id="communityRecaptureEventsPercent">0%</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td>TOTAL RECAPTURED</td>
                                        <td>-</td>
                                        <td id="communityRecaptureTotal">0 VIWO/month</td>
                                        <td id="communityRecaptureTotalPercent">0%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                                <strong>Net Impact:</strong> <span id="communityRecaptureSummary">Community module receives VIWO/month in rewards and recaptures through fees, staking, and event hosting.</span>
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ADVERTISING MODULE -->
                <section id="module-advertising" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <div class="module-title">
                            <h2>Advertising Module</h2>
                            <p>Privacy-First Programmatic Advertising - PROFITABLE Day 1</p>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div id="advertisingProfitabilitySummary">
                            <strong>Profitability:</strong> Loading...
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-info-circle"></i> Core Features</div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i><div><strong>Privacy-Preserving Targeting:</strong> Zero-knowledge proof-based ad targeting</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Banner Ads:</strong> $<span id="advertisingBannerCPMDisplay">15.00</span> CPM for banner placements</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Video Ads:</strong> $<span id="advertisingVideoCPMDisplay">40.00</span> CPM for video content</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Promoted Posts:</strong> $<span id="advertisingPromotedPostDisplay">3.00</span> per promoted post</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Campaign Management:</strong> $<span id="advertisingCampaignMgmtDisplay">50.00</span>/month for managed campaigns</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Analytics Platform:</strong> $<span id="advertisingAnalyticsDisplay">30.00</span>/month for insights dashboard</div></li>
                        </ul>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-dollar-sign"></i> Revenue Model</div>
                        <div class="subsection">
                            <div class="subsection-title">Advertising Revenue Streams (Real-Time)</div>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Revenue Source</th><th>Description</th><th>Monthly Revenue (USD)</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Banner Ads (CPM)</strong></td>
                                        <td><span id="advertisingBannerImpressionsCount">0</span> impressions @ $<span id="advertisingBannerCPMPrice">15</span> CPM</td>
                                        <td id="advertisingBannerRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Video Ads (CPM)</strong></td>
                                        <td><span id="advertisingVideoImpressionsCount">0</span> impressions @ $<span id="advertisingVideoCPMPrice">40</span> CPM</td>
                                        <td id="advertisingVideoRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Promoted Posts</strong></td>
                                        <td><span id="advertisingPromotedPostsCount">0</span> posts @ $<span id="advertisingPromotedPostPrice">3</span> each</td>
                                        <td id="advertisingPromotedRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Campaign Management</strong></td>
                                        <td><span id="advertisingCampaignsCount">0</span> campaigns @ $<span id="advertisingCampaignPrice">50</span>/month</td>
                                        <td id="advertisingCampaignRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Analytics Subscriptions</strong></td>
                                        <td><span id="advertisingAnalyticsCount">0</span> subscriptions @ $<span id="advertisingAnalyticsPrice">30</span>/month</td>
                                        <td id="advertisingAnalyticsRevenue">$0</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td colspan="2"><strong>TOTAL REVENUE</strong></td>
                                        <td id="advertisingTotalRevenue">$0</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px;">
                                <strong>Monthly Costs:</strong> $<span id="advertisingCostsDetail">0</span> (scales with ad impressions)<br>
                                <strong>Net Profit:</strong> <span id="advertisingProfitDetail" style="color: var(--success-color); font-weight: 700;">$0 (0% margin)</span>
                            </p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-recycle"></i> Reward Recapture Mechanisms (Real-Time)</div>
                        <div class="subsection">
                            <div class="subsection-title">How Advertising Module Recaptures Distributed Rewards</div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                                <strong>Allocation:</strong> Advertising Module receives <span id="advertisingEmissionPercent">15%</span> of total monthly emissions = <span id="advertisingEmissionAmount">875,000 VIWO</span>/month
                            </p>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Mechanism</th><th>Description</th><th>Monthly Recapture (VIWO)</th><th>% of Module Emissions</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Transaction Fees (Burn)</strong></td>
                                        <td>20% of advertising fees burned permanently</td>
                                        <td id="advertisingRecaptureBurn">0</td>
                                        <td id="advertisingRecaptureBurnPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Transaction Fees (Treasury)</strong></td>
                                        <td>50% of fees go to protocol treasury</td>
                                        <td id="advertisingRecaptureTreasury">0</td>
                                        <td id="advertisingRecaptureTreasuryPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Campaign Deposits</strong></td>
                                        <td>Advertisers stake VIWO for campaign slots</td>
                                        <td id="advertisingRecaptureStaking">0</td>
                                        <td id="advertisingRecaptureStakingPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Buyback Program</strong></td>
                                        <td>25% of USD profits used to buy VIWO</td>
                                        <td id="advertisingRecaptureBuyback">0</td>
                                        <td id="advertisingRecaptureBuybackPercent">0%</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td>TOTAL RECAPTURED</td>
                                        <td>-</td>
                                        <td id="advertisingRecaptureTotal">0 VIWO/month</td>
                                        <td id="advertisingRecaptureTotalPercent">0%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                                <strong>Net Impact:</strong> <span id="advertisingRecaptureSummary">Advertising module receives VIWO/month in rewards and recaptures through fees, deposits, and buybacks.</span>
                            </p>
                        </div>
                    </div>
                </section>

                <!-- MESSAGING MODULE -->
                <section id="module-messaging" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="module-title">
                            <h2>Messaging Module</h2>
                            <p>Encrypted Messaging with Crypto Payments - PROFITABLE Day 1</p>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div id="messagingProfitabilitySummary">
                            <strong>Profitability:</strong> Loading...
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-info-circle"></i> Core Features</div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i><div><strong>End-to-End Encryption:</strong> Signal protocol with on-chain key distribution</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Encrypted DMs:</strong> $<span id="messagingEncryptedDMDisplay">0.02</span> per encrypted message</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Group Chats:</strong> $<span id="messagingGroupChatDisplay">1.00</span>/month for premium group features</div></li>
                            <li><i class="fas fa-check"></i><div><strong>File Sharing:</strong> $<span id="messagingFileTransferDisplay">0.10</span> per file transfer</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Voice Calls:</strong> $<span id="messagingVoiceCallDisplay">0.05</span> per minute</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Message Storage:</strong> $<span id="messagingStorageDisplay">2.00</span>/month for extended storage</div></li>
                            <li><i class="fas fa-check"></i><div><strong>Premium Features:</strong> $<span id="messagingPremiumDisplay">5.00</span>/month for full access</div></li>
                        </ul>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-dollar-sign"></i> Revenue Model</div>
                        <div class="subsection">
                            <div class="subsection-title">Messaging Revenue Streams (Real-Time)</div>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Revenue Source</th><th>Description</th><th>Monthly Revenue (USD)</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Encrypted Messages</strong></td>
                                        <td><span id="messagingEncryptedCount">0</span> encrypted messages @ $<span id="messagingEncryptedPrice">0.02</span> each</td>
                                        <td id="messagingEncryptedRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Group Chat Subscriptions</strong></td>
                                        <td><span id="messagingGroupsCount">0</span> groups @ $<span id="messagingGroupPrice">1</span>/month</td>
                                        <td id="messagingGroupRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>File Transfers</strong></td>
                                        <td><span id="messagingFilesCount">0</span> files @ $<span id="messagingFilePrice">0.10</span> each</td>
                                        <td id="messagingFileRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Voice Calls</strong></td>
                                        <td><span id="messagingCallsCount">0</span> minutes @ $<span id="messagingCallPrice">0.05</span>/min</td>
                                        <td id="messagingCallRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Storage Subscriptions</strong></td>
                                        <td><span id="messagingStorageCount">0</span> users @ $<span id="messagingStoragePrice">2</span>/month</td>
                                        <td id="messagingStorageRevenue">$0</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Premium Subscriptions</strong></td>
                                        <td><span id="messagingPremiumCount">0</span> users @ $<span id="messagingPremiumPrice">5</span>/month</td>
                                        <td id="messagingPremiumRevenue">$0</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td colspan="2"><strong>TOTAL REVENUE</strong></td>
                                        <td id="messagingTotalRevenue">$0</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px;">
                                <strong>Monthly Costs:</strong> $<span id="messagingCostsDetail">0</span> (scales with messages sent)<br>
                                <strong>Net Profit:</strong> <span id="messagingProfitDetail" style="color: var(--success-color); font-weight: 700;">$0 (0% margin)</span>
                            </p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-recycle"></i> Reward Recapture Mechanisms (Real-Time)</div>
                        <div class="subsection">
                            <div class="subsection-title">How Messaging Module Recaptures Distributed Rewards</div>
                            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
                                <strong>Allocation:</strong> Messaging Module receives <span id="messagingEmissionPercent">10%</span> of total monthly emissions = <span id="messagingEmissionAmount">583,333 VIWO</span>/month
                            </p>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Mechanism</th><th>Description</th><th>Monthly Recapture (VIWO)</th><th>% of Module Emissions</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Transaction Fees (Burn)</strong></td>
                                        <td>20% of messaging fees burned permanently</td>
                                        <td id="messagingRecaptureBurn">0</td>
                                        <td id="messagingRecaptureBurnPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Transaction Fees (Treasury)</strong></td>
                                        <td>50% of fees go to protocol treasury</td>
                                        <td id="messagingRecaptureTreasury">0</td>
                                        <td id="messagingRecaptureTreasuryPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Premium Staking</strong></td>
                                        <td>Users stake VIWO for premium messaging features</td>
                                        <td id="messagingRecaptureStaking">0</td>
                                        <td id="messagingRecaptureStakingPercent">0%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>File Transfer Fees</strong></td>
                                        <td>File sharing fees paid in VIWO</td>
                                        <td id="messagingRecaptureFiles">0</td>
                                        <td id="messagingRecaptureFilesPercent">0%</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td>TOTAL RECAPTURED</td>
                                        <td>-</td>
                                        <td id="messagingRecaptureTotal">0 VIWO/month</td>
                                        <td id="messagingRecaptureTotalPercent">0%</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                                <strong>Net Impact:</strong> <span id="messagingRecaptureSummary">Messaging module receives VIWO/month in rewards and recaptures through fees, staking, and file transfers.</span>
                            </p>
                        </div>
                    </div>
                </section>

                <!-- REWARDS MODULE -->
                <section id="module-rewards" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="module-title">
                            <h2>Rewards Distribution System</h2>
                            <p>Advanced Quality-Based Algorithm for Sustainable 5-Year Economy</p>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div id="rewardsProfitabilitySummary">
                            <strong>Daily Reward Pool:</strong> <span id="dailyRewardPool">38,889</span> VIWO (<span id="rewardAllocationDisplay">80</span>% of daily emission) = $<span id="dailyRewardPoolUSD">1,166.67</span> | Distributed to ALL active users based on activity quality and engagement. Max <span id="maxRewardDisplay">$50</span>/user/day prevents excessive rewards in early days. This creates sustainable income for quality contributors while preventing bot abuse.
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-brain"></i> PHASE 1: Activity Types & Base Points</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Activity Type</th><th>Base Points</th><th>Daily Cap (Anti-Bot)</th><th>Description</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Text Post</strong></td>
                                    <td id="rewardTextPoints">10</td>
                                    <td id="rewardMaxPosts">50</td>
                                    <td>Short text content creation</td>
                                </tr>
                                <tr>
                                    <td><strong>Image Post</strong></td>
                                    <td id="rewardImagePoints">20</td>
                                    <td id="rewardMaxPosts2">50</td>
                                    <td>Visual content creation</td>
                                </tr>
                                <tr>
                                    <td><strong>Video Post</strong></td>
                                    <td id="rewardVideoPoints">50</td>
                                    <td>10</td>
                                    <td>High-effort video content</td>
                                </tr>
                                <tr>
                                    <td><strong>Like</strong></td>
                                    <td id="rewardLikePoints">1</td>
                                    <td id="rewardMaxLikes">500</td>
                                    <td>Basic engagement</td>
                                </tr>
                                <tr>
                                    <td><strong>Quality Comment</strong></td>
                                    <td id="rewardCommentPoints">8</td>
                                    <td id="rewardMaxComments">200</td>
                                    <td>Meaningful discussion contribution</td>
                                </tr>
                                <tr>
                                    <td><strong>Share</strong></td>
                                    <td id="rewardSharePoints">10</td>
                                    <td>100</td>
                                    <td>Content amplification</td>
                                </tr>
                                <tr>
                                    <td><strong>Follow</strong></td>
                                    <td id="rewardFollowPoints">2</td>
                                    <td>100</td>
                                    <td>Network building</td>
                                </tr>
                                <tr>
                                    <td><strong>Join Community</strong></td>
                                    <td>5</td>
                                    <td>20</td>
                                    <td>Community participation</td>
                                </tr>
                                <tr>
                                    <td><strong>Create Community</strong></td>
                                    <td>50</td>
                                    <td>5</td>
                                    <td>Community leadership</td>
                                </tr>
                                <tr>
                                    <td><strong>Moderation Action</strong></td>
                                    <td>15</td>
                                    <td>100</td>
                                    <td>Platform quality maintenance</td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                            <strong>Note:</strong> Daily caps prevent bot abuse. Activities beyond caps receive 50% reduced points. Base points are multiplied by quality and reputation scores.
                        </p>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-star"></i> PHASE 2: Quality & Reputation Multipliers</div>
                        <div class="row">
                            <div class="col-md-6">
                                <h6 style="font-weight: 700; margin-bottom: 12px;">Content Quality Multiplier (0.1x - 10x)</h6>
                                <pre style="background: var(--bg-tertiary); padding: 12px; border-radius: 6px; font-size: 11px; margin-bottom: 16px;">
CQS = (
    EngagementRate  40% +
    RetentionScore  30% +
    ViralityScore  20% +
    CommentQuality  10%
)

Engagement Rate = (Likes+Comments+Shares) / Views
 <0.5%: 0.1x  |  0.5-1%: 0.5x
 1-2%: 1.0x   |  2-5%: 2.0x
 5-10%: 5.0x  |  >10%: 10.0x

High Quality Example: <span id="highQualityExample">3.0x</span>
                                </pre>
                            </div>
                            <div class="col-md-6">
                                <h6 style="font-weight: 700; margin-bottom: 12px;">User Reputation Multiplier (0.3x - 5.0x)</h6>
                                <pre style="background: var(--bg-tertiary); padding: 12px; border-radius: 6px; font-size: 11px; margin-bottom: 16px;">
URS = (
    AccountAge  20% +
    HistoricalQuality  40% +
    VerificationTier  20% +
    CommunityStanding  20%
)

Verification Tiers:
 Basic: 1.0x
 Verified: <span id="verifiedMultDisplay">1.4x</span>
 Premium: <span id="premiumMultDisplay">1.8x</span>
 Enterprise: 2.5x

Account Age: 1mo=1.0x | 6mo=1.5x | 1yr=2.0x
                                </pre>
                            </div>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-shield-alt"></i> PHASE 3: Anti-Bot & Abuse Prevention</div>
                        <pre style="background: var(--bg-tertiary); padding: 14px; border-radius: 8px; font-size: 11px; line-height: 1.7;">
<strong> Max Reward Per User:</strong>
  Daily Cap: <span id="maxRewardCap">$50</span>/user/day
   Prevents excessive rewards in early days with few users (10-100 users)
   Maintains fair distribution as platform scales to millions of users
   Example: With 10 users, each gets max $50/day instead of $1,500/day

<strong> Daily Activity Caps:</strong>
  Posts: <span id="antiBotMaxPosts">50</span>/day | Likes: <span id="antiBotMaxLikes">500</span>/day | Comments: <span id="antiBotMaxComments">200</span>/day | Follows: 100/day
   Exceeded = 0.5x multiplier penalty

<strong> Velocity Limits (Per Hour):</strong>
  Posts: 10/hr | Likes: 60/hr | Comments: 30/hr | Follows: 15/hr
   Exceeded = 0.3x multiplier penalty + suspicious flag

<strong> Diversity Requirements:</strong>
  Rule 1: Minimum 3 different activity types per day
  Rule 2: Engagement/Creation ratio must be 2:1 to 50:1
  Rule 3: Comment/Like ratio should be 1:2 to 1:20
   Violated = 0.5x penalty

<strong> Pattern Detection:</strong>
  - Action interval < 1.5 seconds  Bot flag  0.1x
  - Identical comments (>70% similar)  Spam flag  0.2x
  - Engagement only on same accounts  Collusion flag  0.2x
  - Repetitive time patterns  Bot flag  0.3x

<strong> Quality Minimums:</strong>
  - Avg comment length  8 characters
  - Content engagement rate  0.05%
  - Account completeness  50%
   Not met = 0.5x until requirements satisfied
                        </pre>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-clock"></i> PHASE 4: Historical Content Rewards & Time Decay</div>
                        <div class="row">
                            <div class="col-md-8">
                                <pre style="background: var(--bg-tertiary); padding: 12px; border-radius: 6px; font-size: 11px;">
<strong>Time Decay Function:</strong>
Day 0-1: 100% | Day 2: 95% | Day 3: 90%
Day 4-7: 85%  <span id="day7DecayDisplay">70%</span> (linear)
Day 8-14: 65%  45% (linear)
Day 15-30: 40%  <span id="day30DecayDisplay">20%</span> (linear)
Day 31-60: 15%  8% (linear)
Day 61-90: 7%  5% (linear)
Day 90+: 3% (floor - perpetual)

<strong>Viral Resurgence Bonus:</strong>
IF (todayEngagement > 3 avg30DayEngagement):
    bonus = min(todayEng / avgEng  0.3, 2.0)
    effectiveDecay = baseDecay  (1 + bonus)
     Old viral content can earn NEW rewards!
                                </pre>
                            </div>
                            <div class="col-md-4">
                                <h6 style="font-weight: 700; margin-bottom: 8px; font-size: 13px;">Creator/Engager Split</h6>
                                <table class="table-custom" style="font-size: 11px;">
                                    <tr><td>Day 0-1</td><td>70% / 30%</td></tr>
                                    <tr><td>Day 2-7</td><td>60% / 40%</td></tr>
                                    <tr><td>Day 8-30</td><td>40% / 60%</td></tr>
                                    <tr><td>Day 31+</td><td>30% / 70%</td></tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-calculator"></i> PHASE 5: Complete Distribution Algorithm</div>
                        <pre style="background: var(--bg-tertiary); padding: 14px; border-radius: 8px; font-size: 11px; line-height: 1.8;">
<strong>INPUT:</strong> dailyRewardPool = <span id="algoRewardPool">38,889</span> VIWO (<span id="algoRewardPoolUSD">$1,166.67</span>)

<strong>FOR EACH USER on EACH DAY:</strong>

<strong>STEP 1:</strong> Calculate Raw Activity Points
    rawPoints = (activityCount  baseScore  contentAgeDecay)

<strong>STEP 2:</strong> Apply Anti-Bot Filters
    botPenalty = 1.0
    IF (exceeded daily caps)  botPenalty = 0.5
    IF (exceeded velocity)  botPenalty = 0.3
    IF (failed diversity)  botPenalty = 0.5
    IF (detected patterns)  botPenalty = 0.1 to 0.3
    IF (failed quality mins)  botPenalty = 0.5
    filteredPoints = rawPoints  botPenalty

<strong>STEP 3:</strong> Apply Quality Multipliers
    contentQuality = calculateCQS(user, today)  // 0.1x - 10x
    userReputation = calculateURS(user)         // 0.3x - 5.0x
    qualityAdjustedPoints = filteredPoints  contentQuality  userReputation

<strong>STEP 4:</strong> Calculate User Share
    totalPlatformPoints = (all users' qualityAdjustedPoints)
    userRewardShare = (qualityAdjustedPoints / totalPlatformPoints)  dailyRewardPool

<strong>STEP 5:</strong> Split Between Creator & Engagers
    FOR each content:
        age = today - creationDate
        IF age  1: split = 70/30
        ELSE IF age  7: split = 60/40
        ELSE IF age  30: split = 40/60
        ELSE: split = 30/70

<strong>STEP 6:</strong> Apply Minimum Threshold
    IF (totalUserReward < 1 VIWO):
        totalUserReward = 0  // Didn't qualify
        // Remainder distributed among qualifying users

<strong>OUTPUT:</strong> User receives their calculated VIWO reward automatically daily
                        </pre>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-chart-bar"></i> Live Reward Distribution Simulator</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>User Profile</th><th>Daily Activities</th><th>Raw Points</th><th>Quality Mult.</th><th>Final Points</th><th>Daily Reward</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Top Quality Creator</strong><br><span style="font-size: 11px;">Premium, High Quality</span></td>
                                    <td>5 posts, 100 likes, 20 comments, 10 shares</td>
                                    <td id="topCreatorRaw">480</td>
                                    <td id="topCreatorMult">5.4x</td>
                                    <td id="topCreatorFinal">2,592</td>
                                    <td id="topCreatorReward" style="color: var(--success-color); font-weight: 700;">800 VIWO<br><span style="font-size: 11px;">($24/day)</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Active Verified User</strong><br><span style="font-size: 11px;">Verified, Med Quality</span></td>
                                    <td>2 posts, 50 likes, 10 comments, 5 shares</td>
                                    <td id="activeUserRaw">210</td>
                                    <td id="activeUserMult">2.1x</td>
                                    <td id="activeUserFinal">441</td>
                                    <td id="activeUserReward" style="color: var(--success-color); font-weight: 700;">150 VIWO<br><span style="font-size: 11px;">($4.50/day)</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Regular User</strong><br><span style="font-size: 11px;">Basic, Normal Quality</span></td>
                                    <td>1 post, 30 likes, 5 comments</td>
                                    <td id="regularUserRaw">80</td>
                                    <td id="regularUserMult">1.0x</td>
                                    <td id="regularUserFinal">80</td>
                                    <td id="regularUserReward" style="color: var(--success-color); font-weight: 700;">30 VIWO<br><span style="font-size: 11px;">($0.90/day)</span></td>
                                </tr>
                                <tr>
                                    <td><strong>New User</strong><br><span style="font-size: 11px;">Basic, Learning</span></td>
                                    <td>10 likes, 3 comments</td>
                                    <td id="newUserRaw">34</td>
                                    <td id="newUserMult">0.5x</td>
                                    <td id="newUserFinal">17</td>
                                    <td id="newUserReward" style="color: var(--warning-color); font-weight: 700;">5 VIWO<br><span style="font-size: 11px;">($0.15/day)</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Bot/Spammer</strong><br><span style="font-size: 11px;">Suspicious Pattern</span></td>
                                    <td>200 posts, 1000 likes (in 2 hours)</td>
                                    <td id="botUserRaw">3200</td>
                                    <td id="botUserMult">0.1x</td>
                                    <td id="botUserFinal">320</td>
                                    <td id="botUserReward" style="color: var(--danger-color); font-weight: 700;">0 VIWO<br><span style="font-size: 11px;">(Flagged)</span></td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                            <strong>Note:</strong> These are simulations based on current parameters. Actual rewards calculated real-time based on ALL platform activity. Daily pool of <span id="simDailyPool">38,889</span> VIWO is FIXED and shared among qualifying users.
                        </p>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-chart-line"></i> 5-Year Sustainability Model</div>
                        <pre style="background: var(--bg-tertiary); padding: 14px; border-radius: 8px; font-size: 11px; line-height: 1.8;">
<strong>Emission Schedule (Fixed 60 Months):</strong>
Monthly: 5,833,333 VIWO  60 = 350,000,000 VIWO total
Daily Pool: <span id="sustainDailyPool">38,889</span> VIWO for rewards (<span id="sustainAllocation">80</span>% allocation)

<strong>Post-60 Month (Tail Emissions):</strong>
Perpetual: 2% annual inflation from circulating supply
Distribution: Same quality-based algorithm

<strong>Economic Balance Target:</strong>
Year 1: Revenue Recapture 10-15% | Net Inflation: High
Year 2: Revenue Recapture 20-30% | Net Inflation: Moderate | Price: $0.05-$0.15
Year 3: Revenue Recapture 35-45% | Net Inflation: Low | Price: $0.15-$0.40
Year 4: Revenue Recapture 45-60% | Net Inflation: Minimal | Price: $0.40-$0.80
Year 5: Revenue Recapture 50-70% | Net Inflation: Balanced | Price: $0.80-$1.50+

<strong>Driven By:</strong>
 Fee revenue from 5 profitable modules  Burns & Treasury
 Growing user base & utility  Demand increase
 Quality content ecosystem  Platform value
 Anti-bot measures  Genuine user growth
 Historical content rewards  Long-term creator incentive
 Sustainable daily rewards  Predictable income for quality contributors
                        </pre>
                    </div>
                </section>

                <!-- REWARD FLOW TRACKING SECTION -->
                <section id="reward-flow" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="module-title">
                            <h2>Reward Flow Tracking</h2>
                            <p>Exactly Where <span id="flowDailyEmission">194,444</span> VIWO/Day Goes & How Much Returns</p>
                        </div>
                    </div>

                    <div class="alert-box alert-info">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Complete Transparency:</strong> This section shows EXACTLY where every VIWO token from the daily reward pool (<span id="flowDailyPool">155,556</span> VIWO = <span id="flowAllocationPct">80</span>% of daily emission) goes, which activities earn them, and what percentage flows back to the protocol through various recapture mechanisms.
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-water"></i> Daily Reward Pool Distribution (Normal Scenario)</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Activity / Module</th><th>Daily Allocation</th><th>% of Pool</th><th>Recipients</th><th>Avg Per User</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Content Creation</strong></td>
                                    <td id="flowContentAlloc">62,222 VIWO</td>
                                    <td>40%</td>
                                    <td>200 creators</td>
                                    <td id="flowContentAvg">311 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Content Curation</strong></td>
                                    <td id="flowCurationAlloc">31,111 VIWO</td>
                                    <td>20%</td>
                                    <td>300 curators</td>
                                    <td id="flowCurationAvg">104 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Community Building</strong></td>
                                    <td id="flowCommunityAlloc">15,556 VIWO</td>
                                    <td>10%</td>
                                    <td>50 communities</td>
                                    <td id="flowCommunityAvg">311 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Moderation</strong></td>
                                    <td id="flowModerationAlloc">15,556 VIWO</td>
                                    <td>10%</td>
                                    <td>100 moderators</td>
                                    <td id="flowModerationAvg">156 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Engagement (likes, comments)</strong></td>
                                    <td id="flowEngagementAlloc">15,556 VIWO</td>
                                    <td>10%</td>
                                    <td>500 active users</td>
                                    <td id="flowEngagementAvg">31 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Identity/Verification</strong></td>
                                    <td id="flowIdentityAlloc">7,778 VIWO</td>
                                    <td>5%</td>
                                    <td>250 verified users</td>
                                    <td id="flowIdentityAvg">31 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Referrals</strong></td>
                                    <td id="flowReferralAlloc">7,778 VIWO</td>
                                    <td>5%</td>
                                    <td>100 referrers</td>
                                    <td id="flowReferralAvg">78 VIWO</td>
                                </tr>
                                <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                    <td>TOTAL DAILY DISTRIBUTION</td>
                                    <td id="flowTotalAlloc">155,556 VIWO</td>
                                    <td>100%</td>
                                    <td>~1,500 recipients</td>
                                    <td id="flowTotalAvg">104 VIWO avg</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-recycle"></i> Reward Recapture by Module (Monthly - Real-Time)</div>
                        <div class="alert-box alert-warning" style="margin-bottom: 15px;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>Important:</strong> Modules do NOT emit tokens! Only the Rewards module emits (5.83M VIWO/month). Users earn rewards, then spend them on module features. This table shows how much VIWO is recaptured from each module's user spending.
                            </div>
                        </div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Module</th><th>Est. Revenue Share</th><th>Fees (Burn+Treasury)</th><th>Buybacks/Other</th><th>Staking</th><th>Total Recaptured</th><th>% of Total Emission</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Identity</strong></td>
                                    <td id="rfIdentityEmission">~5%<br><span style="font-size: 11px;">(Revenue)</span></td>
                                    <td id="rfIdentityFees">0 VIWO</td>
                                    <td id="rfIdentityBuyback">0 VIWO</td>
                                    <td id="rfIdentityStaking">0 VIWO</td>
                                    <td id="rfIdentityTotal">0 VIWO</td>
                                    <td id="rfIdentityPercent" style="color: var(--success-color); font-weight: 600;">0%</td>
                                </tr>
                                <tr>
                                    <td><strong>Content</strong></td>
                                    <td id="rfContentEmission">2,333,333 VIWO<br><span style="font-size: 11px;">(40%)</span></td>
                                    <td id="rfContentFees">0 VIWO</td>
                                    <td id="rfContentBuyback">0 VIWO</td>
                                    <td id="rfContentStaking">0 VIWO</td>
                                    <td id="rfContentTotal">0 VIWO</td>
                                    <td id="rfContentPercent" style="color: var(--success-color); font-weight: 600;">0%</td>
                                </tr>
                                <tr>
                                    <td><strong>Community</strong></td>
                                    <td id="rfCommunityEmission">583,333 VIWO<br><span style="font-size: 11px;">(10%)</span></td>
                                    <td id="rfCommunityFees">0 VIWO</td>
                                    <td id="rfCommunityBuyback">0 VIWO</td>
                                    <td id="rfCommunityStaking">0 VIWO</td>
                                    <td id="rfCommunityTotal">0 VIWO</td>
                                    <td id="rfCommunityPercent" style="color: var(--success-color); font-weight: 600;">0%</td>
                                </tr>
                                <tr>
                                    <td><strong>Advertising</strong></td>
                                    <td id="rfAdvertisingEmission">875,000 VIWO<br><span style="font-size: 11px;">(15%)</span></td>
                                    <td id="rfAdvertisingFees">0 VIWO</td>
                                    <td id="rfAdvertisingBuyback">0 VIWO</td>
                                    <td id="rfAdvertisingStaking">0 VIWO</td>
                                    <td id="rfAdvertisingTotal">0 VIWO</td>
                                    <td id="rfAdvertisingPercent" style="color: var(--success-color); font-weight: 600;">0%</td>
                                </tr>
                                <tr>
                                    <td><strong>Messaging</strong></td>
                                    <td id="rfMessagingEmission">583,333 VIWO<br><span style="font-size: 11px;">(10%)</span></td>
                                    <td id="rfMessagingFees">0 VIWO</td>
                                    <td id="rfMessagingBuyback">0 VIWO</td>
                                    <td id="rfMessagingStaking">0 VIWO</td>
                                    <td id="rfMessagingTotal">0 VIWO</td>
                                    <td id="rfMessagingPercent" style="color: var(--success-color); font-weight: 600;">0%</td>
                                </tr>
                                <tr>
                                    <td><strong>Rewards Pool</strong></td>
                                    <td id="rfRewardsEmission">1,166,667 VIWO<br><span style="font-size: 11px;">(20%)</span></td>
                                    <td colspan="4" style="text-align: center; font-style: italic;">Distributed to users for activities (curation, moderation, engagement, referrals)</td>
                                    <td>-</td>
                                </tr>
                                <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                    <td>TOTAL ECOSYSTEM</td>
                                    <td>5,833,333 VIWO</td>
                                    <td id="rfTotalFees">0 VIWO</td>
                                    <td id="rfTotalBuyback">0 VIWO</td>
                                    <td id="rfTotalStaking">0 VIWO</td>
                                    <td id="rfTotalRecaptured">0 VIWO</td>
                                    <td id="rfTotalPercent" style="color: var(--success-color);">0%</td>
                                </tr>
                            </tbody>
                        </table>
                        <p id="rfCircularEconomySummary" style="margin-top: 16px; font-size: 13px; color: var(--text-secondary);">
                            <strong>Circular Economy Impact:</strong> Calculating...
                        </p>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-chart-line"></i> Buyback Program Details</div>
                        <div class="subsection">
                            <div class="subsection-title">How USD Profits Convert to Token Buybacks</div>
                            <table class="table-custom">
                                <thead>
                                    <tr><th>Module</th><th>M1 USD Profit</th><th>Buyback Allocation (25%)</th><th>VIWO Bought @ $0.03</th><th>Buyback Strategy</th></tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Identity</td>
                                        <td>$650</td>
                                        <td>$0</td>
                                        <td>0 VIWO</td>
                                        <td>All profits reinvested in infrastructure</td>
                                    </tr>
                                    <tr>
                                        <td>Content</td>
                                        <td>$1,424</td>
                                        <td>$356</td>
                                        <td>11,867 VIWO</td>
                                        <td>Weekly open market purchases</td>
                                    </tr>
                                    <tr>
                                        <td>Community</td>
                                        <td>$850</td>
                                        <td>$85</td>
                                        <td>2,833 VIWO</td>
                                        <td>Buyback + burn 50%</td>
                                    </tr>
                                    <tr>
                                        <td>Advertising</td>
                                        <td>$700</td>
                                        <td>$70</td>
                                        <td>2,333 VIWO</td>
                                        <td>Monthly buyback auctions</td>
                                    </tr>
                                    <tr>
                                        <td>Messaging</td>
                                        <td>$187</td>
                                        <td>$19</td>
                                        <td>633 VIWO</td>
                                        <td>Quarterly buybacks</td>
                                    </tr>
                                    <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                        <td>TOTAL</td>
                                        <td>$3,811</td>
                                        <td>$530</td>
                                        <td>17,666 VIWO</td>
                                        <td>-</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px; font-size: 13px;">
                                <strong>Buyback Mechanics:</strong> 25% of each module's USD profits are allocated to systematic buyback programs. Tokens are purchased from open market through DEX aggregators, creating constant buy pressure. 50% of bought tokens are burned permanently, 50% locked in treasury for future rewards or liquidity provision.
                            </p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-lock"></i> Staking Mechanisms by Module</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Staking Program</th><th>Required Stake</th><th>Lock Period</th><th>Benefits</th><th>Est. M1 Participants</th><th>Total Staked</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Identity: Premium Tier</strong></td>
                                    <td>500 VIWO</td>
                                    <td>3 months</td>
                                    <td>1.4x rewards, API access, analytics</td>
                                    <td>40 users</td>
                                    <td>20,000 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Content: Creator Pro</strong></td>
                                    <td>1,000 VIWO</td>
                                    <td>6 months</td>
                                    <td>NFT tools, sponsorships, priority support</td>
                                    <td>45 creators</td>
                                    <td>45,000 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Community: DAO Founder</strong></td>
                                    <td>2,000 VIWO</td>
                                    <td>12 months</td>
                                    <td>Governance tools, treasury mgmt, grants</td>
                                    <td>15 DAOs</td>
                                    <td>30,000 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Curation: Quality Curator</strong></td>
                                    <td>250 VIWO</td>
                                    <td>1 month</td>
                                    <td>2x curation rewards, early access</td>
                                    <td>60 curators</td>
                                    <td>15,000 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Moderation: Trusted Mod</strong></td>
                                    <td>500 VIWO</td>
                                    <td>6 months</td>
                                    <td>Mod tools, 1.5x rewards, voting power</td>
                                    <td>50 mods</td>
                                    <td>25,000 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Referral: Ambassador</strong></td>
                                    <td>1,000 VIWO</td>
                                    <td>3 months</td>
                                    <td>Higher referral %, exclusive swag</td>
                                    <td>10 ambassadors</td>
                                    <td>10,000 VIWO</td>
                                </tr>
                                <tr>
                                    <td><strong>Community: Member Plus</strong></td>
                                    <td>100 VIWO</td>
                                    <td>1 month</td>
                                    <td>Access to token-gated communities</td>
                                    <td>50 members</td>
                                    <td>5,000 VIWO</td>
                                </tr>
                                <tr style="background: var(--bg-tertiary); font-weight: 700;">
                                    <td>TOTAL STAKED</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>270 participants</td>
                                    <td>150,000 VIWO</td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);">
                            <strong>Staking Impact:</strong> 150,000 VIWO (2.6% of monthly emissions) is locked in various staking programs. These tokens are temporarily removed from circulation, creating scarcity while providing users with enhanced features and higher rewards. As lock periods expire, users typically re-stake to maintain benefits, creating long-term token retention.
                        </p>
                    </div>
                </section>

                <!-- Liquidity Depth & ADTV Analytics Section -->
                <section id="liquidity" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);">
                            <i class="fas fa-water"></i>
                        </div>
                        <div class="module-title">
                            <h2>Liquidity Depth & Trading Analytics</h2>
                            <p>Market Health, Slippage Analysis & Trading Volume Projections</p>
                        </div>
                    </div>

                    <div class="alert-box alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Purpose:</strong> Ensure healthy trading environment with adequate liquidity to prevent price manipulation and provide smooth user experience.
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-chart-line"></i> Key Liquidity Metrics</div>
                        <div class="metrics-grid">
                            <div class="metric-box metric-box-success">
                                <div class="metric-box-value">$<span id="tgeLiquidity">2.50</span>M</div>
                                <div class="metric-box-label">TGE Liquidity Pool</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    <span id="tgeLiquidityTokens">83.33</span>M VIWO + USDC
                                </div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value">$<span id="adtvMonth1">50</span>K</div>
                                <div class="metric-box-label">ADTV Target (Month 1)</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    Average daily trading volume
                                </div>
                            </div>
                            <div class="metric-box metric-box-success">
                                <div class="metric-box-value"><span id="liquidityRatio">11.9</span>%</div>
                                <div class="metric-box-label">Liquidity Ratio</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    Liquidity / Market Cap (Target: >5%)
                                </div>
                            </div>
                            <div class="metric-box metric-box-success">
                                <div class="metric-box-value"><span id="slippage10k">1.2</span>%</div>
                                <div class="metric-box-label">Slippage ($10K trade)</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    $50K trade: <span id="slippage50k">3.5</span>%
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-heartbeat"></i> Liquidity Health Indicators</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Metric</th><th>Current</th><th>Target</th><th>Status</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Liquidity Depth</td>
                                    <td>$<span id="liquidityDepthValue">2.50</span>M</td>
                                    <td>$2M+</td>
                                    <td style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Healthy</td>
                                </tr>
                                <tr>
                                    <td>Market Cap (TGE)</td>
                                    <td>$<span id="marketCapTGE">21.0</span>M</td>
                                    <td>$10M+</td>
                                    <td style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Good</td>
                                </tr>
                                <tr>
                                    <td>Liquidity / MC Ratio</td>
                                    <td><span id="liquidityRatioTable">11.9</span>%</td>
                                    <td>>5%</td>
                                    <td style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Excellent</td>
                                </tr>
                                <tr>
                                    <td>Slippage (10K USD)</td>
                                    <td><span id="slippage10kTable">1.2</span>%</td>
                                    <td><2%</td>
                                    <td style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Low</td>
                                </tr>
                                <tr>
                                    <td>Slippage (50K USD)</td>
                                    <td><span id="slippage50kTable">3.5</span>%</td>
                                    <td><5%</td>
                                    <td style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Acceptable</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-lightbulb"></i>
                        <div>
                            <strong>Liquidity Strategy:</strong>
                            <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                                <li><strong>Initial Pool:</strong> $2.5M USDC + <span id="liquidityStrategyTokens">83.33</span>M VIWO on Uniswap V3</li>
                                <li><strong>Concentrated Liquidity:</strong> 10% price range for capital efficiency</li>
                                <li><strong>Liquidity Mining:</strong> Additional 2M VIWO/month incentives for LP providers</li>
                                <li><strong>Market Making:</strong> Partner with professional MMs for 24/7 liquidity</li>
                                <li><strong>CEX Listings:</strong> Target Tier-1 exchanges (Binance, Coinbase) by Month 6</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- 60-Month Velocity & Growth Analysis -->
                <section id="velocity" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="module-title">
                            <h2>60-Month Token Velocity & Growth Projection</h2>
                            <p>Long-Term Sustainability & Circulation Analysis</p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-tachometer-alt"></i> Key 60-Month Metrics</div>
                        <div class="metrics-grid">
                            <div class="metric-box">
                                <div class="metric-box-value"><span id="total60Emissions">350</span>M</div>
                                <div class="metric-box-label">Total Emissions (60mo)</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    5.833M VIWO/month fixed
                                </div>
                            </div>
                            <div class="metric-box metric-box-success">
                                <div class="metric-box-value"><span id="total60Recaptured">85</span>M</div>
                                <div class="metric-box-label">Total Recaptured (60mo)</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    <span id="recapture60Percent">24.3</span>% average rate
                                </div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value"><span id="net60Circulation">265</span>M</div>
                                <div class="metric-box-label">Net Circulation Added</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    After recapture mechanisms
                                </div>
                            </div>
                            <div class="metric-box metric-box-success">
                                <div class="metric-box-value"><span id="avgVelocity">8.5</span>x</div>
                                <div class="metric-box-label">Average Velocity</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                    Transactions per token/year
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-info-circle"></i> Velocity Interpretation</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Velocity Range</th><th>Status</th><th>Meaning</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>0 - 2x</td><td style="color: var(--danger-color);">Low</td><td>Tokens hoarded, limited utility</td></tr>
                                <tr style="background: rgba(52, 211, 153, 0.1);"><td>2 - 10x</td><td style="color: var(--success-color);"> Healthy</td><td>Active usage & circulation (VIWO: 8.5x)</td></tr>
                                <tr><td>10 - 50x</td><td style="color: var(--warning-color);">High</td><td>Very frequent transactions</td></tr>
                                <tr><td>50x+</td><td style="color: var(--danger-color);">Excessive</td><td>Potential sell pressure</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Long-Term Sustainability Summary:</strong>
                            <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                                <li><strong>Controlled Inflation:</strong> Net circulation +75% over 5 years (350M TGE  615M Month 60)</li>
                                <li><strong>Strong Recapture:</strong> 24.3% average (above 15% industry benchmark)</li>
                                <li><strong>Healthy Velocity:</strong> 8.5x indicates strong utility without excessive sell pressure</li>
                                <li><strong>User Growth:</strong> 1K  50K+ users by Month 60 (7% monthly growth, tapering)</li>
                                <li><strong>Revenue Growth:</strong> Exceeds costs by Month 8, creating positive feedback loop</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- System Summary -->
                <section id="system-summary" class="module-section">
                    <div class="module-header">
                        <div class="module-icon" style="background: linear-gradient(135deg, #191919 0%, #242424 100%);">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="module-title">
                            <h2>System Summary</h2>
                            <p>Complete Economic Analysis & Sustainability Metrics</p>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-trophy"></i> Key Achievements (Real-Time)</div>
                        <div class="metrics-grid">
                            <div class="metric-box">
                                <div class="metric-box-value">Day 1</div>
                                <div class="metric-box-label">All Modules Profitable</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="summaryRevenue">$0</div>
                                <div class="metric-box-label">M1 Total Revenue</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="summaryProfit">$0</div>
                                <div class="metric-box-label">M1 Net Profit</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="summaryMargin">0%</div>
                                <div class="metric-box-label">Profit Margin</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="summaryRecapture">0%</div>
                                <div class="metric-box-label">Reward Recapture Rate</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-box-value" id="summaryEmissions">5.83M</div>
                                <div class="metric-box-label">Monthly Emissions (VIWO)</div>
                            </div>
                        </div>
                    </div>

                    <div class="alert-box alert-success">
                        <i class="fas fa-check-double"></i>
                        <div id="summaryMissionAccomplished">
                            <strong>Mission 100% Accomplished:</strong>
                            <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                                <li> Loading...</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card-custom">
                        <div class="card-title"><i class="fas fa-balance-scale"></i> Sustainability Analysis</div>
                        <table class="table-custom">
                            <thead>
                                <tr><th>Metric</th><th>Month 1</th><th>Month 12</th><th>Month 60</th><th>Trend</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Active Users</td>
                                    <td>1,000</td>
                                    <td>4,000</td>
                                    <td>80,000</td>
                                    <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                                </tr>
                                <tr>
                                    <td>Monthly Revenue</td>
                                    <td>$6,411</td>
                                    <td>$25,644</td>
                                    <td>$512,880</td>
                                    <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                                </tr>
                                <tr>
                                    <td>Monthly Costs</td>
                                    <td>$2,600</td>
                                    <td>$3,200</td>
                                    <td>$5,800</td>
                                    <td><i class="fas fa-arrow-up" style="color: var(--warning-color);"></i></td>
                                </tr>
                                <tr>
                                    <td>Monthly Profit</td>
                                    <td>$3,811</td>
                                    <td>$22,444</td>
                                    <td>$507,080</td>
                                    <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                                </tr>
                                <tr>
                                    <td>Profit Margin</td>
                                    <td>59%</td>
                                    <td>87%</td>
                                    <td>99%</td>
                                    <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                                </tr>
                                <tr>
                                    <td>Rewards Emitted</td>
                                    <td>5.83M VIWO</td>
                                    <td>5.83M VIWO</td>
                                    <td>5.83M VIWO</td>
                                    <td><i class="fas fa-minus" style="color: var(--info-color);"></i> Fixed</td>
                                </tr>
                                <tr>
                                    <td>Rewards Recaptured</td>
                                    <td>1.07M VIWO</td>
                                    <td>1.85M VIWO</td>
                                    <td>3.50M VIWO</td>
                                    <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                                </tr>
                                <tr>
                                    <td>Recapture Rate</td>
                                    <td>18.3%</td>
                                    <td>31.7%</td>
                                    <td>60.0%</td>
                                    <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 16px; font-size: 13px; color: var(--text-secondary);">
                            <strong>Long-term Sustainability:</strong> As the protocol grows, costs increase slowly (economies of scale) while revenue grows exponentially (network effects). Profit margins improve from 59% to 99% by Month 60. Simultaneously, reward recapture rate improves from 18.3% to 60% as more users engage in staking, trading, and premium features. By Month 60, the protocol becomes almost entirely self-sustaining with 60% of emissions returning to the treasury.
                        </p>
                    </div>
                </section>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global state for interactive calculations
        // ============================================================================
        // CENTRALIZED CONFIGURATION - Single Source of Truth for All Calculations
        // ============================================================================
        const CONFIG = {
            // Tokenomics Constants
            // ONLY Rewards Module emits tokens (350M over 60 months)
            // Users receive rewards, then spend VIWO on module features
            MONTHLY_EMISSION: Math.floor(350000000 / 60), // 5,833,333 tokens/month (ALL from Rewards)

            // Revenue Distribution (NOT emission allocation!)
            // This shows estimated revenue distribution across modules for recapture calculations
            // Users spend their reward tokens on these modules
            MODULE_REVENUE_SHARE: {
                IDENTITY: 0.05,      // ~5% of revenue
                CONTENT: 0.40,       // ~40% of revenue
                COMMUNITY: 0.10,     // ~10% of revenue
                ADVERTISING: 0.15,   // ~15% of revenue
                MESSAGING: 0.10,     // ~10% of revenue
                OTHER: 0.20          // ~20% other/misc
            },

            // Fee Distribution (must sum to 100%)
            FEE_DISTRIBUTION: {
                BURN: 0.20,          // 20%
                TREASURY: 0.50,      // 50%
                REWARDS: 0.30        // 30%
            },

            // Fee Collection Rates
            FEE_COLLECTION_RATE: 0.05,  // Only 5% of actions actually collect VIWO fees

            // Staking Parameters
            STAKING: {
                IDENTITY_CAP_PERCENT: 0.50,        // 50% of module allocation
                IDENTITY_PREMIUM_MULTIPLIER: 0.10,  // 10% of premium price
                CONTENT_SUBSCRIPTION_MULTIPLIER: 3, // 3x subscription fee
                CONTENT_PARTICIPATION_RATE: 0.50,   // 50% of premium subscribers
                COMMUNITY_PARTICIPATION_RATE: 0.30, // 30% of communities
                COMMUNITY_FEE_MULTIPLIER: 5,        // 5x average community fee
                ADVERTISING_CAMPAIGN_MULTIPLIER: 2, // 2x campaign fee
                MESSAGING_PREMIUM_MULTIPLIER: 3     // 3x premium fee
            },

            // Special Recapture Rates
            SPECIAL_RECAPTURE: {
                EVENT_FEES: 0.70,    // 70% of event fees recaptured
                FILE_FEES: 0.70      // 70% of file transfer fees recaptured
            },

            // Token Supply Constants (Based on Real Tokenomics)
            SUPPLY: {
                TOTAL: 1000000000,          // 1B total supply (1,000,000,000)
                TGE_CIRCULATING: 158833333, // 158.8M circulating at TGE (15.88%)
                ECOSYSTEM_REWARDS: 350000000, // 350M for Ecosystem & Rewards (35%)
                LIQUIDITY: 100000000,       // 100M for Liquidity (10%)
                VESTING: 550000000          // 550M locked/vesting (other allocations)
            },

            // ABSOLUTE CAPS - Hard limits that can NEVER be exceeded
            ABSOLUTE_CAPS: {
                // Maximum recapture per module (as % of monthly module emissions)
                // This prevents recapture from exceeding what was actually emitted
                MAX_RECAPTURE_RATE: 0.95,   // Max 95% recapture rate per module

                // Global monthly burn limit (% of circulating supply)
                // Prevents burning more than 10% of circulating supply per month
                MONTHLY_BURN_LIMIT: 0.10,

                // Global monthly buyback limit (% of circulating supply)
                // Prevents buyback demand exceeding reasonable market liquidity
                MONTHLY_BUYBACK_LIMIT: 0.05,

                // Global monthly staking limit (% of circulating supply)
                // Prevents unrealistic staking requirements
                MONTHLY_STAKING_LIMIT: 0.15
            },

            // Caps for various recapture mechanisms (relative to module emissions)
            CAPS: {
                ADVERTISING_BUYBACK: 0.80,   // Max 80% of advertising emissions
                ADVERTISING_DEPOSITS: 0.25,  // Max 25% of advertising emissions
                IDENTITY_STAKING: 0.40,      // Max 40% of identity emissions
                CONTENT_STAKING: 0.40,       // Max 40% of content emissions
                COMMUNITY_STAKING: 0.40,     // Max 40% of community emissions
                MESSAGING_STAKING: 0.40      // Max 40% of messaging emissions
            },

            // NFT/Marketplace Defaults (now parameterizable)
            MARKETPLACE: {
                AVG_PROFILE_PRICE_USD: 100,
                AVG_NFT_PRICE_USD: 50,
                MONTHLY_NFT_SALES: 50
            },

            // Display Precision
            PRECISION: {
                DISPLAY: 2,          // 2 decimals for UI display
                EXPORT: 2,           // 2 decimals for export
                PERCENTAGE: 1        // 1 decimal for percentages
            },

            // User Distribution Defaults
            USER_DISTRIBUTION: {
                IDENTITY_TIERS: {
                    BASIC: 0.60,     // 60%
                    VERIFIED: 0.30,  // 30%
                    PREMIUM: 0.08,   // 8%
                    ENTERPRISE: 0.02 // 2%
                },
                CONTENT_TYPES: {
                    TEXT: 0.60,      // 60%
                    IMAGE: 0.30,     // 30%
                    VIDEO: 0.08,     // 8%
                    NFT: 0.02        // 2%
                },
                COMMUNITY_SIZES: {
                    SMALL: 0.50,     // 50%
                    MEDIUM: 0.30,    // 30%
                    LARGE: 0.15,     // 15%
                    ENTERPRISE: 0.05 // 5%
                },
                AD_FORMATS: {
                    BANNER: 0.70,    // 70%
                    VIDEO: 0.30      // 30%
                }
            },

            // Activity Rates
            ACTIVITY_RATES: {
                PROFILE_TRANSFERS: 0.10,        // 10% monthly
                PREMIUM_SUBSCRIBERS: 0.05,      // 5% of users
                BOOSTED_POSTS: 0.10,            // 10% of posts
                PROMOTED_POSTS: 0.05,           // 5% of posts
                ADVERTISERS: 0.02,              // 2% of users
                AD_ANALYTICS_SUBSCRIBERS: 0.10, // 10% of advertisers
                USERS_PER_COMMUNITY: 10,        // users / 10
                COMMUNITY_EVENTS: 0.20,         // 20% of communities
                VERIFIED_COMMUNITIES: 0.10,     // 10% of communities
                COMMUNITY_ANALYTICS_ELIGIBLE: 0.15, // 15% of med+large+ent
                MESSAGES_PER_USER: 100,         // per month
                REGULAR_MESSAGES: 0.80,         // 80%
                ENCRYPTED_MESSAGES: 0.20,       // 20%
                GROUP_CHAT_USERS: 0.30,         // 30% of users
                FILES_PER_USER: 5,              // per month
                CALL_USERS: 0.10,               // 10% of users
                AVG_CALL_MINUTES: 30,           // minutes
                STORAGE_SUBSCRIBERS: 0.20,      // 20% of users
                MESSAGING_PREMIUM_USERS: 0.15,  // 15% of users
                ADS_PER_USER: 50                // per month
            },

            // Cost Scaling Parameters
            COST_SCALING: {
                IDENTITY: {
                    BASE: 500,
                    USER_EXPONENT: 0.7,
                    POST_EXPONENT: 1.0
                },
                CONTENT: {
                    BASE: 800,
                    USER_EXPONENT: 0.75,
                    POST_EXPONENT: 0.6
                },
                ADVERTISING: {
                    BASE: 600,
                    USER_EXPONENT: 0.7,
                    POST_EXPONENT: 1.0
                },
                COMMUNITY: {
                    BASE: 400,
                    USER_EXPONENT: 0.6,
                    POST_EXPONENT: 1.0
                },
                MESSAGING: {
                    BASE: 300,
                    USER_EXPONENT: 0.6,
                    POST_EXPONENT: 1.0
                },
                REWARDS: {
                    BASE: 200,
                    USER_EXPONENT: 1.0,
                    POST_EXPONENT: 1.0
                }
            },

            // Growth Projection Multipliers
            PROJECTIONS: {
                // Growth rates
                USER_GROWTH_RATE_MONTH_12: 1.07,  // 7% monthly user growth
                USER_GROWTH_RATE_MONTH_60: 1.05,  // 5% monthly user growth (tapering)

                // Month 12 multipliers (7% monthly growth)
                MONTH_12: {
                    REVENUE: 4,           // Conservative 4x revenue growth
                    COSTS: 1.23,          // ~23% cost increase (economies of scale)
                    RECAPTURE: 1.73       // Recapture grows with engagement
                },
                // Month 60 multipliers (5% monthly growth from month 12)
                MONTH_60: {
                    REVENUE: 80,          // Conservative 80x revenue growth
                    COSTS: 2.23,          // Costs grow much slower than revenue
                    RECAPTURE: 3.27       // Strong recapture improvement
                }
            },

            // Helper functions for precision control
            round: function(value, decimals = this.PRECISION.DISPLAY) {
                return Math.round(value * Math.pow(10, decimals)) / Math.pow(10, decimals);
            },

            format: function(value, type = 'display') {
                const decimals = type === 'percentage' ? this.PRECISION.PERCENTAGE : this.PRECISION[type.toUpperCase()];
                return this.round(value, decimals);
            }
        };

        // ============================================================================
        // SUPPLY TRACKING & SAFETY CAPS
        // Ensures recapture never exceeds physically possible limits
        // ============================================================================

        // Global tracker for circulating supply (updates each calculation cycle)
        let circulatingSupply = CONFIG.SUPPLY.TGE_CIRCULATING;

        /**
         * Apply absolute safety caps to prevent impossible recapture amounts
         * @param {number} requestedAmount - Requested recapture amount
         * @param {string} type - Type of recapture (burn, buyback, staking)
         * @param {number} moduleEmissions - Module's monthly emissions
         * @returns {number} - Capped amount that respects all limits
         */
        function applySafetyCaps(requestedAmount, type, moduleEmissions) {
            // Cap 1: Never exceed module emissions (can't recapture more than emitted)
            let capped = Math.min(requestedAmount, moduleEmissions * CONFIG.ABSOLUTE_CAPS.MAX_RECAPTURE_RATE);

            // Cap 2: Apply type-specific global limits (% of circulating supply)
            const circulatingLimit = {
                'burn': circulatingSupply * CONFIG.ABSOLUTE_CAPS.MONTHLY_BURN_LIMIT,
                'buyback': circulatingSupply * CONFIG.ABSOLUTE_CAPS.MONTHLY_BUYBACK_LIMIT,
                'staking': circulatingSupply * CONFIG.ABSOLUTE_CAPS.MONTHLY_STAKING_LIMIT,
                'treasury': circulatingSupply * 0.20, // Max 20% of supply to treasury per month
                'other': circulatingSupply * 0.05     // Max 5% for royalties/special
            };

            if (circulatingLimit[type]) {
                capped = Math.min(capped, circulatingLimit[type]);
            }

            // Cap 3: Never go negative
            capped = Math.max(0, capped);

            return capped;
        }

        // ============================================================================
        // UNIFIED RECAPTURE CALCULATION ENGINE
        // Single source of truth for all recapture calculations
        // ============================================================================

        /**
         * Calculate module recapture with unified logic AND safety caps
         * IMPORTANT: Modules do NOT emit tokens! Only Rewards module emits.
         * This function calculates how much VIWO is recaptured from user spending in each module.
         *
         * @param {Object} options - Recapture calculation options
         * @returns {Object} - Recapture breakdown
         */
        function calculateModuleRecapture(options) {
            const {
                moduleName,
                moduleAllocation, // This is for proportional distribution only, NOT emission!
                transactionFeesVIWO = 0,
                stakingConfig = null,
                specialRecaptures = {},
                royaltiesVIWO = 0,
                buybackConfig = null
            } = options;

            // NO module emissions! Only used for safety cap calculations relative to total emission
            const totalMonthlyEmission = CONFIG.MONTHLY_EMISSION;

            // Calculate fee-based recaptures (burn + treasury) - RAW amounts first
            // NO intermediate rounding - keep full precision
            // Use ADAPTIVE burn rate based on current recapture performance
            const adaptiveBurnRate = calculateAdaptiveBurnRate(currentGlobalRecaptureRate, params.burnRate);
            let rawBurnVIWO = transactionFeesVIWO * adaptiveBurnRate;
            const remainingFees = 1 - adaptiveBurnRate;
            const treasuryShare = CONFIG.FEE_DISTRIBUTION.TREASURY / (CONFIG.FEE_DISTRIBUTION.TREASURY + CONFIG.FEE_DISTRIBUTION.REWARDS);
            let rawTreasuryVIWO = transactionFeesVIWO * remainingFees * treasuryShare;
            const rewardsVIWO = transactionFeesVIWO * remainingFees * (1 - treasuryShare);

            // Calculate staking recapture - RAW amount first
            let rawStakingVIWO = 0;
            if (stakingConfig) {
                const uncappedStaking = stakingConfig.amount;
                // Cap against a reasonable portion of total emission (not "module emission")
                const stakingCap = stakingConfig.cap || (totalMonthlyEmission * 0.15); // Max 15% of total emission
                rawStakingVIWO = Math.min(uncappedStaking, stakingCap);
            }

            // Calculate special recaptures (events, files, etc.)
            let specialRecaptureTotal = 0;
            for (const [key, amount] of Object.entries(specialRecaptures)) {
                specialRecaptureTotal += amount;
            }

            // Calculate buyback (capped) - RAW amount first
            let rawBuybackVIWO = 0;
            if (buybackConfig) {
                const uncappedBuyback = buybackConfig.amount;
                // Cap against a reasonable portion of total emission
                const buybackCap = buybackConfig.cap || (totalMonthlyEmission * 0.05); // Max 5% of total emission
                rawBuybackVIWO = Math.min(uncappedBuyback, buybackCap);
            }

            // APPLY SAFETY CAPS - This prevents impossible recapture amounts
            // All caps are against TOTAL emission, not "module emission" (which doesn't exist!)
            const burnVIWO = applySafetyCaps(rawBurnVIWO, 'burn', totalMonthlyEmission);
            const treasuryVIWO = applySafetyCaps(rawTreasuryVIWO, 'treasury', totalMonthlyEmission);
            const stakingVIWO = applySafetyCaps(rawStakingVIWO, 'staking', totalMonthlyEmission);
            const buybackVIWO = applySafetyCaps(rawBuybackVIWO, 'buyback', totalMonthlyEmission);
            const royaltiesVIWOCapped = applySafetyCaps(royaltiesVIWO, 'other', totalMonthlyEmission);
            const specialCapped = applySafetyCaps(specialRecaptureTotal, 'other', totalMonthlyEmission);

            // Total recaptured from this module (NO rounding until display)
            const totalRecaptured = burnVIWO + treasuryVIWO + stakingVIWO + specialCapped + royaltiesVIWOCapped + buybackVIWO;

            // Calculate a "virtual recapture rate" for this module
            // This shows how much is recaptured relative to total monthly emission
            const recaptureRate = (totalRecaptured / totalMonthlyEmission) * 100;

            return {
                burnVIWO,
                treasuryVIWO,
                rewardsVIWO,
                stakingVIWO,
                specialRecaptures: { total: specialCapped },
                royaltiesVIWO: royaltiesVIWOCapped,
                buybackVIWO,
                totalRecaptured: totalRecaptured,
                recaptureRate: recaptureRate,
                // DEPRECATED: Modules don't emit! This is for backward compatibility only
                moduleEmissions: 0  // Set to 0 to indicate no emission from this module
            };
        }

        // Global state for interactive calculations
        // Global state for adaptive calculations
        let currentGlobalRecaptureRate = 0;

        let params = {
            tokenPrice: 0.03,
            startingUsers: 1000,
            growthRate: 0.07,
            burnRate: CONFIG.FEE_DISTRIBUTION.BURN,  // Use CONFIG default
            verificationRate: 0.25,
            postsPerUser: 20,
            buybackPercent: 0.25,
            adCPM: 1.0,
            rewardAllocationPercent: 0.90,  // 90% of 350M Ecosystem & Rewards allocation (default)
            // Identity Module pricing (USD)
            basicPrice: 1,
            verifiedPrice: 7,
            premiumPrice: 19,
            enterprisePrice: 124,
            transferFee: 3,
            saleCommission: 0.05,
            monthlySales: CONFIG.MARKETPLACE.MONTHLY_NFT_SALES,  // Use CONFIG default
            // Content Module pricing (USD)
            textPostFee: 0.05,
            imagePostFee: 0.10,
            videoPostFee: 0.25,
            nftMintFee: 2,
            premiumContentSub: 5,
            contentBoostFee: 1,
            contentSaleCommission: 0.10,
            // Community Module pricing (USD)
            smallCommunityFee: 3,
            mediumCommunityFee: 10,
            largeCommunityFee: 25,
            enterpriseCommunityFee: 100,
            eventHostingFee: 5,
            communityVerificationFee: 20,
            communityAnalyticsFee: 15,
            // Advertising Module pricing (USD)
            bannerCPM: 15,
            videoCPM: 40,
            promotedPostFee: 3,
            campaignManagementFee: 50,
            adAnalyticsFee: 30,
            // Messaging Module pricing (USD)
            encryptedDMFee: 0.02,
            groupChatFee: 1,
            fileTransferFee: 0.10,
            voiceCallFee: 0.05,
            messageStorageFee: 2,
            messagingPremiumFee: 5,
            // Reward Distribution Parameters
            textPostPoints: 10,
            imagePostPoints: 20,
            videoPostPoints: 50,
            likePoints: 1,
            commentPoints: 8,
            sharePoints: 10,
            followPoints: 2,
            maxPostsPerDay: 50,
            maxLikesPerDay: 500,
            maxCommentsPerDay: 200,
            highQualityMultiplier: 3.0,
            verifiedMultiplier: 1.4,
            premiumMultiplier: 1.8,
            day7Decay: 70,
            day30Decay: 20,
            maxDailyRewardUSD: 50  // Max $50/day per user (prevents excessive rewards with low user count)
        };

        // Initialize everything on page load
        document.addEventListener('DOMContentLoaded', function() {
            setupNavigation();
            resetToDefaults();
            recalculateAll();
        });

        function setupNavigation() {
            const navLinks = document.querySelectorAll('.module-nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });
        }

        function updateSliderValue(id) {
            const slider = document.getElementById(id);
            const display = document.getElementById(id + 'Value');
            const value = slider.value;

            if (id === 'growthRate' || id === 'burnRate' || id === 'verificationRate' || id === 'buybackPercent' ||
                id === 'adCPM' || id === 'saleCommission' || id === 'contentSaleCommission' || id === 'rewardAllocationPercent') {
                display.textContent = value + '%';
            } else if (id === 'postsPerUser') {
                display.textContent = value;
            } else {
                display.textContent = value;
            }
        }

        function loadPreset(preset) {
            switch(preset) {
                case 'conservative':
                    document.getElementById('tokenPrice').value = 0.02;
                    document.getElementById('startingUsers').value = 500;
                    document.getElementById('growthRate').value = 3;
                    document.getElementById('burnRate').value = 15;
                    document.getElementById('verificationRate').value = 15;
                    document.getElementById('postsPerUser').value = 10;
                    document.getElementById('buybackPercent').value = 10;
                    document.getElementById('adCPM').value = 70;
                    break;
                case 'base':
                    resetToDefaults();
                    return;
                case 'aggressive':
                    document.getElementById('tokenPrice').value = 0.03;
                    document.getElementById('startingUsers').value = 2000;
                    document.getElementById('growthRate').value = 15;
                    document.getElementById('burnRate').value = 25;
                    document.getElementById('verificationRate').value = 35;
                    document.getElementById('postsPerUser').value = 35;
                    document.getElementById('buybackPercent').value = 40;
                    document.getElementById('adCPM').value = 130;
                    break;
                case 'bull':
                    document.getElementById('tokenPrice').value = 0.15;
                    document.getElementById('startingUsers').value = 1000;
                    document.getElementById('growthRate').value = 10;
                    document.getElementById('burnRate').value = 30;
                    document.getElementById('verificationRate').value = 30;
                    document.getElementById('postsPerUser').value = 25;
                    document.getElementById('buybackPercent').value = 35;
                    document.getElementById('adCPM').value = 120;
                    break;
            }

            ['growthRate', 'burnRate', 'verificationRate', 'postsPerUser', 'buybackPercent', 'adCPM'].forEach(id => {
                updateSliderValue(id);
            });

            recalculateAll();
        }

        function resetToDefaults() {
            document.getElementById('tokenPrice').value = 0.03;
            document.getElementById('startingUsers').value = 1000;
            document.getElementById('growthRate').value = 7;
            document.getElementById('burnRate').value = 20;
            document.getElementById('verificationRate').value = 25;
            document.getElementById('postsPerUser').value = 20;
            document.getElementById('buybackPercent').value = 25;
            document.getElementById('adCPM').value = 100;

            // Reset Identity Module pricing
            document.getElementById('basicPrice').value = 1;
            document.getElementById('verifiedPrice').value = 7;
            document.getElementById('premiumPrice').value = 19;
            document.getElementById('enterprisePrice').value = 124;
            document.getElementById('transferFee').value = 3;
            document.getElementById('saleCommission').value = 5;
            document.getElementById('monthlySales').value = 20;

            // Reset Content Module pricing
            document.getElementById('textPostFee').value = 0.05;
            document.getElementById('imagePostFee').value = 0.10;
            document.getElementById('videoPostFee').value = 0.25;
            document.getElementById('nftMintFee').value = 2;
            document.getElementById('premiumContentSub').value = 5;
            document.getElementById('contentBoostFee').value = 1;
            document.getElementById('contentSaleCommission').value = 10;

            // Reset Community Module pricing
            document.getElementById('smallCommunityFee').value = 3;
            document.getElementById('mediumCommunityFee').value = 10;
            document.getElementById('largeCommunityFee').value = 25;
            document.getElementById('enterpriseCommunityFee').value = 100;
            document.getElementById('eventHostingFee').value = 5;
            document.getElementById('communityVerificationFee').value = 20;
            document.getElementById('communityAnalyticsFee').value = 15;

            // Reset Advertising Module pricing
            document.getElementById('bannerCPM').value = 15;
            document.getElementById('videoCPM').value = 40;
            document.getElementById('promotedPostFee').value = 3;
            document.getElementById('campaignManagementFee').value = 50;
            document.getElementById('adAnalyticsFee').value = 30;

            // Reset Messaging Module pricing
            document.getElementById('encryptedDMFee').value = 0.02;
            document.getElementById('groupChatFee').value = 1;
            document.getElementById('fileTransferFee').value = 0.10;
            document.getElementById('voiceCallFee').value = 0.05;
            document.getElementById('messageStorageFee').value = 2;
            document.getElementById('messagingPremiumFee').value = 5;

            // Reset Reward Allocation
            document.getElementById('rewardAllocationPercent').value = 80;

            // Reset Reward Distribution Parameters
            document.getElementById('textPostPoints').value = 10;
            document.getElementById('imagePostPoints').value = 20;
            document.getElementById('videoPostPoints').value = 50;
            document.getElementById('likePoints').value = 1;
            document.getElementById('commentPoints').value = 8;
            document.getElementById('sharePoints').value = 10;
            document.getElementById('followPoints').value = 2;
            document.getElementById('maxPostsPerDay').value = 50;
            document.getElementById('maxLikesPerDay').value = 500;
            document.getElementById('maxCommentsPerDay').value = 200;
            document.getElementById('highQualityMultiplier').value = 3.0;
            document.getElementById('verifiedMultiplier').value = 1.4;
            document.getElementById('premiumMultiplier').value = 1.8;
            document.getElementById('day7Decay').value = 70;
            document.getElementById('day30Decay').value = 20;
            document.getElementById('maxDailyRewardUSD').value = 50;

            ['growthRate', 'burnRate', 'verificationRate', 'postsPerUser', 'buybackPercent', 'adCPM', 'saleCommission', 'contentSaleCommission', 'rewardAllocationPercent'].forEach(id => {
                updateSliderValue(id);
            });

            recalculateAll();
        }

        function recalculateAll() {
            // Get current parameters
            params.tokenPrice = parseFloat(document.getElementById('tokenPrice').value);
            params.startingUsers = parseInt(document.getElementById('startingUsers').value);
            params.growthRate = parseInt(document.getElementById('growthRate').value) / 100;
            params.burnRate = parseInt(document.getElementById('burnRate').value) / 100;
            params.verificationRate = parseInt(document.getElementById('verificationRate').value) / 100;
            params.postsPerUser = parseInt(document.getElementById('postsPerUser').value);
            params.buybackPercent = parseInt(document.getElementById('buybackPercent').value) / 100;
            params.adCPM = parseInt(document.getElementById('adCPM').value) / 100;

            console.log('=== recalculateAll called ===');
            console.log('burnRate:', params.burnRate);
            console.log('buybackPercent:', params.buybackPercent);

            // Get Identity Module pricing
            params.basicPrice = parseFloat(document.getElementById('basicPrice').value);
            params.verifiedPrice = parseFloat(document.getElementById('verifiedPrice').value);
            params.premiumPrice = parseFloat(document.getElementById('premiumPrice').value);
            params.enterprisePrice = parseFloat(document.getElementById('enterprisePrice').value);
            params.transferFee = parseFloat(document.getElementById('transferFee').value);
            params.saleCommission = parseInt(document.getElementById('saleCommission').value) / 100;
            params.monthlySales = parseInt(document.getElementById('monthlySales').value);

            // Get Content Module pricing
            params.textPostFee = parseFloat(document.getElementById('textPostFee').value);
            params.imagePostFee = parseFloat(document.getElementById('imagePostFee').value);
            params.videoPostFee = parseFloat(document.getElementById('videoPostFee').value);
            params.nftMintFee = parseFloat(document.getElementById('nftMintFee').value);
            params.premiumContentSub = parseFloat(document.getElementById('premiumContentSub').value);
            params.contentBoostFee = parseFloat(document.getElementById('contentBoostFee').value);
            params.contentSaleCommission = parseInt(document.getElementById('contentSaleCommission').value) / 100;

            // Get Community Module pricing
            params.smallCommunityFee = parseFloat(document.getElementById('smallCommunityFee').value);
            params.mediumCommunityFee = parseFloat(document.getElementById('mediumCommunityFee').value);
            params.largeCommunityFee = parseFloat(document.getElementById('largeCommunityFee').value);
            params.enterpriseCommunityFee = parseFloat(document.getElementById('enterpriseCommunityFee').value);
            params.eventHostingFee = parseFloat(document.getElementById('eventHostingFee').value);
            params.communityVerificationFee = parseFloat(document.getElementById('communityVerificationFee').value);
            params.communityAnalyticsFee = parseFloat(document.getElementById('communityAnalyticsFee').value);

            // Get Advertising Module pricing
            params.bannerCPM = parseFloat(document.getElementById('bannerCPM').value);
            params.videoCPM = parseFloat(document.getElementById('videoCPM').value);
            params.promotedPostFee = parseFloat(document.getElementById('promotedPostFee').value);
            params.campaignManagementFee = parseFloat(document.getElementById('campaignManagementFee').value);
            params.adAnalyticsFee = parseFloat(document.getElementById('adAnalyticsFee').value);

            // Get Messaging Module pricing
            params.encryptedDMFee = parseFloat(document.getElementById('encryptedDMFee').value);
            params.groupChatFee = parseFloat(document.getElementById('groupChatFee').value);
            params.fileTransferFee = parseFloat(document.getElementById('fileTransferFee').value);
            params.voiceCallFee = parseFloat(document.getElementById('voiceCallFee').value);
            params.messageStorageFee = parseFloat(document.getElementById('messageStorageFee').value);
            params.messagingPremiumFee = parseFloat(document.getElementById('messagingPremiumFee').value);

            // Get Reward Allocation
            params.rewardAllocationPercent = parseInt(document.getElementById('rewardAllocationPercent').value) / 100;
            console.log('rewardAllocationPercent:', params.rewardAllocationPercent);

            // Get Reward Distribution parameters
            params.textPostPoints = parseFloat(document.getElementById('textPostPoints').value);
            params.imagePostPoints = parseFloat(document.getElementById('imagePostPoints').value);
            params.videoPostPoints = parseFloat(document.getElementById('videoPostPoints').value);
            params.likePoints = parseFloat(document.getElementById('likePoints').value);
            params.commentPoints = parseFloat(document.getElementById('commentPoints').value);
            params.sharePoints = parseFloat(document.getElementById('sharePoints').value);
            params.followPoints = parseFloat(document.getElementById('followPoints').value);
            params.maxPostsPerDay = parseInt(document.getElementById('maxPostsPerDay').value);
            params.maxLikesPerDay = parseInt(document.getElementById('maxLikesPerDay').value);
            params.maxCommentsPerDay = parseInt(document.getElementById('maxCommentsPerDay').value);
            params.highQualityMultiplier = parseFloat(document.getElementById('highQualityMultiplier').value);
            params.verifiedMultiplier = parseFloat(document.getElementById('verifiedMultiplier').value);
            params.premiumMultiplier = parseFloat(document.getElementById('premiumMultiplier').value);
            params.day7Decay = parseInt(document.getElementById('day7Decay').value);
            params.day30Decay = parseInt(document.getElementById('day30Decay').value);
            params.maxDailyRewardUSD = parseFloat(document.getElementById('maxDailyRewardUSD').value);

            // STEP 1: Calculate modules (except rewards) to get initial recapture estimate
            const identity = calculateIdentity();
            const content = calculateContent();
            const advertising = calculateAdvertising();
            const community = calculateCommunity();
            const messaging = calculateMessaging();

            // STEP 2: Calculate initial rewards with recapture rate = 0
            let rewards = calculateRewards(0);

            // STEP 3: Calculate initial recapture
            let recaptureData = calculateRecapture(identity, content, advertising, community, messaging,
                (identity.revenue + content.revenue + advertising.revenue + community.revenue + messaging.revenue) -
                (identity.costs + content.costs + advertising.costs + community.costs + messaging.costs + rewards.opCosts),
                rewards);

            // STEP 4: Update global recapture rate and recalculate rewards with adaptive emission
            currentGlobalRecaptureRate = parseFloat(recaptureData.recaptureRate);
            rewards = calculateRewards(currentGlobalRecaptureRate);

            // STEP 5: Recalculate recapture with new adaptive values
            const totalRevenue = identity.revenue + content.revenue + advertising.revenue + community.revenue + messaging.revenue;
            const totalCosts = identity.costs + content.costs + advertising.costs + community.costs + messaging.costs + rewards.opCosts;
            const totalProfit = totalRevenue - totalCosts;
            const totalMargin = totalRevenue > 0 ? (totalProfit / totalRevenue * 100).toFixed(1) : 0;

            recaptureData = calculateRecapture(identity, content, advertising, community, messaging, totalProfit, rewards);

            // Update module tables
            updateModuleRow('identity', identity);
            updateModuleRow('content', content);
            updateModuleRow('advertising', advertising);
            updateModuleRow('community', community);
            updateModuleRow('messaging', messaging);

            // Update rewards
            document.getElementById('rewardsCosts').textContent = '$' + rewards.opCosts;
            document.getElementById('rewardsProfit').textContent = '-$' + rewards.opCosts;
            document.getElementById('rewardsEmission').textContent = formatNumber(Math.round(rewards.monthlyEmission / 1000000)) + 'M VIWO';
            document.getElementById('rewardsEmissionUSD').textContent = '($' + formatNumber(rewards.emissionUSD) + ')';

            document.getElementById('totalRevenue').textContent = '$' + formatNumber(totalRevenue);
            document.getElementById('totalCosts').textContent = '$' + formatNumber(totalCosts);
            document.getElementById('totalProfit').textContent = '$' + formatNumber(totalProfit);
            document.getElementById('totalMargin').textContent = totalMargin + '%';

            // Update header
            document.getElementById('headerRevenue').textContent = '$' + formatNumber(totalRevenue);
            document.getElementById('headerProfit').textContent = '$' + formatNumber(totalProfit);
            document.getElementById('headerMargin').textContent = totalMargin + '%';

            // Update detailed module sections
            updateIdentityModule(identity);
            updateContentModule(content);
            updateCommunityModule(community);
            updateAdvertisingModule(advertising);
            updateMessagingModule(messaging);
            updateRewardsModule(rewards);

            // Update liquidity analytics section
            updateLiquiditySection();

            // Update velocity section
            updateVelocitySection(recaptureData.totalRecaptured, recaptureData.recaptureRate);

            // Update summary sustainability table
            updateSummarySustainabilityTable(totalRevenue, totalCosts, totalProfit, totalMargin, recaptureData.totalRecaptured, recaptureData.recaptureRate);

            // Update actual adaptive values display in controls
            const adaptiveBurn = calculateAdaptiveBurnRate(currentGlobalRecaptureRate, params.burnRate);
            const adaptiveBuyback = calculateAdaptiveBuyback(currentGlobalRecaptureRate, params.buybackPercent);
            document.getElementById('burnRateActual').textContent = (adaptiveBurn * 100).toFixed(0) + '%';
            document.getElementById('buybackPercentActual').textContent = (adaptiveBuyback * 100).toFixed(0) + '%';

            // Highlight if adaptive value differs from user setting
            if (Math.abs(adaptiveBurn - params.burnRate) > 0.01) {
                document.getElementById('burnRateActual').style.color = '#f59e0b'; // orange if overridden
            } else {
                document.getElementById('burnRateActual').style.color = '#3b82f6'; // blue if same
            }

            if (Math.abs(adaptiveBuyback - params.buybackPercent) > 0.01) {
                document.getElementById('buybackPercentActual').style.color = '#f59e0b'; // orange if overridden
            } else {
                document.getElementById('buybackPercentActual').style.color = '#3b82f6'; // blue if same
            }
        }

        function updateSummarySustainabilityTable(m1Revenue, m1Costs, m1Profit, m1Margin, m1Recaptured, m1RecaptureRate) {
            // Month 1 values (actual from current calculation)
            const m1Users = params.startingUsers;

            // Month 12 projections - use user-controlled growth rate
            const m12Users = Math.round(m1Users * Math.pow(1 + params.growthRate, 12));
            const m12Revenue = m1Revenue * CONFIG.PROJECTIONS.MONTH_12.REVENUE;
            const m12Costs = m1Costs * CONFIG.PROJECTIONS.MONTH_12.COSTS;
            const m12Profit = m12Revenue - m12Costs;
            const m12Margin = ((m12Profit / m12Revenue) * 100).toFixed(0);
            const m12Recaptured = m1Recaptured * CONFIG.PROJECTIONS.MONTH_12.RECAPTURE;
            const m12RecaptureRate = ((m12Recaptured / CONFIG.MONTHLY_EMISSION) * 100).toFixed(1);

            // Month 60 projections - use tapering growth rate (70% of initial rate)
            const taperingRate = params.growthRate * 0.7;
            const m60Users = Math.round(m1Users * Math.pow(1 + taperingRate, 60));
            const m60Revenue = m1Revenue * CONFIG.PROJECTIONS.MONTH_60.REVENUE;
            const m60Costs = m1Costs * CONFIG.PROJECTIONS.MONTH_60.COSTS;
            const m60Profit = m60Revenue - m60Costs;
            const m60Margin = ((m60Profit / m60Revenue) * 100).toFixed(0);
            const m60Recaptured = m1Recaptured * CONFIG.PROJECTIONS.MONTH_60.RECAPTURE;
            const m60RecaptureRate = ((m60Recaptured / CONFIG.MONTHLY_EMISSION) * 100).toFixed(1);

            // Update table (find the table in summary section)
            const summaryTable = document.querySelector('#system-summary .table-custom tbody');
            if (summaryTable) {
                summaryTable.innerHTML = `
                    <tr>
                        <td>Active Users</td>
                        <td>${formatNumber(m1Users)}</td>
                        <td>${formatNumber(m12Users)}</td>
                        <td>${formatNumber(m60Users)}</td>
                        <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                    </tr>
                    <tr>
                        <td>Monthly Revenue</td>
                        <td>$${formatNumber(m1Revenue)}</td>
                        <td>$${formatNumber(m12Revenue)}</td>
                        <td>$${formatNumber(m60Revenue)}</td>
                        <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                    </tr>
                    <tr>
                        <td>Monthly Costs</td>
                        <td>$${formatNumber(m1Costs)}</td>
                        <td>$${formatNumber(m12Costs)}</td>
                        <td>$${formatNumber(m60Costs)}</td>
                        <td><i class="fas fa-arrow-up" style="color: var(--warning-color);"></i></td>
                    </tr>
                    <tr>
                        <td>Monthly Profit</td>
                        <td>$${formatNumber(m1Profit)}</td>
                        <td>$${formatNumber(m12Profit)}</td>
                        <td>$${formatNumber(m60Profit)}</td>
                        <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                    </tr>
                    <tr>
                        <td>Profit Margin</td>
                        <td>${m1Margin}%</td>
                        <td>${m12Margin}%</td>
                        <td>${m60Margin}%</td>
                        <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                    </tr>
                    <tr>
                        <td>Rewards Emitted</td>
                        <td>5.83M VIWO</td>
                        <td>5.83M VIWO</td>
                        <td>5.83M VIWO</td>
                        <td><i class="fas fa-minus" style="color: var(--info-color);"></i> Fixed</td>
                    </tr>
                    <tr>
                        <td>Rewards Recaptured</td>
                        <td>${(m1Recaptured / 1000000).toFixed(2)}M VIWO</td>
                        <td>${(m12Recaptured / 1000000).toFixed(2)}M VIWO</td>
                        <td>${(m60Recaptured / 1000000).toFixed(2)}M VIWO</td>
                        <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                    </tr>
                    <tr>
                        <td>Recapture Rate</td>
                        <td>${m1RecaptureRate}%</td>
                        <td>${m12RecaptureRate}%</td>
                        <td>${m60RecaptureRate}%</td>
                        <td><i class="fas fa-arrow-up" style="color: var(--success-color);"></i></td>
                    </tr>
                `;
            }
        }

        function updateVelocitySection(monthlyRecaptured, recaptureRate) {
            // Calculate 60-month projections
            const monthlyEmission = CONFIG.MONTHLY_EMISSION;
            const total60Emissions = monthlyEmission * 60;
            const total60Recaptured = monthlyRecaptured * 60;
            const net60Circulation = total60Emissions - total60Recaptured;
            const recapture60Percent = parseFloat(recaptureRate);

            // User growth projections - use tapering growth rate (70% of initial rate)
            const month60TaperingRate = params.growthRate * 0.7;
            const month60Users = Math.round(params.startingUsers * Math.pow(1 + month60TaperingRate, 60));

            // Supply calculations - using actual TGE circulating supply (158.8M)
            const tgeSupply = CONFIG.SUPPLY.TGE_CIRCULATING;
            const month60Supply = tgeSupply + net60Circulation;
            const inflationPercent = ((net60Circulation / tgeSupply) * 100).toFixed(0);

            // Update UI - Metrics
            document.getElementById('total60Emissions').textContent = (total60Emissions / 1000000).toFixed(0);
            document.getElementById('total60Recaptured').textContent = (total60Recaptured / 1000000).toFixed(0);
            document.getElementById('recapture60Percent').textContent = recapture60Percent;
            document.getElementById('net60Circulation').textContent = (net60Circulation / 1000000).toFixed(0);

            // Calculate dynamic velocity based on actual platform metrics
            // Velocity = How many times each token changes hands per month

            // For VIWO platform, transaction volume includes:
            // 1. Rewards distributed to users (monthlyEmission)
            // 2. Users spending rewards on modules
            // 3. Creators/sellers receiving payments
            // 4. Re-spending by recipients
            // 5. Fees, staking, buybacks

            const avgCirculatingSupply = (tgeSupply + month60Supply) / 2;

            // Activity multiplier based on user engagement and recapture rate
            // Higher recapture = more active economy = higher velocity
            // Low recapture (< 10%): 2-4x (tokens barely circulate)
            // Moderate (10-30%): 5-10x (active platform)
            // High (30%+): 10-20x (very active economy)

            let activityMultiplier;
            if (recapture60Percent < 10) {
                activityMultiplier = 2 + (recapture60Percent / 10) * 2;  // 2-4x
            } else if (recapture60Percent < 30) {
                activityMultiplier = 4 + ((recapture60Percent - 10) / 20) * 6;  // 4-10x
            } else {
                activityMultiplier = 10 + ((recapture60Percent - 30) / 70) * 10;  // 10-20x
            }

            // User growth factor: more users = more transactions
            const userGrowthFactor = Math.min(month60Users / params.startingUsers, 50);  // Cap at 50x
            const growthBonus = 1 + Math.log10(userGrowthFactor) * 0.5;  // Logarithmic bonus

            // Final activity multiplier
            const finalMultiplier = activityMultiplier * growthBonus;

            // Monthly transaction volume = emissions  activity multiplier
            const monthlyTxVolume = monthlyEmission * finalMultiplier;

            // Velocity = Monthly Volume / Average Supply (then convert to annual)
            const monthlyVelocity = monthlyTxVolume / avgCirculatingSupply;
            const annualVelocity = monthlyVelocity * 12;  // Convert to annual
            document.getElementById('avgVelocity').textContent = annualVelocity.toFixed(1);

            // Update velocity interpretation table - highlight current velocity
            const velocityRows = document.querySelectorAll('#velocity .table-custom tbody tr');
            velocityRows.forEach(row => row.style.background = '');

            // Dynamically highlight the appropriate row based on actual annual velocity
            let highlightIndex = -1;
            let velocityStatus = '';

            if (annualVelocity < 2) {
                highlightIndex = 0;
                velocityStatus = `Tokens hoarded, limited utility (VIWO: ${annualVelocity.toFixed(1)}x annually)`;
            } else if (annualVelocity >= 2 && annualVelocity <= 10) {
                highlightIndex = 1;
                velocityStatus = `Active usage & circulation (VIWO: ${annualVelocity.toFixed(1)}x annually)`;
            } else if (annualVelocity > 10 && annualVelocity <= 50) {
                highlightIndex = 2;
                velocityStatus = `Very frequent transactions (VIWO: ${annualVelocity.toFixed(1)}x annually)`;
            } else {
                highlightIndex = 3;
                velocityStatus = `Potential sell pressure (VIWO: ${annualVelocity.toFixed(1)}x annually)`;
            }

            if (highlightIndex >= 0 && velocityRows[highlightIndex]) {
                velocityRows[highlightIndex].style.background = 'rgba(52, 211, 153, 0.1)';
                velocityRows[highlightIndex].querySelector('td:nth-child(3)').textContent = velocityStatus;
            }

            // Update sustainability summary with dynamic values
            const sustainabilitySummary = `<strong>Long-Term Sustainability Summary:</strong>
                <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                    <li><strong>Controlled Inflation:</strong> Net circulation +${inflationPercent}% over 5 years (${(tgeSupply/1000000).toFixed(0)}M TGE  ${(month60Supply/1000000).toFixed(0)}M Month 60)</li>
                    <li><strong>Strong Recapture:</strong> ${recapture60Percent}% average (${recapture60Percent >= 15 ? 'above' : 'below'} 15% industry benchmark)</li>
                    <li><strong>Token Velocity:</strong> ${annualVelocity.toFixed(1)}x annually - ${annualVelocity < 2 ? 'low circulation, needs more utility' : annualVelocity <= 10 ? 'healthy active usage' : annualVelocity <= 50 ? 'very active trading' : 'excessive velocity'}</li>
                    <li><strong>User Growth:</strong> ${formatNumber(params.startingUsers)}  ${formatNumber(month60Users)}+ users by Month 60 (${(params.growthRate * 100).toFixed(0)}% monthly growth, tapering to ${(params.growthRate * 70).toFixed(0)}%)</li>
                    <li><strong>Revenue Growth:</strong> Exceeds costs by Month 8, creating positive feedback loop</li>
                </ul>`;

            const sustainabilityDiv = document.querySelector('#velocity .alert-box.alert-success div');
            if (sustainabilityDiv) {
                sustainabilityDiv.innerHTML = sustainabilitySummary;
            }
        }

        function updateLiquiditySection() {
            // TGE Liquidity Configuration
            // 100M tokens allocated for liquidity (10% of 1B total supply)
            const tgeLiquidityTokens = CONFIG.SUPPLY.LIQUIDITY;
            const TGE_LIQUIDITY_USD = tgeLiquidityTokens * params.tokenPrice;

            // Calculate market cap at TGE (1B total supply)
            const totalSupply = CONFIG.SUPPLY.TOTAL;
            const marketCap = totalSupply * params.tokenPrice;

            // Liquidity ratio
            const liquidityRatio = (TGE_LIQUIDITY_USD / marketCap) * 100;

            // Slippage calculations (simplified constant product AMM formula)
            // slippage = (tradeSize / liquidityDepth) * 100
            const slippage10k = (10000 / TGE_LIQUIDITY_USD) * 100;
            const slippage50k = (50000 / TGE_LIQUIDITY_USD) * 100;

            // Update UI
            document.getElementById('tgeLiquidity').textContent = (TGE_LIQUIDITY_USD / 1000000).toFixed(2);
            document.getElementById('tgeLiquidityTokens').textContent = (tgeLiquidityTokens / 1000000).toFixed(2);
            document.getElementById('liquidityStrategyTokens').textContent = (tgeLiquidityTokens / 1000000).toFixed(2);

            document.getElementById('liquidityRatio').textContent = liquidityRatio.toFixed(1);
            document.getElementById('liquidityRatioTable').textContent = liquidityRatio.toFixed(1);

            document.getElementById('slippage10k').textContent = slippage10k.toFixed(1);
            document.getElementById('slippage10kTable').textContent = slippage10k.toFixed(1);

            document.getElementById('slippage50k').textContent = slippage50k.toFixed(1);
            document.getElementById('slippage50kTable').textContent = slippage50k.toFixed(1);

            document.getElementById('liquidityDepthValue').textContent = (TGE_LIQUIDITY_USD / 1000000).toFixed(2);
            document.getElementById('marketCapTGE').textContent = (marketCap / 1000000).toFixed(1);
        }

        function updateIdentityModule(identity) {
            // Update tier pricing table
            document.getElementById('identityBasicUSD').textContent = '$' + params.basicPrice.toFixed(2);
            document.getElementById('identityBasicVIWO').textContent = (params.basicPrice / params.tokenPrice).toFixed(1) + ' VIWO';
            document.getElementById('identityBasicUsers').textContent = identity.breakdown.basicUsers;

            document.getElementById('identityVerifiedUSD').textContent = '$' + params.verifiedPrice.toFixed(2);
            document.getElementById('identityVerifiedVIWO').textContent = (params.verifiedPrice / params.tokenPrice).toFixed(1) + ' VIWO';
            document.getElementById('identityVerifiedUsers').textContent = identity.breakdown.verifiedUsers;

            document.getElementById('identityPremiumUSD').textContent = '$' + params.premiumPrice.toFixed(2);
            document.getElementById('identityPremiumVIWO').textContent = (params.premiumPrice / params.tokenPrice).toFixed(1) + ' VIWO';
            document.getElementById('identityPremiumUsers').textContent = identity.breakdown.premiumUsers;

            document.getElementById('identityEnterpriseUSD').textContent = '$' + params.enterprisePrice.toFixed(2);
            document.getElementById('identityEnterpriseVIWO').textContent = (params.enterprisePrice / params.tokenPrice).toFixed(1) + ' VIWO';
            document.getElementById('identityEnterpriseUsers').textContent = identity.breakdown.enterpriseUsers;

            // Update revenue breakdown
            document.getElementById('identityTierRevenue').textContent = '$' + formatNumber(identity.breakdown.tierRevenue);
            document.getElementById('identityTransferRevenue').textContent = '$' + formatNumber(identity.breakdown.transferRevenue);
            document.getElementById('identitySaleRevenue').textContent = '$' + formatNumber(identity.breakdown.saleRevenue);
            document.getElementById('identityTotalRevenue').textContent = '$' + formatNumber(identity.revenue);

            // Update costs and profit
            document.getElementById('identityCostsDetail').textContent = '$' + formatNumber(identity.costs);
            const profitText = '$' + formatNumber(identity.profit) + ' (' + identity.margin + '% margin)';
            document.getElementById('identityProfitDetail').textContent = profitText;
            document.getElementById('identityProfitDetail').style.color = identity.profit >= 0 ? 'var(--success-color)' : 'var(--danger-color)';

            // Update profitability summary
            const paidUsers = identity.breakdown.basicUsers + identity.breakdown.verifiedUsers + identity.breakdown.premiumUsers + identity.breakdown.enterpriseUsers;
            const summaryText = `<strong>Profitability:</strong> With ${params.startingUsers} users, ${(params.verificationRate * 100).toFixed(0)}% verification rate (${paidUsers} paid users), this module generates $${formatNumber(identity.revenue)} monthly revenue against $${formatNumber(identity.costs)} costs = $${formatNumber(identity.profit)} profit (${identity.margin}% margin).`;
            document.getElementById('identityProfitabilitySummary').innerHTML = summaryText;

            // Update fee distribution table
            const updateFeeRow = (prefix, priceUSD) => {
                const priceVIWO = priceUSD / params.tokenPrice;
                document.getElementById('fee' + prefix).textContent = priceUSD.toFixed(2);
                document.getElementById('fee' + prefix + 'VIWO').textContent = priceVIWO.toFixed(1);
                document.getElementById('fee' + prefix + 'Burn').textContent = (priceVIWO * 0.20).toFixed(1);
                document.getElementById('fee' + prefix + 'Treasury').textContent = (priceVIWO * 0.50).toFixed(1);
                document.getElementById('fee' + prefix + 'Rewards').textContent = (priceVIWO * 0.30).toFixed(1);
            };

            updateFeeRow('Basic', params.basicPrice);
            updateFeeRow('Verified', params.verifiedPrice);
            updateFeeRow('Premium', params.premiumPrice);
            updateFeeRow('Enterprise', params.enterprisePrice);
            updateFeeRow('Transfer', params.transferFee);

            // Calculate and update Identity Module Recapture
            calculateIdentityRecapture(identity);
        }

        function calculateIdentityRecapture(identity) {
            // Calculate transaction fees in VIWO (apply FEE_COLLECTION_RATE consistently)
            const transferVIWO = identity.breakdown.monthlyTransfers * (params.transferFee / params.tokenPrice) * CONFIG.FEE_COLLECTION_RATE;

            // Calculate staking
            const stakingAmount = identity.breakdown.premiumUsers *
                CONFIG.STAKING.IDENTITY_PREMIUM_MULTIPLIER *
                (params.premiumPrice / params.tokenPrice);
            // Cap staking at a reasonable % of total monthly emission
            const stakingCap = CONFIG.MONTHLY_EMISSION * CONFIG.STAKING.IDENTITY_CAP_PERCENT;

            // Calculate NFT marketplace royalties
            const avgProfilePriceVIWO = CONFIG.MARKETPLACE.AVG_PROFILE_PRICE_USD / params.tokenPrice;
            const royaltiesVIWO = params.monthlySales * avgProfilePriceVIWO * params.saleCommission;

            // Use unified recapture calculation
            const recapture = calculateModuleRecapture({
                moduleName: 'Identity',
                moduleAllocation: CONFIG.MODULE_REVENUE_SHARE.IDENTITY, // For proportional display only
                transactionFeesVIWO: transferVIWO,
                stakingConfig: {
                    amount: stakingAmount,
                    cap: stakingCap
                },
                royaltiesVIWO: royaltiesVIWO
            });

            // Update UI with formatted values (rounding only at display time)
            // NOTE: Identity module doesn't emit tokens! Only shows revenue share for reference
            document.getElementById('identityEmissionPercent').textContent =
                CONFIG.format(CONFIG.MODULE_REVENUE_SHARE.IDENTITY * 100, 'display') + '%';
            document.getElementById('identityEmissionAmount').textContent =
                'N/A'; // Modules don't emit!

            document.getElementById('identityRecaptureBurn').textContent =
                formatNumber(Math.round(recapture.burnVIWO));
            document.getElementById('identityRecaptureBurnPercent').textContent =
                CONFIG.format((recapture.burnVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('identityRecaptureTreasury').textContent =
                formatNumber(Math.round(recapture.treasuryVIWO));
            document.getElementById('identityRecaptureTreasuryPercent').textContent =
                CONFIG.format((recapture.treasuryVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('identityRecaptureStaking').textContent =
                formatNumber(Math.round(recapture.stakingVIWO));
            document.getElementById('identityRecaptureStakingPercent').textContent =
                CONFIG.format((recapture.stakingVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('identityRecaptureRoyalties').textContent =
                formatNumber(Math.round(recapture.royaltiesVIWO));
            document.getElementById('identityRecaptureRoyaltiesPercent').textContent =
                CONFIG.format((recapture.royaltiesVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('identitySaleCommissionPercent').textContent =
                CONFIG.format(params.saleCommission * 100, 'display') + '%';

            document.getElementById('identityRecaptureTotal').textContent =
                formatNumber(Math.round(recapture.totalRecaptured)) + ' VIWO/month';
            document.getElementById('identityRecaptureTotalPercent').textContent =
                CONFIG.format(recapture.recaptureRate, 'percentage') + '%';

            // Update summary text
            let interpretation = '';
            const rate = recapture.recaptureRate;
            if (rate < 30) {
                interpretation = `Identity module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month. Consider increasing fees or staking incentives.`;
            } else if (rate < 60) {
                interpretation = `Identity module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). This is a healthy recapture rate. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else if (rate < 90) {
                interpretation = `Identity module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Excellent! The module is highly sustainable. Net new supply: only ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else {
                interpretation = `Identity module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Outstanding! The module nearly pays for its own emissions. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            }
            document.getElementById('identityRecaptureSummary').textContent = interpretation;

            return recapture;
        }

        function updateContentModule(content) {
            // Update Core Features display
            document.getElementById('contentTextFeeDisplay').textContent = params.textPostFee.toFixed(2);
            document.getElementById('contentImageFeeDisplay').textContent = params.imagePostFee.toFixed(2);
            document.getElementById('contentVideoFeeDisplay').textContent = params.videoPostFee.toFixed(2);
            document.getElementById('contentNFTFeeDisplay').textContent = params.nftMintFee.toFixed(2);
            document.getElementById('contentPremiumSubDisplay').textContent = params.premiumContentSub.toFixed(2);
            document.getElementById('contentBoostFeeDisplay').textContent = params.contentBoostFee.toFixed(2);
            document.getElementById('contentCommissionDisplay').textContent = (params.contentSaleCommission * 100).toFixed(0) + '%';

            // Update revenue breakdown
            document.getElementById('contentPostFeesRevenue').textContent = '$' + formatNumber(content.breakdown.postFeesRevenue);
            document.getElementById('contentPremiumSubsCount').textContent = content.breakdown.premiumSubscribers;
            document.getElementById('contentPremiumSubPrice').textContent = params.premiumContentSub.toFixed(0);
            document.getElementById('contentPremiumRevenue').textContent = '$' + formatNumber(content.breakdown.premiumRevenue);
            document.getElementById('contentBoostedPostsCount').textContent = content.breakdown.boostedPosts;
            document.getElementById('contentBoostPrice').textContent = params.contentBoostFee.toFixed(0);
            document.getElementById('contentBoostRevenue').textContent = '$' + formatNumber(content.breakdown.boostRevenue);
            document.getElementById('contentNFTSalesCount').textContent = content.breakdown.monthlyNFTSales;
            document.getElementById('contentCommissionRate').textContent = (params.contentSaleCommission * 100).toFixed(0) + '%';
            document.getElementById('contentNFTSalesRevenue').textContent = '$' + formatNumber(content.breakdown.nftSalesRevenue);
            document.getElementById('contentTotalRevenue').textContent = '$' + formatNumber(content.revenue);

            // Update costs and profit
            document.getElementById('contentCostsDetail').textContent = '$' + formatNumber(content.costs);
            const profitText = '$' + formatNumber(content.profit) + ' (' + content.margin + '% margin)';
            document.getElementById('contentProfitDetail').textContent = profitText;
            document.getElementById('contentProfitDetail').style.color = content.profit >= 0 ? 'var(--success-color)' : 'var(--danger-color)';

            // Update profitability summary
            const summaryText = `<strong>Profitability:</strong> With ${params.startingUsers} users creating ${params.postsPerUser} posts/month avg (${content.breakdown.textPosts + content.breakdown.imagePosts + content.breakdown.videoPosts + content.breakdown.nftMints} total posts), this module generates $${formatNumber(content.revenue)} monthly revenue against $${formatNumber(content.costs)} costs = $${formatNumber(content.profit)} profit (${content.margin}% margin).`;
            document.getElementById('contentProfitabilitySummary').innerHTML = summaryText;

            // Calculate and update Content Module Recapture
            calculateContentRecapture(content);
        }

        function calculateContentRecapture(content) {
            // Calculate transaction fees in VIWO (apply FEE_COLLECTION_RATE)
            const postFeesVIWO = (content.breakdown.textPosts * params.textPostFee * CONFIG.FEE_COLLECTION_RATE / params.tokenPrice) +
                                (content.breakdown.imagePosts * params.imagePostFee * CONFIG.FEE_COLLECTION_RATE / params.tokenPrice) +
                                (content.breakdown.videoPosts * params.videoPostFee * CONFIG.FEE_COLLECTION_RATE / params.tokenPrice) +
                                (content.breakdown.nftMints * params.nftMintFee / params.tokenPrice) + // NFT always has fee
                                (content.breakdown.boostedPosts * params.contentBoostFee / params.tokenPrice); // Boost always has fee

            // Calculate staking
            const stakingAmount = content.breakdown.premiumSubscribers *
                CONFIG.STAKING.CONTENT_PARTICIPATION_RATE *
                CONFIG.STAKING.CONTENT_SUBSCRIPTION_MULTIPLIER *
                (params.premiumContentSub / params.tokenPrice);
            // Cap staking at a reasonable % of total monthly emission
            const stakingCap = CONFIG.MONTHLY_EMISSION * CONFIG.STAKING.IDENTITY_CAP_PERCENT;

            // NFT Marketplace commission (use CONFIG value)
            const avgNFTPriceVIWO = CONFIG.MARKETPLACE.AVG_NFT_PRICE_USD / params.tokenPrice;
            const royaltiesVIWO = CONFIG.MARKETPLACE.MONTHLY_NFT_SALES * avgNFTPriceVIWO * params.contentSaleCommission;

            // Use unified recapture calculation
            const recapture = calculateModuleRecapture({
                moduleName: 'Content',
                moduleAllocation: CONFIG.MODULE_REVENUE_SHARE.CONTENT,
                transactionFeesVIWO: postFeesVIWO,
                stakingConfig: {
                    amount: stakingAmount,
                    cap: stakingCap
                },
                royaltiesVIWO: royaltiesVIWO
            });

            const contentEmissions = recapture.moduleEmissions;
            const totalRecaptured = recapture.totalRecaptured;
            const recaptureRate = CONFIG.format(recapture.recaptureRate, 'percentage');

            // Update UI with formatted values (rounding only at display time)
            // NOTE: Content module doesn't emit tokens! Only shows revenue share for reference
            document.getElementById('contentEmissionPercent').textContent =
                CONFIG.format(CONFIG.MODULE_REVENUE_SHARE.CONTENT * 100, 'display') + '%';
            document.getElementById('contentEmissionAmount').textContent =
                'N/A'; // Modules don't emit!

            document.getElementById('contentRecaptureBurn').textContent =
                formatNumber(Math.round(recapture.burnVIWO));
            document.getElementById('contentRecaptureBurnPercent').textContent =
                CONFIG.format((recapture.burnVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('contentRecaptureTreasury').textContent =
                formatNumber(Math.round(recapture.treasuryVIWO));
            document.getElementById('contentRecaptureTreasuryPercent').textContent =
                CONFIG.format((recapture.treasuryVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('contentRecaptureStaking').textContent =
                formatNumber(Math.round(recapture.stakingVIWO));
            document.getElementById('contentRecaptureStakingPercent').textContent =
                CONFIG.format((recapture.stakingVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('contentRecaptureRoyalties').textContent =
                formatNumber(Math.round(recapture.royaltiesVIWO));
            document.getElementById('contentRecaptureRoyaltiesPercent').textContent =
                CONFIG.format((recapture.royaltiesVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('contentNFTCommissionPercent').textContent =
                CONFIG.format(params.contentSaleCommission * 100, 'display') + '%';

            document.getElementById('contentRecaptureTotal').textContent =
                formatNumber(Math.round(recapture.totalRecaptured)) + ' VIWO/month';
            document.getElementById('contentRecaptureTotalPercent').textContent =
                CONFIG.format(recapture.recaptureRate, 'percentage') + '%';

            // Update summary text
            let interpretation = '';
            const rate = recapture.recaptureRate;
            if (rate < 30) {
                interpretation = `Content module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month. Consider increasing fees or creator staking.`;
            } else if (rate < 60) {
                interpretation = `Content module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Healthy recapture rate. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else if (rate < 90) {
                interpretation = `Content module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Excellent! The module is highly sustainable. Net new supply: only ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else {
                interpretation = `Content module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Outstanding! Nearly pays for its own emissions. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            }
            document.getElementById('contentRecaptureSummary').textContent = interpretation;

            return recapture;
        }

        function updateCommunityModule(community) {
            // Update Core Features display
            document.getElementById('communitySmallFeeDisplay').textContent = params.smallCommunityFee.toFixed(0);
            document.getElementById('communityMediumFeeDisplay').textContent = params.mediumCommunityFee.toFixed(0);
            document.getElementById('communityLargeFeeDisplay').textContent = params.largeCommunityFee.toFixed(0);
            document.getElementById('communityEnterpriseFeeDisplay').textContent = params.enterpriseCommunityFee.toFixed(0);
            document.getElementById('communityEventFeeDisplay').textContent = params.eventHostingFee.toFixed(2);
            document.getElementById('communityVerificationFeeDisplay').textContent = params.communityVerificationFee.toFixed(2);
            document.getElementById('communityAnalyticsFeeDisplay').textContent = params.communityAnalyticsFee.toFixed(2);

            // Update revenue breakdown
            document.getElementById('communitySmallCount').textContent = community.breakdown.smallCommunities;
            document.getElementById('communitySmallPrice').textContent = params.smallCommunityFee.toFixed(0);
            document.getElementById('communityMediumCount').textContent = community.breakdown.mediumCommunities;
            document.getElementById('communityMediumPrice').textContent = params.mediumCommunityFee.toFixed(0);
            document.getElementById('communityLargeCount').textContent = community.breakdown.largeCommunities;
            document.getElementById('communityLargePrice').textContent = params.largeCommunityFee.toFixed(0);
            document.getElementById('communityEnterpriseCount').textContent = community.breakdown.enterpriseCommunities;
            document.getElementById('communityEnterprisePrice').textContent = params.enterpriseCommunityFee.toFixed(0);
            document.getElementById('communityTierRevenue').textContent = '$' + formatNumber(community.breakdown.tierRevenue);

            document.getElementById('communityEventsCount').textContent = community.breakdown.eventsHosted;
            document.getElementById('communityEventPrice').textContent = params.eventHostingFee.toFixed(0);
            document.getElementById('communityEventRevenue').textContent = '$' + formatNumber(community.breakdown.eventRevenue);

            document.getElementById('communityVerificationsCount').textContent = community.breakdown.verifications;
            document.getElementById('communityVerificationPrice').textContent = params.communityVerificationFee.toFixed(0);
            document.getElementById('communityVerificationRevenue').textContent = '$' + formatNumber(community.breakdown.verificationRevenue);

            document.getElementById('communityAnalyticsCount').textContent = community.breakdown.analyticsSubscribers;
            document.getElementById('communityAnalyticsPrice').textContent = params.communityAnalyticsFee.toFixed(0);
            document.getElementById('communityAnalyticsRevenue').textContent = '$' + formatNumber(community.breakdown.analyticsRevenue);

            document.getElementById('communityTotalRevenue').textContent = '$' + formatNumber(community.revenue);

            // Update costs and profit
            document.getElementById('communityCostsDetail').textContent = formatNumber(community.costs);
            const profitText = '$' + formatNumber(community.profit) + ' (' + community.margin + '% margin)';
            document.getElementById('communityProfitDetail').textContent = profitText;
            document.getElementById('communityProfitDetail').style.color = community.profit >= 0 ? 'var(--success-color)' : 'var(--danger-color)';

            // Update profitability summary
            const totalCommunities = community.breakdown.smallCommunities + community.breakdown.mediumCommunities +
                                    community.breakdown.largeCommunities + community.breakdown.enterpriseCommunities;
            const summaryText = `<strong>Profitability:</strong> With ${params.startingUsers} users creating ${totalCommunities} communities (${community.breakdown.eventsHosted} events/month), this module generates $${formatNumber(community.revenue)} monthly revenue against $${formatNumber(community.costs)} costs = $${formatNumber(community.profit)} profit (${community.margin}% margin).`;
            document.getElementById('communityProfitabilitySummary').innerHTML = summaryText;

            // Calculate and update Community Module Recapture
            calculateCommunityRecapture(community);
        }

        function calculateCommunityRecapture(community) {
            // Calculate transaction fees in VIWO (apply FEE_COLLECTION_RATE for events)
            const eventFeesVIWO = community.breakdown.eventsHosted * (params.eventHostingFee / params.tokenPrice);

            // Total transaction fees (events have fees, tier subscriptions are in USD)
            const totalFeesVIWO = eventFeesVIWO * CONFIG.FEE_COLLECTION_RATE;

            // Calculate staking
            const totalCommunities = community.breakdown.smallCommunities + community.breakdown.mediumCommunities +
                                    community.breakdown.largeCommunities + community.breakdown.enterpriseCommunities;
            const avgCommunityFee = (params.smallCommunityFee + params.mediumCommunityFee +
                                    params.largeCommunityFee + params.enterpriseCommunityFee) / 4;
            const stakingAmount = totalCommunities *
                CONFIG.STAKING.COMMUNITY_PARTICIPATION_RATE *
                CONFIG.STAKING.COMMUNITY_FEE_MULTIPLIER *
                (avgCommunityFee / params.tokenPrice);
            const stakingCap = CONFIG.MONTHLY_EMISSION * CONFIG.STAKING.IDENTITY_CAP_PERCENT;

            // Special recapture for events (70% recapture rate)
            const eventSpecialRecapture = eventFeesVIWO * CONFIG.SPECIAL_RECAPTURE.EVENT_FEES;

            // Use unified recapture calculation
            const recapture = calculateModuleRecapture({
                moduleName: 'Community',
                moduleAllocation: CONFIG.MODULE_REVENUE_SHARE.COMMUNITY,
                transactionFeesVIWO: totalFeesVIWO,
                stakingConfig: {
                    amount: stakingAmount,
                    cap: stakingCap
                },
                specialRecaptures: {
                    events: eventSpecialRecapture
                }
            });

            const communityEmissions = recapture.moduleEmissions;
            const totalRecaptured = recapture.totalRecaptured;
            const recaptureRate = CONFIG.format(recapture.recaptureRate, 'percentage');

            // Update UI with formatted values (rounding only at display time)
            document.getElementById('communityEmissionPercent').textContent =
                CONFIG.format(CONFIG.MODULE_REVENUE_SHARE.COMMUNITY * 100, 'display') + '%';
            document.getElementById('communityEmissionAmount').textContent =
                'N/A'; // Modules don't emit!

            document.getElementById('communityRecaptureBurn').textContent =
                formatNumber(Math.round(recapture.burnVIWO));
            document.getElementById('communityRecaptureBurnPercent').textContent =
                CONFIG.format((recapture.burnVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('communityRecaptureTreasury').textContent =
                formatNumber(Math.round(recapture.treasuryVIWO));
            document.getElementById('communityRecaptureTreasuryPercent').textContent =
                CONFIG.format((recapture.treasuryVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('communityRecaptureStaking').textContent =
                formatNumber(Math.round(recapture.stakingVIWO));
            document.getElementById('communityRecaptureStakingPercent').textContent =
                CONFIG.format((recapture.stakingVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            const eventRecaptureVIWO = recapture.specialRecaptures.events || 0;
            document.getElementById('communityRecaptureEvents').textContent =
                formatNumber(Math.round(eventRecaptureVIWO));
            document.getElementById('communityRecaptureEventsPercent').textContent =
                CONFIG.format((eventRecaptureVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('communityRecaptureTotal').textContent =
                formatNumber(Math.round(recapture.totalRecaptured)) + ' VIWO/month';
            document.getElementById('communityRecaptureTotalPercent').textContent =
                CONFIG.format(recapture.recaptureRate, 'percentage') + '%';

            // Update summary text with smart interpretation
            let interpretation = '';
            const rate = recapture.recaptureRate;
            if (rate < 30) {
                interpretation = `Community module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month. Consider increasing fees or DAO staking requirements.`;
            } else if (rate < 60) {
                interpretation = `Community module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Healthy recapture rate. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else if (rate < 90) {
                interpretation = `Community module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Excellent! The module is highly sustainable. Net new supply: only ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else {
                interpretation = `Community module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Outstanding! Nearly pays for its own emissions. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            }
            document.getElementById('communityRecaptureSummary').textContent = interpretation;

            return recapture;
        }

        function updateAdvertisingModule(advertising) {
            // Update Core Features display
            document.getElementById('advertisingBannerCPMDisplay').textContent = params.bannerCPM.toFixed(2);
            document.getElementById('advertisingVideoCPMDisplay').textContent = params.videoCPM.toFixed(2);
            document.getElementById('advertisingPromotedPostDisplay').textContent = params.promotedPostFee.toFixed(2);
            document.getElementById('advertisingCampaignMgmtDisplay').textContent = params.campaignManagementFee.toFixed(2);
            document.getElementById('advertisingAnalyticsDisplay').textContent = params.adAnalyticsFee.toFixed(2);

            // Update revenue breakdown
            document.getElementById('advertisingBannerImpressionsCount').textContent = formatNumber(advertising.breakdown.bannerImpressions);
            document.getElementById('advertisingBannerCPMPrice').textContent = params.bannerCPM.toFixed(0);
            document.getElementById('advertisingBannerRevenue').textContent = '$' + formatNumber(advertising.breakdown.bannerRevenue);

            document.getElementById('advertisingVideoImpressionsCount').textContent = formatNumber(advertising.breakdown.videoImpressions);
            document.getElementById('advertisingVideoCPMPrice').textContent = params.videoCPM.toFixed(0);
            document.getElementById('advertisingVideoRevenue').textContent = '$' + formatNumber(advertising.breakdown.videoRevenue);

            document.getElementById('advertisingPromotedPostsCount').textContent = advertising.breakdown.promotedPosts;
            document.getElementById('advertisingPromotedPostPrice').textContent = params.promotedPostFee.toFixed(0);
            document.getElementById('advertisingPromotedRevenue').textContent = '$' + formatNumber(advertising.breakdown.promotedRevenue);

            document.getElementById('advertisingCampaignsCount').textContent = advertising.breakdown.campaigns;
            document.getElementById('advertisingCampaignPrice').textContent = params.campaignManagementFee.toFixed(0);
            document.getElementById('advertisingCampaignRevenue').textContent = '$' + formatNumber(advertising.breakdown.campaignRevenue);

            document.getElementById('advertisingAnalyticsCount').textContent = advertising.breakdown.analyticsSubscribers;
            document.getElementById('advertisingAnalyticsPrice').textContent = params.adAnalyticsFee.toFixed(0);
            document.getElementById('advertisingAnalyticsRevenue').textContent = '$' + formatNumber(advertising.breakdown.analyticsRevenue);

            document.getElementById('advertisingTotalRevenue').textContent = '$' + formatNumber(advertising.revenue);

            // Update costs and profit
            document.getElementById('advertisingCostsDetail').textContent = formatNumber(advertising.costs);
            const profitText = '$' + formatNumber(advertising.profit) + ' (' + advertising.margin + '% margin)';
            document.getElementById('advertisingProfitDetail').textContent = profitText;
            document.getElementById('advertisingProfitDetail').style.color = advertising.profit >= 0 ? 'var(--success-color)' : 'var(--danger-color)';

            // Update profitability summary
            const totalImpressions = advertising.breakdown.bannerImpressions + advertising.breakdown.videoImpressions;
            const summaryText = `<strong>Profitability:</strong> With ${params.startingUsers} users generating ${formatNumber(totalImpressions)} ad impressions/month (${advertising.breakdown.campaigns} campaigns), this module generates $${formatNumber(advertising.revenue)} monthly revenue against $${formatNumber(advertising.costs)} costs = $${formatNumber(advertising.profit)} profit (${advertising.margin}% margin).`;
            document.getElementById('advertisingProfitabilitySummary').innerHTML = summaryText;

            // Calculate and update Advertising Module Recapture
            calculateAdvertisingRecapture(advertising);
        }

        function calculateAdvertisingRecapture(advertising) {
            // Calculate transaction fees in VIWO (only promoted posts are transaction fees)
            const promotedPostsVIWO = advertising.breakdown.promotedPosts * (params.promotedPostFee / params.tokenPrice);

            // Calculate campaign deposits
            const depositsAmount = advertising.breakdown.campaigns *
                CONFIG.STAKING.ADVERTISING_CAMPAIGN_MULTIPLIER *
                (params.campaignManagementFee / params.tokenPrice);
            const depositsCap = CONFIG.MONTHLY_EMISSION * CONFIG.CAPS.ADVERTISING_DEPOSITS;

            // USD Profit Buyback (use ADAPTIVE buyback percent based on recapture)
            const adaptiveBuybackPercent = calculateAdaptiveBuyback(currentGlobalRecaptureRate, params.buybackPercent);
            const buybackAmount = (advertising.profit * adaptiveBuybackPercent) / params.tokenPrice;
            const buybackCap = CONFIG.MONTHLY_EMISSION * CONFIG.CAPS.ADVERTISING_BUYBACK;

            // Use unified recapture calculation
            const recapture = calculateModuleRecapture({
                moduleName: 'Advertising',
                moduleAllocation: CONFIG.MODULE_REVENUE_SHARE.ADVERTISING,
                transactionFeesVIWO: promotedPostsVIWO * CONFIG.FEE_COLLECTION_RATE,
                stakingConfig: {
                    amount: depositsAmount,
                    cap: depositsCap
                },
                buybackConfig: {
                    amount: buybackAmount,
                    cap: buybackCap
                }
            });

            const advertisingEmissions = recapture.moduleEmissions;
            const totalRecaptured = recapture.totalRecaptured;
            const recaptureRate = CONFIG.format(recapture.recaptureRate, 'percentage');

            // Update UI with formatted values (rounding only at display time)
            document.getElementById('advertisingEmissionPercent').textContent =
                CONFIG.format(CONFIG.MODULE_REVENUE_SHARE.ADVERTISING * 100, 'display') + '%';
            document.getElementById('advertisingEmissionAmount').textContent =
                'N/A'; // Modules don't emit!

            document.getElementById('advertisingRecaptureBurn').textContent =
                formatNumber(Math.round(recapture.burnVIWO));
            document.getElementById('advertisingRecaptureBurnPercent').textContent =
                CONFIG.format((recapture.burnVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('advertisingRecaptureTreasury').textContent =
                formatNumber(Math.round(recapture.treasuryVIWO));
            document.getElementById('advertisingRecaptureTreasuryPercent').textContent =
                CONFIG.format((recapture.treasuryVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('advertisingRecaptureStaking').textContent =
                formatNumber(Math.round(recapture.stakingVIWO));
            document.getElementById('advertisingRecaptureStakingPercent').textContent =
                CONFIG.format((recapture.stakingVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('advertisingRecaptureBuyback').textContent =
                formatNumber(Math.round(recapture.buybackVIWO || 0));
            document.getElementById('advertisingRecaptureBuybackPercent').textContent =
                CONFIG.format(((recapture.buybackVIWO || 0) / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('advertisingRecaptureTotal').textContent =
                formatNumber(Math.round(recapture.totalRecaptured)) + ' VIWO/month';
            document.getElementById('advertisingRecaptureTotalPercent').textContent =
                CONFIG.format(recapture.recaptureRate, 'percentage') + '%';

            // Update summary text with smart interpretation
            let interpretation = '';
            const rate = recapture.recaptureRate;
            if (rate < 30) {
                interpretation = `Advertising module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month. Consider increasing campaign deposits or fees.`;
            } else if (rate < 60) {
                interpretation = `Advertising module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Healthy recapture rate. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else if (rate < 90) {
                interpretation = `Advertising module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Excellent! The module is highly sustainable. Net new supply: only ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else {
                interpretation = `Advertising module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Outstanding! Nearly pays for its own emissions. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            }
            document.getElementById('advertisingRecaptureSummary').textContent = interpretation;

            return recapture;
        }

        function updateMessagingModule(messaging) {
            // Update Core Features display
            document.getElementById('messagingEncryptedDMDisplay').textContent = params.encryptedDMFee.toFixed(2);
            document.getElementById('messagingGroupChatDisplay').textContent = params.groupChatFee.toFixed(2);
            document.getElementById('messagingFileTransferDisplay').textContent = params.fileTransferFee.toFixed(2);
            document.getElementById('messagingVoiceCallDisplay').textContent = params.voiceCallFee.toFixed(2);
            document.getElementById('messagingStorageDisplay').textContent = params.messageStorageFee.toFixed(2);
            document.getElementById('messagingPremiumDisplay').textContent = params.messagingPremiumFee.toFixed(2);

            // Update revenue breakdown
            document.getElementById('messagingEncryptedCount').textContent = formatNumber(messaging.breakdown.encryptedMessages);
            document.getElementById('messagingEncryptedPrice').textContent = params.encryptedDMFee.toFixed(2);
            document.getElementById('messagingEncryptedRevenue').textContent = '$' + formatNumber(messaging.breakdown.encryptedRevenue);

            document.getElementById('messagingGroupsCount').textContent = messaging.breakdown.groupChats;
            document.getElementById('messagingGroupPrice').textContent = params.groupChatFee.toFixed(0);
            document.getElementById('messagingGroupRevenue').textContent = '$' + formatNumber(messaging.breakdown.groupRevenue);

            document.getElementById('messagingFilesCount').textContent = messaging.breakdown.fileTransfers;
            document.getElementById('messagingFilePrice').textContent = params.fileTransferFee.toFixed(2);
            document.getElementById('messagingFileRevenue').textContent = '$' + formatNumber(messaging.breakdown.fileRevenue);

            document.getElementById('messagingCallsCount').textContent = messaging.breakdown.voiceMinutes;
            document.getElementById('messagingCallPrice').textContent = params.voiceCallFee.toFixed(2);
            document.getElementById('messagingCallRevenue').textContent = '$' + formatNumber(messaging.breakdown.callRevenue);

            document.getElementById('messagingStorageCount').textContent = messaging.breakdown.storageUsers;
            document.getElementById('messagingStoragePrice').textContent = params.messageStorageFee.toFixed(0);
            document.getElementById('messagingStorageRevenue').textContent = '$' + formatNumber(messaging.breakdown.storageRevenue);

            document.getElementById('messagingPremiumCount').textContent = messaging.breakdown.premiumUsers;
            document.getElementById('messagingPremiumPrice').textContent = params.messagingPremiumFee.toFixed(0);
            document.getElementById('messagingPremiumRevenue').textContent = '$' + formatNumber(messaging.breakdown.premiumRevenue);

            document.getElementById('messagingTotalRevenue').textContent = '$' + formatNumber(messaging.revenue);

            // Update costs and profit
            document.getElementById('messagingCostsDetail').textContent = formatNumber(messaging.costs);
            const profitText = '$' + formatNumber(messaging.profit) + ' (' + messaging.margin + '% margin)';
            document.getElementById('messagingProfitDetail').textContent = profitText;
            document.getElementById('messagingProfitDetail').style.color = messaging.profit >= 0 ? 'var(--success-color)' : 'var(--danger-color)';

            // Update profitability summary
            const totalMessages = messaging.breakdown.encryptedMessages + messaging.breakdown.fileTransfers;
            const summaryText = `<strong>Profitability:</strong> With ${params.startingUsers} users sending ${formatNumber(totalMessages)} messages/month (${messaging.breakdown.premiumUsers} premium users), this module generates $${formatNumber(messaging.revenue)} monthly revenue against $${formatNumber(messaging.costs)} costs = $${formatNumber(messaging.profit)} profit (${messaging.margin}% margin).`;
            document.getElementById('messagingProfitabilitySummary').innerHTML = summaryText;

            // Calculate and update Messaging Module Recapture
            calculateMessagingRecapture(messaging);
        }

        function calculateMessagingRecapture(messaging) {
            // Calculate transaction fees in VIWO (apply FEE_COLLECTION_RATE)
            const encryptedFeesVIWO = messaging.breakdown.encryptedMessages * (params.encryptedDMFee / params.tokenPrice) * CONFIG.FEE_COLLECTION_RATE;
            const groupFeesVIWO = messaging.breakdown.groupChats * (params.groupChatFee / params.tokenPrice); // Group always has fee
            const fileFeesVIWO = messaging.breakdown.fileTransfers * (params.fileTransferFee / params.tokenPrice) * CONFIG.FEE_COLLECTION_RATE;
            const callFeesVIWO = messaging.breakdown.voiceMinutes * (params.voiceCallFee / params.tokenPrice) * CONFIG.FEE_COLLECTION_RATE;

            const totalFeesVIWO = encryptedFeesVIWO + groupFeesVIWO + fileFeesVIWO + callFeesVIWO;

            // Calculate staking
            const stakingAmount = messaging.breakdown.premiumUsers *
                CONFIG.STAKING.MESSAGING_PREMIUM_MULTIPLIER *
                (params.messagingPremiumFee / params.tokenPrice);
            const stakingCap = CONFIG.MONTHLY_EMISSION * CONFIG.STAKING.IDENTITY_CAP_PERCENT;

            // Special recapture for file transfers (70% recapture rate)
            const fileSpecialRecapture = fileFeesVIWO * CONFIG.SPECIAL_RECAPTURE.FILE_FEES;

            // Use unified recapture calculation
            const recapture = calculateModuleRecapture({
                moduleName: 'Messaging',
                moduleAllocation: CONFIG.MODULE_REVENUE_SHARE.MESSAGING,
                transactionFeesVIWO: totalFeesVIWO,
                stakingConfig: {
                    amount: stakingAmount,
                    cap: stakingCap
                },
                specialRecaptures: {
                    files: fileSpecialRecapture
                }
            });

            const messagingEmissions = recapture.moduleEmissions;
            const totalRecaptured = recapture.totalRecaptured;
            const recaptureRate = CONFIG.format(recapture.recaptureRate, 'percentage');

            // Update UI with formatted values (rounding only at display time)
            document.getElementById('messagingEmissionPercent').textContent =
                CONFIG.format(CONFIG.MODULE_REVENUE_SHARE.MESSAGING * 100, 'display') + '%';
            document.getElementById('messagingEmissionAmount').textContent =
                'N/A'; // Modules don't emit!

            document.getElementById('messagingRecaptureBurn').textContent =
                formatNumber(Math.round(recapture.burnVIWO));
            document.getElementById('messagingRecaptureBurnPercent').textContent =
                CONFIG.format((recapture.burnVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('messagingRecaptureTreasury').textContent =
                formatNumber(Math.round(recapture.treasuryVIWO));
            document.getElementById('messagingRecaptureTreasuryPercent').textContent =
                CONFIG.format((recapture.treasuryVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('messagingRecaptureStaking').textContent =
                formatNumber(Math.round(recapture.stakingVIWO));
            document.getElementById('messagingRecaptureStakingPercent').textContent =
                CONFIG.format((recapture.stakingVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            const fileRecaptureVIWO = recapture.specialRecaptures.files || 0;
            document.getElementById('messagingRecaptureFiles').textContent =
                formatNumber(Math.round(fileRecaptureVIWO));
            document.getElementById('messagingRecaptureFilesPercent').textContent =
                CONFIG.format((fileRecaptureVIWO / recapture.moduleEmissions) * 100, 'percentage') + '%';

            document.getElementById('messagingRecaptureTotal').textContent =
                formatNumber(Math.round(recapture.totalRecaptured)) + ' VIWO/month';
            document.getElementById('messagingRecaptureTotalPercent').textContent =
                CONFIG.format(recapture.recaptureRate, 'percentage') + '%';

            // Update summary text with smart interpretation
            let interpretation = '';
            const rate = recapture.recaptureRate;
            if (rate < 30) {
                interpretation = `Messaging module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month. Consider increasing fees or premium staking.`;
            } else if (rate < 60) {
                interpretation = `Messaging module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Healthy recapture rate. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else if (rate < 90) {
                interpretation = `Messaging module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Excellent! The module is highly sustainable. Net new supply: only ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            } else {
                interpretation = `Messaging module receives ${formatNumber(Math.round(recapture.moduleEmissions))} VIWO/month in rewards and recaptures ${formatNumber(Math.round(recapture.totalRecaptured))} VIWO (${CONFIG.format(rate, 'percentage')}%). Outstanding! Nearly pays for its own emissions. Net new supply: ${formatNumber(Math.round(recapture.netEmission))} VIWO/month.`;
            }
            document.getElementById('messagingRecaptureSummary').textContent = interpretation;

            return recapture;
        }

        function calculateIdentity() {
            const users = params.startingUsers;
            const verificationRate = params.verificationRate;

            // User distribution across tiers (no free tier - those use centralized profiles)
            // Of paid users, distribute based on pricing tiers
            const paidUsers = Math.round(users * verificationRate);

            // Distribution: 60% Basic, 30% Verified, 8% Premium, 2% Enterprise
            const basicUsers = Math.round(paidUsers * 0.60);
            const verifiedUsers = Math.round(paidUsers * 0.30);
            const premiumUsers = Math.round(paidUsers * 0.08);
            const enterpriseUsers = Math.round(paidUsers * 0.02);

            // Revenue from tier upgrades (monthly recurring)
            const tierRevenue = (basicUsers * params.basicPrice) +
                                (verifiedUsers * params.verifiedPrice) +
                                (premiumUsers * params.premiumPrice) +
                                (enterpriseUsers * params.enterprisePrice);

            // Revenue from profile transfers (estimate: 10% of paid users transfer profiles monthly)
            const monthlyTransfers = Math.round(paidUsers * 0.10);
            const transferRevenue = monthlyTransfers * params.transferFee;

            // Revenue from profile sales (based on monthly sales input)
            // Average profile sale price: ~$100 (mix of basic to premium profiles)
            const avgProfilePrice = 100; // USD
            const avgProfilePriceVIWO = avgProfilePrice / params.tokenPrice;
            const saleRevenue = params.monthlySales * avgProfilePrice * params.saleCommission;

            // Total revenue (all in USD)
            const totalRevenue = tierRevenue + transferRevenue + saleRevenue;

            // Operational costs scale with user base
            // Base: $500 for 1000 users (blockchain fees, smart contract execution, storage)
            const baseCosts = 500;
            const scaledCosts = baseCosts * Math.pow(users / 1000, 0.7);

            const profit = totalRevenue - scaledCosts;
            const margin = totalRevenue > 0 ? (profit / totalRevenue * 100).toFixed(1) : 0;

            return {
                revenue: totalRevenue,
                costs: scaledCosts,
                profit,
                margin,
                // Detailed breakdown for display
                breakdown: {
                    tierRevenue,
                    transferRevenue,
                    saleRevenue,
                    basicUsers,
                    verifiedUsers,
                    premiumUsers,
                    enterpriseUsers,
                    monthlyTransfers,
                    monthlySales: params.monthlySales
                }
            };
        }

        function calculateContent() {
            const users = params.startingUsers;
            const postsPerMonth = params.postsPerUser;
            const totalPosts = users * postsPerMonth;

            // Post type distribution: 60% text, 30% image, 8% video, 2% NFT mints
            const textPosts = Math.round(totalPosts * 0.60);
            const imagePosts = Math.round(totalPosts * 0.30);
            const videoPosts = Math.round(totalPosts * 0.08);
            const nftMints = Math.round(totalPosts * 0.02);

            // Revenue from post fees
            const postFeesRevenue = (textPosts * params.textPostFee) +
                                   (imagePosts * params.imagePostFee) +
                                   (videoPosts * params.videoPostFee) +
                                   (nftMints * params.nftMintFee);

            // Revenue from premium content subscriptions (5% of users subscribe)
            const premiumSubscribers = Math.round(users * 0.05);
            const premiumRevenue = premiumSubscribers * params.premiumContentSub;

            // Revenue from content boosts (10% of posts get boosted)
            const boostedPosts = Math.round(totalPosts * 0.10);
            const boostRevenue = boostedPosts * params.contentBoostFee;

            // Revenue from content NFT sales commission
            // Assume 50 NFT sales per month on marketplace
            const monthlyNFTSales = 50;
            const avgNFTPrice = 50; // $50 average
            const nftSalesRevenue = monthlyNFTSales * avgNFTPrice * params.contentSaleCommission;

            const totalRevenue = postFeesRevenue + premiumRevenue + boostRevenue + nftSalesRevenue;

            // Costs scale with activity
            const baseCosts = 800;
            const scaledCosts = baseCosts * Math.pow(users / 1000, 0.75) * Math.pow(postsPerMonth / 20, 0.6);

            const profit = totalRevenue - scaledCosts;
            const margin = totalRevenue > 0 ? (profit / totalRevenue * 100).toFixed(1) : 0;

            return {
                revenue: totalRevenue,
                costs: scaledCosts,
                profit,
                margin,
                breakdown: {
                    postFeesRevenue,
                    premiumRevenue,
                    boostRevenue,
                    nftSalesRevenue,
                    textPosts,
                    imagePosts,
                    videoPosts,
                    nftMints,
                    premiumSubscribers,
                    boostedPosts,
                    monthlyNFTSales
                }
            };
        }

        function calculateAdvertising() {
            const users = params.startingUsers;
            const postsPerMonth = params.postsPerUser;

            // Ad impressions: Users see 50 ads per month on average
            const adsPerUser = 50;
            const totalImpressions = users * adsPerUser;

            // Ad type distribution: 70% banner, 30% video
            const bannerImpressions = Math.round(totalImpressions * 0.70);
            const videoImpressions = Math.round(totalImpressions * 0.30);

            // Revenue from CPM ads (per 1000 impressions)
            // Apply adCPM multiplier to base CPM rates
            const bannerRevenue = (bannerImpressions / 1000) * params.bannerCPM * params.adCPM;
            const videoRevenue = (videoImpressions / 1000) * params.videoCPM * params.adCPM;

            // Revenue from promoted posts (5% of all posts get promoted)
            const totalPosts = users * postsPerMonth;
            const promotedPosts = Math.round(totalPosts * 0.05);
            const promotedRevenue = promotedPosts * params.promotedPostFee;

            // Revenue from campaign management (assume 5 campaigns per month)
            const monthlyCampaigns = 5;
            const campaignRevenue = monthlyCampaigns * params.campaignManagementFee;

            // Revenue from analytics dashboard (10% of advertisers subscribe)
            const advertisers = Math.round(users * 0.02); // 2% of users are advertisers
            const analyticsSubscribers = Math.round(advertisers * 0.10);
            const analyticsRevenue = analyticsSubscribers * params.adAnalyticsFee;

            const totalRevenue = bannerRevenue + videoRevenue + promotedRevenue + campaignRevenue + analyticsRevenue;

            // Costs scale with ad volume
            const baseCosts = 600;
            const scaledCosts = baseCosts * Math.pow(users / 1000, 0.7);

            const profit = totalRevenue - scaledCosts;
            const margin = totalRevenue > 0 ? (profit / totalRevenue * 100).toFixed(1) : 0;

            return {
                revenue: totalRevenue,
                costs: scaledCosts,
                profit,
                margin,
                breakdown: {
                    bannerRevenue,
                    videoRevenue,
                    promotedRevenue,
                    campaignRevenue,
                    analyticsRevenue,
                    bannerImpressions,
                    videoImpressions,
                    promotedPosts,
                    campaigns: monthlyCampaigns,
                    analyticsSubscribers
                }
            };
        }

        function calculateCommunity() {
            const users = params.startingUsers;

            // Community distribution: 10 users per community on average
            const totalCommunities = Math.round(users / 10);

            // Community size distribution: 50% small, 30% medium, 15% large, 5% enterprise
            const smallCommunities = Math.round(totalCommunities * 0.50);
            const mediumCommunities = Math.round(totalCommunities * 0.30);
            const largeCommunities = Math.round(totalCommunities * 0.15);
            const enterpriseCommunities = Math.round(totalCommunities * 0.05);

            // Revenue from community creation/management fees
            const communityRevenue = (smallCommunities * params.smallCommunityFee) +
                                   (mediumCommunities * params.mediumCommunityFee) +
                                   (largeCommunities * params.largeCommunityFee) +
                                   (enterpriseCommunities * params.enterpriseCommunityFee);

            // Revenue from event hosting (20% of communities host events monthly)
            const monthlyEvents = Math.round(totalCommunities * 0.20);
            const eventRevenue = monthlyEvents * params.eventHostingFee;

            // Revenue from community verification (10% of communities get verified)
            const verifiedCommunities = Math.round(totalCommunities * 0.10);
            const verificationRevenue = verifiedCommunities * params.communityVerificationFee;

            // Revenue from analytics access (15% of medium+ communities subscribe)
            const analyticsEligible = mediumCommunities + largeCommunities + enterpriseCommunities;
            const analyticsSubscribers = Math.round(analyticsEligible * 0.15);
            const analyticsRevenue = analyticsSubscribers * params.communityAnalyticsFee;

            const totalRevenue = communityRevenue + eventRevenue + verificationRevenue + analyticsRevenue;

            // Costs scale with community count
            const baseCosts = 400;
            const scaledCosts = baseCosts * Math.pow(users / 1000, 0.6);

            const profit = totalRevenue - scaledCosts;
            const margin = totalRevenue > 0 ? (profit / totalRevenue * 100).toFixed(1) : 0;

            return {
                revenue: totalRevenue,
                costs: scaledCosts,
                profit,
                margin,
                breakdown: {
                    tierRevenue: communityRevenue,
                    eventRevenue,
                    verificationRevenue,
                    analyticsRevenue,
                    smallCommunities,
                    mediumCommunities,
                    largeCommunities,
                    enterpriseCommunities,
                    eventsHosted: monthlyEvents,
                    verifications: verifiedCommunities,
                    analyticsSubscribers
                }
            };
        }

        function calculateMessaging() {
            const users = params.startingUsers;

            // Messaging activity: Average 100 messages per user per month
            const messagesPerUser = 100;
            const totalMessages = users * messagesPerUser;

            // Message type distribution: 80% regular, 20% encrypted
            const regularMessages = Math.round(totalMessages * 0.80);
            const encryptedMessages = Math.round(totalMessages * 0.20);

            // Revenue from encrypted messaging fees
            const encryptedRevenue = encryptedMessages * params.encryptedDMFee;

            // Revenue from group chats (30% of users create/join paid groups)
            const groupChatUsers = Math.round(users * 0.30);
            const groupRevenue = groupChatUsers * params.groupChatFee;

            // Revenue from file transfers (average 5 files per user per month)
            const filesPerUser = 5;
            const totalFiles = users * filesPerUser;
            const fileRevenue = totalFiles * params.fileTransferFee;

            // Revenue from voice/video calls (10% of users make calls, avg 30 min/month)
            const callUsers = Math.round(users * 0.10);
            const avgCallMinutes = 30;
            const callRevenue = callUsers * avgCallMinutes * params.voiceCallFee;

            // Revenue from message storage (20% of users subscribe)
            const storageSubscribers = Math.round(users * 0.20);
            const storageRevenue = storageSubscribers * params.messageStorageFee;

            // Revenue from premium features (15% of active users)
            const premiumUsers = Math.round(users * 0.15);
            const premiumRevenue = premiumUsers * params.messagingPremiumFee;

            const totalRevenue = encryptedRevenue + groupRevenue + fileRevenue +
                               callRevenue + storageRevenue + premiumRevenue;

            // Costs scale with message volume
            const baseCosts = 300;
            const scaledCosts = baseCosts * Math.pow(users / 1000, 0.6);

            const profit = totalRevenue - scaledCosts;
            const margin = totalRevenue > 0 ? (profit / totalRevenue * 100).toFixed(1) : 0;

            return {
                revenue: totalRevenue,
                costs: scaledCosts,
                profit,
                margin,
                breakdown: {
                    encryptedRevenue,
                    groupRevenue,
                    fileRevenue,
                    callRevenue,
                    storageRevenue,
                    premiumRevenue,
                    encryptedMessages,
                    groupChats: groupChatUsers,
                    fileTransfers: totalFiles,
                    voiceMinutes: callUsers * avgCallMinutes,
                    storageUsers: storageSubscribers,
                    premiumUsers
                }
            };
        }

        /**
         * Calculate adaptive burn rate based on recapture performance
         * Increases burn when recapture is low to combat inflation
         */
        function calculateAdaptiveBurnRate(currentRecaptureRate, userBurnRate) {
            let adaptiveBurn = userBurnRate;

            // If recapture is low, increase burn rate to reduce inflation
            if (currentRecaptureRate < 10) {
                adaptiveBurn = Math.max(userBurnRate, 0.50);  // Minimum 50% burn
            } else if (currentRecaptureRate < 20) {
                adaptiveBurn = Math.max(userBurnRate, 0.35);  // Minimum 35% burn
            } else if (currentRecaptureRate < 40) {
                adaptiveBurn = Math.max(userBurnRate, 0.25);  // Minimum 25% burn
            }
            // else: use user-controlled burn rate

            console.log('Adaptive Burn: user=' + (userBurnRate*100).toFixed(1) + '%, adaptive=' + (adaptiveBurn*100).toFixed(1) + '%, recapture=' + currentRecaptureRate.toFixed(1) + '%');
            return adaptiveBurn;
        }

        /**
         * Calculate adaptive buyback percentage based on recapture performance
         * Increases buyback when recapture is low
         */
        function calculateAdaptiveBuyback(currentRecaptureRate, userBuybackPercent) {
            let adaptiveBuyback = userBuybackPercent;

            // If recapture is low, increase buyback
            if (currentRecaptureRate < 20) {
                adaptiveBuyback = Math.min(userBuybackPercent * 2, 0.50);  // 2x (max 50%)
            } else if (currentRecaptureRate < 40) {
                adaptiveBuyback = Math.min(userBuybackPercent * 1.5, 0.40);  // 1.5x (max 40%)
            }

            console.log('Adaptive Buyback: user=' + (userBuybackPercent*100).toFixed(1) + '%, adaptive=' + (adaptiveBuyback*100).toFixed(1) + '%, recapture=' + currentRecaptureRate.toFixed(1) + '%');
            return adaptiveBuyback;
        }

        /**
         * Calculate adaptive daily emission based on user activity and recapture rate
         * This reduces emissions when activity is low or recapture is weak
         */
        function calculateAdaptiveDailyEmission(users, currentRecaptureRate) {
            // Maximum possible emission (fixed cap - never exceeds this)
            const MAX_DAILY_EMISSION = Math.round(CONFIG.MONTHLY_EMISSION / 30);

            // Base emission per active user per day
            const BASE_EMISSION_PER_ACTIVE_USER = 100;  // VIWO tokens

            // Estimate active users (30% of total users are daily active)
            const estimatedDailyActiveUsers = Math.max(100, Math.round(users * 0.3));

            // Calculate activity-based emission
            const activityBasedEmission = estimatedDailyActiveUsers * BASE_EMISSION_PER_ACTIVE_USER;

            // Apply inflation adjustment based on recapture rate
            let inflationMultiplier = 1.0;
            if (currentRecaptureRate < 10) {
                inflationMultiplier = 0.4;  // Reduce 60% when recapture is very low
            } else if (currentRecaptureRate < 20) {
                inflationMultiplier = 0.6;  // Reduce 40% when recapture is low
            } else if (currentRecaptureRate < 40) {
                inflationMultiplier = 0.8;  // Reduce 20% when recapture is moderate
            }
            // else: full emission (recapture >= 40%)

            const adjustedEmission = activityBasedEmission * inflationMultiplier;

            // Never exceed the maximum cap
            const finalEmission = Math.min(adjustedEmission, MAX_DAILY_EMISSION);

            return {
                adaptiveEmission: Math.round(finalEmission),
                maxEmission: MAX_DAILY_EMISSION,
                activityBasedEmission: Math.round(activityBasedEmission),
                inflationMultiplier,
                estimatedActiveUsers: estimatedDailyActiveUsers
            };
        }

        function calculateRewards(currentRecaptureRate = 0) {
            // FIXED: Use CONFIG.MONTHLY_EMISSION as the base (5.83M)
            // rewardAllocationPercent determines what % of this goes to reward pool
            const maxMonthlyEmission = CONFIG.MONTHLY_EMISSION; // 5.83M VIWO
            const monthlyEmission = Math.round(maxMonthlyEmission * params.rewardAllocationPercent);
            const dailyEmission = Math.round(monthlyEmission / 30);

            const emissionUSD = monthlyEmission * params.tokenPrice;
            const opCosts = 200;

            // For backward compatibility, keep reward pool = emission (since we already applied allocation)
            const dailyRewardPool = dailyEmission;
            const dailyRewardPoolUSD = dailyRewardPool * params.tokenPrice;
            const monthlyRewardPool = monthlyEmission;
            const allocationPercent = Math.round(params.rewardAllocationPercent * 100);

            console.log('=== calculateRewards ===');
            console.log('CONFIG.MONTHLY_EMISSION:', CONFIG.MONTHLY_EMISSION);
            console.log('rewardAllocationPercent:', params.rewardAllocationPercent);
            console.log('monthlyEmission (after allocation):', monthlyEmission);
            console.log('dailyEmission:', dailyEmission);

            return {
                monthlyEmission,
                maxMonthlyEmission,
                emissionUSD,
                opCosts,
                dailyEmission,
                dailyRewardPool,
                dailyRewardPoolUSD,
                monthlyRewardPool,
                allocationPercent
            };
        }

        function updateRewardsModule(rewards) {
            // Update daily reward pool displays
            const dailyPool = rewards.dailyRewardPool;
            const dailyPoolUSD = rewards.dailyRewardPoolUSD;
            const allocationPercent = rewards.allocationPercent;

            document.getElementById('dailyRewardPool').textContent = formatNumber(dailyPool);
            document.getElementById('dailyRewardPoolUSD').textContent = dailyPoolUSD.toFixed(2);
            document.getElementById('rewardAllocationDisplay').textContent = allocationPercent;
            document.getElementById('maxRewardDisplay').textContent = '$' + params.maxDailyRewardUSD.toFixed(0);

            // Update activity points displays
            document.getElementById('rewardTextPoints').textContent = params.textPostPoints;
            document.getElementById('rewardImagePoints').textContent = params.imagePostPoints;
            document.getElementById('rewardVideoPoints').textContent = params.videoPostPoints;
            document.getElementById('rewardLikePoints').textContent = params.likePoints;
            document.getElementById('rewardCommentPoints').textContent = params.commentPoints;
            document.getElementById('rewardSharePoints').textContent = params.sharePoints;
            document.getElementById('rewardFollowPoints').textContent = params.followPoints;

            // Update anti-bot caps
            document.getElementById('maxRewardCap').textContent = '$' + params.maxDailyRewardUSD.toFixed(0);
            document.getElementById('rewardMaxPosts').textContent = params.maxPostsPerDay;
            document.getElementById('rewardMaxPosts2').textContent = params.maxPostsPerDay;
            document.getElementById('rewardMaxLikes').textContent = params.maxLikesPerDay;
            document.getElementById('rewardMaxComments').textContent = params.maxCommentsPerDay;
            document.getElementById('antiBotMaxPosts').textContent = params.maxPostsPerDay;
            document.getElementById('antiBotMaxLikes').textContent = params.maxLikesPerDay;
            document.getElementById('antiBotMaxComments').textContent = params.maxCommentsPerDay;

            // Update quality multipliers
            document.getElementById('highQualityExample').textContent = params.highQualityMultiplier.toFixed(1) + 'x';
            document.getElementById('verifiedMultDisplay').textContent = params.verifiedMultiplier.toFixed(1) + 'x';
            document.getElementById('premiumMultDisplay').textContent = params.premiumMultiplier.toFixed(1) + 'x';

            // Update decay percentages
            document.getElementById('day7DecayDisplay').textContent = params.day7Decay + '%';
            document.getElementById('day30DecayDisplay').textContent = params.day30Decay + '%';

            // Update algorithm pool displays
            document.getElementById('algoRewardPool').textContent = formatNumber(dailyPool);
            document.getElementById('algoRewardPoolUSD').textContent = '$' + dailyPoolUSD.toFixed(2);
            document.getElementById('simDailyPool').textContent = formatNumber(dailyPool);

            // Update sustainability section
            document.getElementById('sustainDailyPool').textContent = formatNumber(dailyPool);
            document.getElementById('sustainAllocation').textContent = allocationPercent;

            // Update reward flow section
            updateRewardFlow(rewards);

            // Calculate and update reward distribution simulator
            updateRewardSimulator(dailyPool);
        }

        function updateRewardFlow(rewards) {
            const dailyEmission = rewards.dailyEmission;
            const dailyPool = rewards.dailyRewardPool;
            const allocationPercent = rewards.allocationPercent;

            // Update emission and pool displays
            document.getElementById('flowDailyEmission').textContent = formatNumber(dailyEmission);
            document.getElementById('flowDailyPool').textContent = formatNumber(dailyPool);
            document.getElementById('flowAllocationPct').textContent = allocationPercent;

            // Calculate distribution breakdown (40%, 20%, 10%, 10%, 10%, 5%, 5%)
            const contentAlloc = Math.round(dailyPool * 0.40);
            const curationAlloc = Math.round(dailyPool * 0.20);
            const communityAlloc = Math.round(dailyPool * 0.10);
            const moderationAlloc = Math.round(dailyPool * 0.10);
            const engagementAlloc = Math.round(dailyPool * 0.10);
            const identityAlloc = Math.round(dailyPool * 0.05);
            const referralAlloc = Math.round(dailyPool * 0.05);

            // Estimate active users for each reward category based on total users
            const estimatedContentCreators = Math.max(20, Math.round(params.startingUsers * 0.10)); // 10% create content daily
            const estimatedCurators = Math.max(30, Math.round(params.startingUsers * 0.15)); // 15% curate content daily
            const estimatedCommunityUsers = Math.max(5, Math.round(params.startingUsers * 0.01)); // 1% create/join communities daily
            const estimatedModerationUsers = Math.max(10, Math.round(params.startingUsers * 0.01)); // 1% are active moderators
            const estimatedEngagementUsers = Math.max(50, Math.round(params.startingUsers * 0.25)); // 25% actively engage daily
            const estimatedIdentityUsers = Math.max(25, Math.round(params.startingUsers * 0.05)); // 5% complete identity tasks daily
            const estimatedReferralUsers = Math.max(10, Math.round(params.startingUsers * 0.02)); // 2% refer others daily

            document.getElementById('flowContentAlloc').textContent = formatNumber(contentAlloc) + ' VIWO';
            document.getElementById('flowContentAvg').textContent = formatNumber(Math.round(contentAlloc / estimatedContentCreators)) + ' VIWO';

            document.getElementById('flowCurationAlloc').textContent = formatNumber(curationAlloc) + ' VIWO';
            document.getElementById('flowCurationAvg').textContent = formatNumber(Math.round(curationAlloc / estimatedCurators)) + ' VIWO';

            document.getElementById('flowCommunityAlloc').textContent = formatNumber(communityAlloc) + ' VIWO';
            document.getElementById('flowCommunityAvg').textContent = formatNumber(Math.round(communityAlloc / estimatedCommunityUsers)) + ' VIWO';

            document.getElementById('flowModerationAlloc').textContent = formatNumber(moderationAlloc) + ' VIWO';
            document.getElementById('flowModerationAvg').textContent = formatNumber(Math.round(moderationAlloc / estimatedModerationUsers)) + ' VIWO';

            document.getElementById('flowEngagementAlloc').textContent = formatNumber(engagementAlloc) + ' VIWO';
            document.getElementById('flowEngagementAvg').textContent = formatNumber(Math.round(engagementAlloc / estimatedEngagementUsers)) + ' VIWO';

            document.getElementById('flowIdentityAlloc').textContent = formatNumber(identityAlloc) + ' VIWO';
            document.getElementById('flowIdentityAvg').textContent = formatNumber(Math.round(identityAlloc / estimatedIdentityUsers)) + ' VIWO';

            document.getElementById('flowReferralAlloc').textContent = formatNumber(referralAlloc) + ' VIWO';
            document.getElementById('flowReferralAvg').textContent = formatNumber(Math.round(referralAlloc / estimatedReferralUsers)) + ' VIWO';

            document.getElementById('flowTotalAlloc').textContent = formatNumber(dailyPool) + ' VIWO';
            // Calculate average per daily active user (assume 30% of total users are daily active)
            const estimatedDailyActiveUsers = Math.max(100, Math.round(params.startingUsers * 0.3));
            document.getElementById('flowTotalAvg').textContent = formatNumber(Math.round(dailyPool / estimatedDailyActiveUsers)) + ' VIWO avg';
        }

        function updateRewardSimulator(dailyPool) {
            // Simulate different user profiles based on current parameters

            // Top Quality Creator: 5 posts + 100 likes + 20 comments + 10 shares
            const topCreatorRaw = (5 * params.videoPostPoints) + (100 * params.likePoints) +
                                  (20 * params.commentPoints) + (10 * params.sharePoints);
            const topCreatorMult = params.premiumMultiplier * params.highQualityMultiplier;
            const topCreatorFinal = Math.round(topCreatorRaw * topCreatorMult);

            // Active Verified User: 2 posts + 50 likes + 10 comments + 5 shares
            const activeUserRaw = (2 * params.imagePostPoints) + (50 * params.likePoints) +
                                  (10 * params.commentPoints) + (5 * params.sharePoints);
            const activeUserMult = params.verifiedMultiplier * 1.5;  // Medium quality
            const activeUserFinal = Math.round(activeUserRaw * activeUserMult);

            // Regular User: 1 post + 30 likes + 5 comments
            const regularUserRaw = (1 * params.textPostPoints) + (30 * params.likePoints) +
                                   (5 * params.commentPoints);
            const regularUserMult = 1.0;  // Normal quality, basic user
            const regularUserFinal = Math.round(regularUserRaw * regularUserMult);

            // New User: 10 likes + 3 comments
            const newUserRaw = (10 * params.likePoints) + (3 * params.commentPoints);
            const newUserMult = 0.5;  // New user penalty
            const newUserFinal = Math.round(newUserRaw * newUserMult);

            // Bot/Spammer: High volume but flagged
            const botUserRaw = (200 * params.textPostPoints) + (1000 * params.likePoints);
            const botUserMult = 0.1;  // Severe penalty
            const botUserFinal = Math.round(botUserRaw * botUserMult);

            // Calculate total points for the platform (simulate with these 5 users + some baseline)
            // Baseline points = estimated average user (50 points/day) * starting users
            const baselinePoints = Math.round(params.startingUsers * 50);
            const totalPlatformPoints = topCreatorFinal + activeUserFinal + regularUserFinal +
                                       newUserFinal + baselinePoints;

            // Calculate rewards as share of daily pool
            const maxDailyRewardVIWO = params.maxDailyRewardUSD / params.tokenPrice;

            let topCreatorReward = Math.round((topCreatorFinal / totalPlatformPoints) * dailyPool);
            let activeUserReward = Math.round((activeUserFinal / totalPlatformPoints) * dailyPool);
            let regularUserReward = Math.round((regularUserFinal / totalPlatformPoints) * dailyPool);
            let newUserReward = Math.round((newUserFinal / totalPlatformPoints) * dailyPool);
            const botUserReward = 0;  // Flagged users get 0

            // Apply max daily reward cap
            topCreatorReward = Math.min(topCreatorReward, maxDailyRewardVIWO);
            activeUserReward = Math.min(activeUserReward, maxDailyRewardVIWO);
            regularUserReward = Math.min(regularUserReward, maxDailyRewardVIWO);
            newUserReward = Math.min(newUserReward, maxDailyRewardVIWO);

            // Update the table
            document.getElementById('topCreatorRaw').textContent = formatNumber(topCreatorRaw);
            document.getElementById('topCreatorMult').textContent = topCreatorMult.toFixed(1) + 'x';
            document.getElementById('topCreatorFinal').textContent = formatNumber(topCreatorFinal);
            document.getElementById('topCreatorReward').innerHTML =
                formatNumber(topCreatorReward) + ' VIWO<br><span style="font-size: 11px;">($' +
                (topCreatorReward * params.tokenPrice).toFixed(2) + '/day)</span>';

            document.getElementById('activeUserRaw').textContent = formatNumber(activeUserRaw);
            document.getElementById('activeUserMult').textContent = activeUserMult.toFixed(1) + 'x';
            document.getElementById('activeUserFinal').textContent = formatNumber(activeUserFinal);
            document.getElementById('activeUserReward').innerHTML =
                formatNumber(activeUserReward) + ' VIWO<br><span style="font-size: 11px;">($' +
                (activeUserReward * params.tokenPrice).toFixed(2) + '/day)</span>';

            document.getElementById('regularUserRaw').textContent = formatNumber(regularUserRaw);
            document.getElementById('regularUserMult').textContent = regularUserMult.toFixed(1) + 'x';
            document.getElementById('regularUserFinal').textContent = formatNumber(regularUserFinal);
            document.getElementById('regularUserReward').innerHTML =
                formatNumber(regularUserReward) + ' VIWO<br><span style="font-size: 11px;">($' +
                (regularUserReward * params.tokenPrice).toFixed(2) + '/day)</span>';

            document.getElementById('newUserRaw').textContent = formatNumber(newUserRaw);
            document.getElementById('newUserMult').textContent = newUserMult.toFixed(1) + 'x';
            document.getElementById('newUserFinal').textContent = formatNumber(newUserFinal);
            document.getElementById('newUserReward').innerHTML =
                formatNumber(newUserReward) + ' VIWO<br><span style="font-size: 11px;">($' +
                (newUserReward * params.tokenPrice).toFixed(2) + '/day)</span>';

            document.getElementById('botUserRaw').textContent = formatNumber(botUserRaw);
            document.getElementById('botUserMult').textContent = botUserMult.toFixed(1) + 'x';
            document.getElementById('botUserFinal').textContent = formatNumber(botUserFinal);
            document.getElementById('botUserReward').innerHTML =
                '0 VIWO<br><span style="font-size: 11px;">(Flagged)</span>';
        }

        function calculateRecapture(identity, content, advertising, community, messaging, totalProfit, rewards) {
            // The emission we care about is what actually goes to users (reward pool)
            // This is affected by rewardAllocationPercent
            // monthlyEmission = total emission (e.g., 5.83M)
            // monthlyRewardPool = emission * allocation% (e.g., 5.83M * 90% = 5.25M)
            const monthlyEmission = rewards.monthlyRewardPool; // What actually goes to circulation
            const totalMonthlyEmission = rewards.monthlyEmission; // Total emission for reference

            console.log('=== calculateRecapture ===');
            console.log('totalMonthlyEmission:', totalMonthlyEmission);
            console.log('monthlyRewardPool (used for recapture):', monthlyEmission);
            console.log('allocationPercent:', rewards.allocationPercent + '%');

            // Use the SAME module-specific recapture calculations as the UI
            // This ensures export matches runtime calculations exactly
            const identityRecapture = calculateIdentityRecapture(identity);
            const contentRecapture = calculateContentRecapture(content);
            const communityRecapture = calculateCommunityRecapture(community);
            const advertisingRecapture = calculateAdvertisingRecapture(advertising);
            const messagingRecapture = calculateMessagingRecapture(messaging);

            // Aggregate recapture from all modules
            let totalBurns = identityRecapture.burnVIWO + contentRecapture.burnVIWO +
                            communityRecapture.burnVIWO + advertisingRecapture.burnVIWO +
                            messagingRecapture.burnVIWO;

            let totalTreasury = identityRecapture.treasuryVIWO + contentRecapture.treasuryVIWO +
                               communityRecapture.treasuryVIWO + advertisingRecapture.treasuryVIWO +
                               messagingRecapture.treasuryVIWO;

            let totalStaking = identityRecapture.stakingVIWO + contentRecapture.stakingVIWO +
                              communityRecapture.stakingVIWO + advertisingRecapture.stakingVIWO +
                              messagingRecapture.stakingVIWO;

            let totalOther = (contentRecapture.royaltiesVIWO || 0) + (advertisingRecapture.buybackVIWO || 0);

            // Extract individual module values for legacy UI code (these variables are used later)
            const identityBurn = identityRecapture.burnVIWO;
            const identityTreasury = identityRecapture.treasuryVIWO;
            const identityStaking = identityRecapture.stakingVIWO;

            const contentBurn = contentRecapture.burnVIWO;
            const contentTreasury = contentRecapture.treasuryVIWO;
            const contentStaking = contentRecapture.stakingVIWO;
            const contentNFTRoyalties = contentRecapture.royaltiesVIWO || 0;

            const communityBurn = communityRecapture.burnVIWO;
            const communityTreasury = communityRecapture.treasuryVIWO;
            const communityStaking = communityRecapture.stakingVIWO;

            const advertisingBurn = advertisingRecapture.burnVIWO;
            const advertisingTreasury = advertisingRecapture.treasuryVIWO;
            const advertisingDeposits = advertisingRecapture.stakingVIWO;
            const advertisingBuyback = advertisingRecapture.buybackVIWO || 0;

            const messagingBurn = messagingRecapture.burnVIWO;
            const messagingTreasury = messagingRecapture.treasuryVIWO;
            const messagingStaking = messagingRecapture.stakingVIWO;

            // APPLY GLOBAL SAFETY CAPS - Prevent impossible recapture amounts
            // These caps ensure we never burn/buyback more than physically exists
            const burnsCapped = applySafetyCaps(totalBurns, 'burn', monthlyEmission);
            const treasuryCapped = applySafetyCaps(totalTreasury, 'treasury', monthlyEmission);
            const stakingCapped = applySafetyCaps(totalStaking, 'staking', monthlyEmission);
            const buybacksCapped = applySafetyCaps(totalOther, 'buyback', monthlyEmission);

            // Calculate total with capped values
            let totalRecapturedRaw = burnsCapped + treasuryCapped + stakingCapped + buybacksCapped;

            // FINAL SAFETY CHECK: Total recapture can NEVER exceed 95% of monthly emissions
            // This is the absolute hard limit - you can't recapture more than you emitted!
            const maxPossibleRecapture = monthlyEmission * CONFIG.ABSOLUTE_CAPS.MAX_RECAPTURE_RATE;
            const totalRecaptured = Math.min(totalRecapturedRaw, maxPossibleRecapture);

            // If we had to cap, proportionally reduce each component
            let burns, treasury, staking, buybacks;
            if (totalRecapturedRaw > maxPossibleRecapture) {
                const scaleFactor = maxPossibleRecapture / totalRecapturedRaw;
                burns = burnsCapped * scaleFactor;
                treasury = treasuryCapped * scaleFactor;
                staking = stakingCapped * scaleFactor;
                buybacks = buybacksCapped * scaleFactor;
            } else {
                burns = burnsCapped;
                treasury = treasuryCapped;
                staking = stakingCapped;
                buybacks = buybacksCapped;
            }

            // Calculate final metrics
            const recaptureRate = Math.min((totalRecaptured / monthlyEmission * 100), CONFIG.ABSOLUTE_CAPS.MAX_RECAPTURE_RATE * 100).toFixed(1);
            const netEmission = Math.max(0, monthlyEmission - totalRecaptured);

            const burnPct = (burns / monthlyEmission * 100).toFixed(1);
            const buybackPct = (buybacks / monthlyEmission * 100).toFixed(1);
            const stakingPct = (staking / monthlyEmission * 100).toFixed(1);
            const netPct = (netEmission / monthlyEmission * 100).toFixed(1);

            console.log('=== Recapture Breakdown ===');
            console.log('Burns:', formatNumber(burns), 'VIWO (' + burnPct + '%)');
            console.log('Buybacks:', formatNumber(buybacks), 'VIWO (' + buybackPct + '%)');
            console.log('Staking:', formatNumber(staking), 'VIWO (' + stakingPct + '%)');
            console.log('Recapture Rate:', recaptureRate + '%');

            // Update Monthly Reward Flow header with actual emission amount
            // Show the portion that actually goes to rewards (affected by rewardAllocationPercent)
            const monthlyEmissionFormatted = (monthlyEmission / 1000000).toFixed(2) + 'M';
            const totalEmissionFormatted = (totalMonthlyEmission / 1000000).toFixed(2) + 'M';
            document.getElementById('monthlyRewardFlowAmount').textContent = monthlyEmissionFormatted;
            document.getElementById('monthlyEmission').textContent = monthlyEmissionFormatted;

            console.log('Reward Allocation: ' + (rewards.allocationPercent) + '%');
            console.log('Monthly Reward Pool: ' + monthlyEmissionFormatted + ' (from total ' + totalEmissionFormatted + ')');

            // Update Overview section visualizations
            document.getElementById('burnSegment').style.width = burnPct + '%';
            document.getElementById('burnPercent').textContent = burnPct + '%';
            document.getElementById('burnAmount').textContent = formatNumber(burns) + ' VIWO';

            document.getElementById('buybackSegment').style.width = buybackPct + '%';
            document.getElementById('buybackPercent').textContent = buybackPct + '%';
            document.getElementById('buybackAmount').textContent = formatNumber(buybacks) + ' VIWO';

            document.getElementById('stakingSegment').style.width = stakingPct + '%';
            document.getElementById('stakingPercent').textContent = stakingPct + '%';
            document.getElementById('stakingAmount').textContent = formatNumber(staking) + ' VIWO';

            document.getElementById('circulationSegment').style.width = netPct + '%';
            document.getElementById('circulationPercent').textContent = netPct + '%';
            document.getElementById('netEmission').textContent = formatNumber(netEmission) + ' VIWO';

            document.getElementById('totalRecapture').textContent = formatNumber(totalRecaptured);
            document.getElementById('recaptureRate').textContent = recaptureRate + '%';
            document.getElementById('headerRecapture').textContent = recaptureRate + '%';

            const emissionValue = monthlyEmission * params.tokenPrice;
            const recaptureValue = totalRecaptured * params.tokenPrice;
            document.getElementById('emissionValue').textContent = '$' + formatNumber(emissionValue);
            document.getElementById('recaptureValue').textContent = '$' + formatNumber(recaptureValue);

            let interpretation = '';
            if (recaptureRate < 10) {
                interpretation = `<strong>Low Recapture (${recaptureRate}%):</strong> Only ${recaptureRate}% of emissions return to protocol through ${formatNumber(burns)} VIWO burns, ${formatNumber(buybacks)} VIWO buybacks, and ${formatNumber(staking)} VIWO staking. This is inflationary - consider increasing fees or buyback percentage.`;
            } else if (recaptureRate < 20) {
                interpretation = `<strong>Moderate Recapture (${recaptureRate}%):</strong> ${recaptureRate}% of emissions return through ${formatNumber(burns)} VIWO burns, ${formatNumber(buybacks)} VIWO buybacks, and ${formatNumber(staking)} VIWO staking. This is sustainable with current revenue. Net inflation: ${formatNumber(netEmission)} VIWO/month.`;
            } else if (recaptureRate < 40) {
                interpretation = `<strong>High Recapture (${recaptureRate}%):</strong> ${recaptureRate}% of emissions return to protocol through ${formatNumber(burns)} VIWO burns, ${formatNumber(buybacks)} VIWO buybacks, and ${formatNumber(staking)} VIWO staking. Very sustainable! Net inflation is low at ${formatNumber(netEmission)} VIWO/month.`;
            } else {
                interpretation = `<strong>Excellent Recapture (${recaptureRate}%):</strong> ${recaptureRate}% of emissions return! The protocol recaptures ${formatNumber(burns)} VIWO through burns, ${formatNumber(buybacks)} VIWO through buybacks/royalties, and ${formatNumber(staking)} VIWO through staking. Nearly self-sustaining with minimal net inflation of ${formatNumber(netEmission)} VIWO/month.`;
            }
            document.getElementById('recaptureInterpretation').innerHTML = interpretation;

            // Update Overview section dynamic text
            const totalRevenue = identity.revenue + content.revenue + advertising.revenue + community.revenue + messaging.revenue;
            const totalCosts = identity.costs + content.costs + advertising.costs + community.costs + messaging.costs + rewards.opCosts;
            const overviewMargin = totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0;

            const overviewSummary = `<strong>Mission Accomplished:</strong> All 5 revenue modules (Identity, Content, Community, Advertising, Messaging) generate $${formatNumber(totalRevenue)} monthly revenue with $${formatNumber(totalProfit)} net profit (${overviewMargin}% margin) starting from Day 1 with ${params.startingUsers} users. The system recaptures ${recaptureRate}% of distributed rewards through burns (${formatNumber(burns)} VIWO), buybacks (${formatNumber(buybacks)} VIWO), and staking (${formatNumber(staking)} VIWO).`;
            document.getElementById('overviewMissionSummary').innerHTML = overviewSummary;

            // Update overview subtitle
            document.getElementById('overviewSubtitle').textContent = `Starting with ${params.startingUsers} Users - All Modules Profitable Day 1`;

            // Update overview user count
            document.getElementById('overviewUsersCount').textContent = params.startingUsers;

            // Update Reward Flow section table
            const monthlyEmissionNum = CONFIG.MONTHLY_EMISSION;

            // Identity row - Shows revenue share, not emission!
            document.getElementById('rfIdentityEmission').innerHTML = `~5%<br><span style="font-size: 11px;">(Revenue)</span>`;
            document.getElementById('rfIdentityFees').textContent = formatNumber(identityBurn + identityTreasury) + ' VIWO';
            document.getElementById('rfIdentityBuyback').textContent = '0 VIWO';
            document.getElementById('rfIdentityStaking').textContent = formatNumber(identityStaking) + ' VIWO';
            const identityTotalRecap = identityBurn + identityTreasury + identityStaking;
            document.getElementById('rfIdentityTotal').textContent = formatNumber(identityTotalRecap) + ' VIWO';
            document.getElementById('rfIdentityPercent').textContent = ((identityTotalRecap / monthlyEmissionNum) * 100).toFixed(2) + '%';

            // Content row - Shows revenue share, not emission!
            document.getElementById('rfContentEmission').innerHTML = `~40%<br><span style="font-size: 11px;">(Revenue)</span>`;
            document.getElementById('rfContentFees').textContent = formatNumber(contentBurn + contentTreasury) + ' VIWO';
            document.getElementById('rfContentBuyback').textContent = formatNumber(contentNFTRoyalties) + ' VIWO';
            document.getElementById('rfContentStaking').textContent = formatNumber(contentStaking) + ' VIWO';
            const contentTotalRecap = contentBurn + contentTreasury + contentNFTRoyalties + contentStaking;
            document.getElementById('rfContentTotal').textContent = formatNumber(contentTotalRecap) + ' VIWO';
            document.getElementById('rfContentPercent').textContent = ((contentTotalRecap / monthlyEmissionNum) * 100).toFixed(2) + '%';

            // Community row - Shows revenue share, not emission!
            document.getElementById('rfCommunityEmission').innerHTML = `~10%<br><span style="font-size: 11px;">(Revenue)</span>`;
            document.getElementById('rfCommunityFees').textContent = formatNumber(communityBurn + communityTreasury) + ' VIWO';
            document.getElementById('rfCommunityBuyback').textContent = '0 VIWO';
            document.getElementById('rfCommunityStaking').textContent = formatNumber(communityStaking) + ' VIWO';
            const communityTotalRecap = communityBurn + communityTreasury + communityStaking;
            document.getElementById('rfCommunityTotal').textContent = formatNumber(communityTotalRecap) + ' VIWO';
            document.getElementById('rfCommunityPercent').textContent = ((communityTotalRecap / monthlyEmissionNum) * 100).toFixed(2) + '%';

            // Advertising row - Shows revenue share, not emission!
            document.getElementById('rfAdvertisingEmission').innerHTML = `~15%<br><span style="font-size: 11px;">(Revenue)</span>`;
            document.getElementById('rfAdvertisingFees').textContent = formatNumber(advertisingBurn + advertisingTreasury) + ' VIWO';
            document.getElementById('rfAdvertisingBuyback').textContent = formatNumber(advertisingBuyback) + ' VIWO';
            document.getElementById('rfAdvertisingStaking').textContent = formatNumber(advertisingDeposits) + ' VIWO';
            const advertisingTotalRecap = advertisingBurn + advertisingTreasury + advertisingBuyback + advertisingDeposits;
            document.getElementById('rfAdvertisingTotal').textContent = formatNumber(advertisingTotalRecap) + ' VIWO';
            document.getElementById('rfAdvertisingPercent').textContent = ((advertisingTotalRecap / monthlyEmissionNum) * 100).toFixed(2) + '%';

            // Messaging row - Shows revenue share, not emission!
            document.getElementById('rfMessagingEmission').innerHTML = `~10%<br><span style="font-size: 11px;">(Revenue)</span>`;
            document.getElementById('rfMessagingFees').textContent = formatNumber(messagingBurn + messagingTreasury) + ' VIWO';
            document.getElementById('rfMessagingBuyback').textContent = '0 VIWO';
            document.getElementById('rfMessagingStaking').textContent = formatNumber(messagingStaking) + ' VIWO';
            const messagingTotalRecap = messagingBurn + messagingTreasury + messagingStaking;
            document.getElementById('rfMessagingTotal').textContent = formatNumber(messagingTotalRecap) + ' VIWO';
            document.getElementById('rfMessagingPercent').textContent = ((messagingTotalRecap / monthlyEmissionNum) * 100).toFixed(2) + '%';

            // Rewards Pool row - THIS IS THE ONLY MODULE THAT EMITS!
            document.getElementById('rfRewardsEmission').innerHTML = `${formatNumber(monthlyEmissionNum)} VIWO<br><span style="font-size: 11px;">(100% EMISSION!)</span>`;

            // Total row
            document.getElementById('rfTotalFees').textContent = formatNumber(burns + treasury) + ' VIWO';
            document.getElementById('rfTotalBuyback').textContent = formatNumber(buybacks) + ' VIWO';
            document.getElementById('rfTotalStaking').textContent = formatNumber(staking) + ' VIWO';
            document.getElementById('rfTotalRecaptured').textContent = formatNumber(totalRecaptured) + ' VIWO';
            document.getElementById('rfTotalPercent').textContent = recaptureRate + '%';

            // Update summary
            const netCirculation = monthlyEmissionNum - totalRecaptured;
            const circulationPct = ((netCirculation / monthlyEmissionNum) * 100).toFixed(1);
            const rfSummary = `<strong>Circular Economy Impact:</strong> Of the ${formatNumber(monthlyEmissionNum)} VIWO distributed monthly, ${formatNumber(totalRecaptured)} (${recaptureRate}%) is recaptured through:
                <ul style="margin-top: 8px;">
                    <li><strong>Transaction Fees (Burn + Treasury):</strong> ${formatNumber(burns + treasury)} VIWO (${((burns + treasury) / monthlyEmissionNum * 100).toFixed(1)}%) - Creates deflationary pressure</li>
                    <li><strong>Buybacks & Royalties:</strong> ${formatNumber(buybacks)} VIWO (${(buybacks / monthlyEmissionNum * 100).toFixed(1)}%) - Protocol uses USD profits to buy VIWO from market and NFT commissions</li>
                    <li><strong>Staking & Deposits:</strong> ${formatNumber(staking)} VIWO (${(staking / monthlyEmissionNum * 100).toFixed(1)}%) - Users lock tokens for premium features and campaign deposits</li>
                </ul>
                The remaining ${formatNumber(netCirculation)} VIWO (${circulationPct}%) stays in circulation, rewarding users and driving ecosystem growth. This creates a sustainable balance between emission and recapture.`;
            document.getElementById('rfCircularEconomySummary').innerHTML = rfSummary;

            // Update Summary section
            document.getElementById('summaryRevenue').textContent = '$' + formatNumber(totalRevenue);
            document.getElementById('summaryProfit').textContent = '$' + formatNumber(totalProfit);
            document.getElementById('summaryMargin').textContent = overviewMargin + '%';
            document.getElementById('summaryRecapture').textContent = recaptureRate + '%';
            document.getElementById('summaryEmissions').textContent = formatNumber(monthlyEmissionNum) + ' VIWO';

            const summaryMission = `<strong>Mission 100% Accomplished:</strong>
                <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                    <li> All 5 modules (Identity, Content, Community, Advertising, Messaging) implemented with real-time calculations</li>
                    <li> Starting with ${params.startingUsers} users, all modules are PROFITABLE from Day 1</li>
                    <li> Month 1: $${formatNumber(totalRevenue)} revenue, $${formatNumber(totalCosts)} costs = $${formatNumber(totalProfit)} profit (${overviewMargin}% margin)</li>
                    <li> Rewards emission: Fixed ${formatNumber(monthlyEmissionNum)} VIWO/month (${formatNumber(monthlyEmissionNum/30)} VIWO/day) prevents inflation</li>
                    <li> Reward recapture: ${recaptureRate}% returns through fees (${formatNumber(burns + treasury)} VIWO), buybacks (${formatNumber(buybacks)} VIWO), and staking (${formatNumber(staking)} VIWO)</li>
                    <li> Complete transparency: Every VIWO tracked from emission to recapture across all modules</li>
                    <li> Sustainable circular economy with multiple value capture mechanisms (burns, staking, buybacks, royalties)</li>
                </ul>`;
            document.getElementById('summaryMissionAccomplished').innerHTML = summaryMission;

            // Return recapture data for velocity section
            return {
                totalRecaptured: totalRecaptured,
                recaptureRate: recaptureRate,
                burns: burns,
                treasury: treasury,
                staking: staking,
                buybacks: buybacks
            };
        }

        function updateModuleRow(module, data) {
            document.getElementById(module + 'Revenue').textContent = '$' + formatNumber(data.revenue);
            document.getElementById(module + 'Costs').textContent = '$' + formatNumber(data.costs);
            document.getElementById(module + 'Profit').textContent = '$' + formatNumber(data.profit);
            document.getElementById(module + 'Profit').style.color = data.profit >= 0 ? 'var(--success-color)' : 'var(--danger-color)';
            document.getElementById(module + 'Margin').textContent = data.margin + '%';
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            } else {
                return num.toFixed(0);
            }
        }

        // Export current parameters to JSON file
        function exportParameters() {
            const data = {
                exportDate: new Date().toISOString(),
                exportType: 'parameters',
                version: '1.0',
                parameters: params
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `viwo-parameters-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(' Parameters exported successfully!');
        }

        // Import parameters from JSON file
        function importParameters(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);

                    if (data.exportType !== 'parameters') {
                        alert(' Error: This is not a valid parameters file!');
                        return;
                    }

                    // Load all parameters
                    const loadedParams = data.parameters;

                    // Update all input fields
                    document.getElementById('tokenPrice').value = loadedParams.tokenPrice;
                    document.getElementById('startingUsers').value = loadedParams.startingUsers;
                    document.getElementById('growthRate').value = loadedParams.growthRate * 100;
                    document.getElementById('burnRate').value = loadedParams.burnRate * 100;
                    document.getElementById('verificationRate').value = loadedParams.verificationRate * 100;
                    document.getElementById('postsPerUser').value = loadedParams.postsPerUser;
                    document.getElementById('buybackPercent').value = loadedParams.buybackPercent * 100;
                    document.getElementById('adCPM').value = loadedParams.adCPM * 100;

                    // Identity Module
                    document.getElementById('basicPrice').value = loadedParams.basicPrice;
                    document.getElementById('verifiedPrice').value = loadedParams.verifiedPrice;
                    document.getElementById('premiumPrice').value = loadedParams.premiumPrice;
                    document.getElementById('enterprisePrice').value = loadedParams.enterprisePrice;
                    document.getElementById('transferFee').value = loadedParams.transferFee;
                    document.getElementById('saleCommission').value = loadedParams.saleCommission * 100;
                    document.getElementById('monthlySales').value = loadedParams.monthlySales;

                    // Content Module
                    document.getElementById('textPostFee').value = loadedParams.textPostFee;
                    document.getElementById('imagePostFee').value = loadedParams.imagePostFee;
                    document.getElementById('videoPostFee').value = loadedParams.videoPostFee;
                    document.getElementById('nftMintFee').value = loadedParams.nftMintFee;
                    document.getElementById('premiumContentSub').value = loadedParams.premiumContentSub;
                    document.getElementById('contentBoostFee').value = loadedParams.contentBoostFee;
                    document.getElementById('contentSaleCommission').value = loadedParams.contentSaleCommission * 100;

                    // Community Module
                    document.getElementById('smallCommunityFee').value = loadedParams.smallCommunityFee;
                    document.getElementById('mediumCommunityFee').value = loadedParams.mediumCommunityFee;
                    document.getElementById('largeCommunityFee').value = loadedParams.largeCommunityFee;
                    document.getElementById('enterpriseCommunityFee').value = loadedParams.enterpriseCommunityFee;
                    document.getElementById('eventHostingFee').value = loadedParams.eventHostingFee;
                    document.getElementById('communityVerificationFee').value = loadedParams.communityVerificationFee;
                    document.getElementById('communityAnalyticsFee').value = loadedParams.communityAnalyticsFee;

                    // Advertising Module
                    document.getElementById('bannerCPM').value = loadedParams.bannerCPM;
                    document.getElementById('videoCPM').value = loadedParams.videoCPM;
                    document.getElementById('promotedPostFee').value = loadedParams.promotedPostFee;
                    document.getElementById('campaignManagementFee').value = loadedParams.campaignManagementFee;
                    document.getElementById('adAnalyticsFee').value = loadedParams.adAnalyticsFee;

                    // Messaging Module
                    document.getElementById('encryptedDMFee').value = loadedParams.encryptedDMFee;
                    document.getElementById('groupChatFee').value = loadedParams.groupChatFee;
                    document.getElementById('fileTransferFee').value = loadedParams.fileTransferFee;
                    document.getElementById('voiceCallFee').value = loadedParams.voiceCallFee;
                    document.getElementById('messageStorageFee').value = loadedParams.messageStorageFee;
                    document.getElementById('messagingPremiumFee').value = loadedParams.messagingPremiumFee;

                    // Reward Allocation
                    if (loadedParams.rewardAllocationPercent !== undefined) {
                        document.getElementById('rewardAllocationPercent').value = loadedParams.rewardAllocationPercent * 100;
                    }

                    // Reward Distribution Parameters
                    if (loadedParams.textPostPoints !== undefined) {
                        document.getElementById('textPostPoints').value = loadedParams.textPostPoints;
                        document.getElementById('imagePostPoints').value = loadedParams.imagePostPoints;
                        document.getElementById('videoPostPoints').value = loadedParams.videoPostPoints;
                        document.getElementById('likePoints').value = loadedParams.likePoints;
                        document.getElementById('commentPoints').value = loadedParams.commentPoints;
                        document.getElementById('sharePoints').value = loadedParams.sharePoints;
                        document.getElementById('followPoints').value = loadedParams.followPoints;
                        document.getElementById('maxPostsPerDay').value = loadedParams.maxPostsPerDay;
                        document.getElementById('maxLikesPerDay').value = loadedParams.maxLikesPerDay;
                        document.getElementById('maxCommentsPerDay').value = loadedParams.maxCommentsPerDay;
                        document.getElementById('highQualityMultiplier').value = loadedParams.highQualityMultiplier;
                        document.getElementById('verifiedMultiplier').value = loadedParams.verifiedMultiplier;
                        document.getElementById('premiumMultiplier').value = loadedParams.premiumMultiplier;
                        document.getElementById('day7Decay').value = loadedParams.day7Decay;
                        document.getElementById('day30Decay').value = loadedParams.day30Decay;
                        if (loadedParams.maxDailyRewardUSD !== undefined) {
                            document.getElementById('maxDailyRewardUSD').value = loadedParams.maxDailyRewardUSD;
                        }
                    }

                    // Update slider displays
                    updateSliderValue('growthRate');
                    updateSliderValue('burnRate');
                    updateSliderValue('verificationRate');
                    updateSliderValue('buybackPercent');
                    updateSliderValue('adCPM');
                    updateSliderValue('saleCommission');
                    updateSliderValue('contentSaleCommission');
                    updateSliderValue('rewardAllocationPercent');

                    // Recalculate everything
                    recalculateAll();

                    alert(' Parameters imported successfully!');
                } catch (error) {
                    alert(' Error importing file: ' + error.message);
                }
            };
            reader.readAsText(file);

            // Reset file input
            event.target.value = '';
        }

        // Export full report with all calculated data
        function exportFullReport() {
            // Recalculate to ensure we have latest data with adaptive metrics
            const identity = calculateIdentity();
            const content = calculateContent();
            const advertising = calculateAdvertising();
            const community = calculateCommunity();
            const messaging = calculateMessaging();

            // Calculate initial recapture to get adaptive values
            let rewards = calculateRewards(0);
            let totalRevenue = identity.revenue + content.revenue + advertising.revenue + community.revenue + messaging.revenue;
            let totalCosts = identity.costs + content.costs + advertising.costs + community.costs + messaging.costs + rewards.opCosts;
            let totalProfit = totalRevenue - totalCosts;

            let recaptureData = calculateRecapture(identity, content, advertising, community, messaging, totalProfit, rewards);

            // Recalculate with adaptive values
            currentGlobalRecaptureRate = parseFloat(recaptureData.recaptureRate);
            rewards = calculateRewards(currentGlobalRecaptureRate);

            totalRevenue = identity.revenue + content.revenue + advertising.revenue + community.revenue + messaging.revenue;
            totalCosts = identity.costs + content.costs + advertising.costs + community.costs + messaging.costs + rewards.opCosts;
            totalProfit = totalRevenue - totalCosts;
            const totalMargin = totalRevenue > 0 ? ((totalProfit / totalRevenue) * 100).toFixed(1) : 0;

            const monthlyEmission = CONFIG.MONTHLY_EMISSION;

            // Final recapture calculation with adaptive values
            recaptureData = calculateRecapture(identity, content, advertising, community, messaging, totalProfit, rewards);

            // Extract recapture components (already capped and safe)
            const totalBurns = Math.round(recaptureData.burns);
            const totalTreasury = Math.round(recaptureData.treasury);
            const totalStaking = Math.round(recaptureData.staking);
            const totalBuybacks = Math.round(recaptureData.buybacks);
            const totalRecaptured = Math.round(recaptureData.totalRecaptured);
            const recaptureRate = recaptureData.recaptureRate;

            // For module-level breakdown, estimate proportional distribution
            // (This is approximate but ensures consistency with runtime calculations)
            const identityAllocation = CONFIG.MODULE_REVENUE_SHARE.IDENTITY;
            const contentAllocation = CONFIG.MODULE_REVENUE_SHARE.CONTENT;
            const communityAllocation = CONFIG.MODULE_REVENUE_SHARE.COMMUNITY;
            const advertisingAllocation = CONFIG.MODULE_REVENUE_SHARE.ADVERTISING;
            const messagingAllocation = CONFIG.MODULE_REVENUE_SHARE.MESSAGING;

            // Distribute recapture proportionally across modules
            const identityBurn = Math.round(totalBurns * identityAllocation);
            const identityTreasury = Math.round(totalTreasury * identityAllocation);
            const identityStaking = Math.round(totalStaking * identityAllocation);

            const contentBurn = Math.round(totalBurns * contentAllocation);
            const contentTreasury = Math.round(totalTreasury * contentAllocation);
            const contentStaking = Math.round(totalStaking * contentAllocation);
            const contentNFTRoyalties = Math.round(totalBuybacks * 0.01); // Small portion for royalties

            const communityBurn = Math.round(totalBurns * communityAllocation);
            const communityTreasury = Math.round(totalTreasury * communityAllocation);
            const communityStaking = Math.round(totalStaking * communityAllocation);

            const advertisingBurn = Math.round(totalBurns * advertisingAllocation);
            const advertisingTreasury = Math.round(totalTreasury * advertisingAllocation);
            const advertisingDeposits = Math.round(totalStaking * advertisingAllocation);
            const advertisingBuyback = Math.round(totalBuybacks * 0.99); // Most buybacks from advertising

            const messagingBurn = Math.round(totalBurns * messagingAllocation);
            const messagingTreasury = Math.round(totalTreasury * messagingAllocation);
            const messagingStaking = Math.round(totalStaking * messagingAllocation);

            const netEmission = Math.max(0, monthlyEmission - totalRecaptured);

            // Build comprehensive report
            const report = {
                exportDate: new Date().toISOString(),
                exportType: 'full-report',
                version: '1.0',

                parameters: params,

                overview: {
                    users: params.startingUsers,
                    tokenPrice: params.tokenPrice,
                    totalRevenue: totalRevenue,
                    totalCosts: totalCosts,
                    totalProfit: totalProfit,
                    profitMargin: parseFloat(totalMargin),
                    monthlyEmissions: monthlyEmission,
                    recaptureRate: parseFloat(recaptureRate),
                    netEmissions: netEmission
                },

                adaptive: {
                    description: 'Adaptive emission and burn system responds to platform activity and recapture performance',
                    currentRecaptureRate: currentGlobalRecaptureRate,
                    emission: {
                        maxMonthlyEmission: rewards.maxMonthlyEmission,
                        actualMonthlyEmission: rewards.monthlyEmission,
                        allocationPercent: rewards.allocationPercent,
                        maxDailyEmission: Math.round(rewards.maxMonthlyEmission / 30),
                        actualDailyEmission: rewards.dailyEmission
                    },
                    burn: {
                        userSetBurnRate: params.burnRate,
                        adaptiveBurnRate: calculateAdaptiveBurnRate(currentGlobalRecaptureRate, params.burnRate),
                        increasePercent: ((calculateAdaptiveBurnRate(currentGlobalRecaptureRate, params.burnRate) - params.burnRate) / params.burnRate * 100).toFixed(1)
                    },
                    buyback: {
                        userSetBuybackPercent: params.buybackPercent,
                        adaptiveBuybackPercent: calculateAdaptiveBuyback(currentGlobalRecaptureRate, params.buybackPercent),
                        increasePercent: ((calculateAdaptiveBuyback(currentGlobalRecaptureRate, params.buybackPercent) - params.buybackPercent) / params.buybackPercent * 100).toFixed(1)
                    }
                },

                modules: {
                    identity: {
                        ...identity,
                        note: 'Identity module does NOT emit tokens. Users spend reward tokens here.',
                        revenueShare: '~5%',
                        recapture: {
                            burns: identityBurn,
                            treasury: identityTreasury,
                            staking: identityStaking,
                            total: identityBurn + identityTreasury + identityStaking,
                            percentOfTotalEmission: (((identityBurn + identityTreasury + identityStaking) / monthlyEmission) * 100).toFixed(2)
                        }
                    },
                    content: {
                        ...content,
                        note: 'Content module does NOT emit tokens. Users spend reward tokens here.',
                        revenueShare: '~40%',
                        recapture: {
                            burns: contentBurn,
                            treasury: contentTreasury,
                            staking: contentStaking,
                            royalties: contentNFTRoyalties,
                            total: contentBurn + contentTreasury + contentStaking + contentNFTRoyalties,
                            percentOfTotalEmission: (((contentBurn + contentTreasury + contentStaking + contentNFTRoyalties) / monthlyEmission) * 100).toFixed(2)
                        }
                    },
                    community: {
                        ...community,
                        note: 'Community module does NOT emit tokens. Users spend reward tokens here.',
                        revenueShare: '~10%',
                        recapture: {
                            burns: communityBurn,
                            treasury: communityTreasury,
                            staking: communityStaking,
                            total: communityBurn + communityTreasury + communityStaking,
                            percentOfTotalEmission: (((communityBurn + communityTreasury + communityStaking) / monthlyEmission) * 100).toFixed(2)
                        }
                    },
                    advertising: {
                        ...advertising,
                        note: 'Advertising module does NOT emit tokens. Users spend reward tokens here.',
                        revenueShare: '~15%',
                        recapture: {
                            burns: advertisingBurn,
                            treasury: advertisingTreasury,
                            deposits: advertisingDeposits,
                            buybacks: advertisingBuyback,
                            total: advertisingBurn + advertisingTreasury + advertisingDeposits + advertisingBuyback,
                            percentOfTotalEmission: (((advertisingBurn + advertisingTreasury + advertisingDeposits + advertisingBuyback) / monthlyEmission) * 100).toFixed(2)
                        }
                    },
                    messaging: {
                        ...messaging,
                        note: 'Messaging module does NOT emit tokens. Users spend reward tokens here.',
                        revenueShare: '~10%',
                        recapture: {
                            burns: messagingBurn,
                            treasury: messagingTreasury,
                            staking: messagingStaking,
                            total: messagingBurn + messagingTreasury + messagingStaking,
                            percentOfTotalEmission: (((messagingBurn + messagingTreasury + messagingStaking) / monthlyEmission) * 100).toFixed(2)
                        }
                    },
                    rewards: {
                        note: 'ONLY Rewards module emits tokens! All 5.83M monthly emission comes from here.',
                        allocation: rewards.allocationPercent + '%',
                        monthlyEmission: monthlyEmission,  // All emission comes from rewards!
                        monthlyRewardPool: rewards.monthlyRewardPool,
                        dailyEmission: rewards.dailyEmission,
                        dailyPool: rewards.dailyRewardPool,
                        dailyPoolUSD: rewards.dailyRewardPoolUSD,
                        opCosts: rewards.opCosts,
                        emissionUSD: rewards.emissionUSD,
                        distributionParams: {
                            allocationPercent: params.rewardAllocationPercent,
                            activityPoints: {
                                textPost: params.textPostPoints,
                                imagePost: params.imagePostPoints,
                                videoPost: params.videoPostPoints,
                                like: params.likePoints,
                                comment: params.commentPoints,
                                share: params.sharePoints,
                                follow: params.followPoints
                            },
                            antiBotLimits: {
                                maxPostsPerDay: params.maxPostsPerDay,
                                maxLikesPerDay: params.maxLikesPerDay,
                                maxCommentsPerDay: params.maxCommentsPerDay
                            },
                            qualityMultipliers: {
                                highQuality: params.highQualityMultiplier,
                                verified: params.verifiedMultiplier,
                                premium: params.premiumMultiplier
                            },
                            timeDecay: {
                                day7: params.day7Decay + '%',
                                day30: params.day30Decay + '%'
                            },
                            maxDailyRewardUSD: params.maxDailyRewardUSD
                        }
                    }
                },

                rewardFlow: {
                    monthlyEmission: monthlyEmission,
                    dailyEmission: Math.round(monthlyEmission / 30),
                    recapture: {
                        burns: totalBurns,
                        treasury: totalTreasury,
                        staking: totalStaking,
                        buybacks: totalBuybacks,
                        total: totalRecaptured,
                        rate: parseFloat(recaptureRate)
                    },
                    distribution: {
                        burnsPercent: ((totalBurns / monthlyEmission) * 100).toFixed(2),
                        treasuryPercent: ((totalTreasury / monthlyEmission) * 100).toFixed(2),
                        stakingPercent: ((totalStaking / monthlyEmission) * 100).toFixed(2),
                        buybacksPercent: ((totalBuybacks / monthlyEmission) * 100).toFixed(2),
                        netCirculationPercent: ((netEmission / monthlyEmission) * 100).toFixed(2)
                    }
                },

                liquidity: {
                    tgeLiquidityTokens: CONFIG.SUPPLY.LIQUIDITY,
                    tgeLiquidityUSD: CONFIG.SUPPLY.LIQUIDITY * params.tokenPrice,
                    totalSupply: CONFIG.SUPPLY.TOTAL,
                    marketCap: CONFIG.SUPPLY.TOTAL * params.tokenPrice,
                    liquidityRatio: (((CONFIG.SUPPLY.LIQUIDITY * params.tokenPrice) / (CONFIG.SUPPLY.TOTAL * params.tokenPrice)) * 100).toFixed(1),
                    slippage: {
                        trade10k: ((10000 / (CONFIG.SUPPLY.LIQUIDITY * params.tokenPrice)) * 100).toFixed(1),
                        trade50k: ((50000 / (CONFIG.SUPPLY.LIQUIDITY * params.tokenPrice)) * 100).toFixed(1)
                    },
                    adtvTargets: {
                        // ADTV scales with user growth (assume ~$10 per active user per month)
                        month1: Math.round(params.startingUsers * 10),
                        month12: Math.round((params.startingUsers * Math.pow(1 + params.growthRate, 12)) * 10),
                        month60: Math.round((params.startingUsers * Math.pow(1 + (params.growthRate * 0.7), 60)) * 10)
                    },
                    healthIndicators: {
                        liquidityDepthStatus: 'Healthy',
                        marketCapStatus: 'Good',
                        liquidityRatioStatus: 'Excellent',
                        slippage10kStatus: 'Low',
                        slippage50kStatus: 'Acceptable'
                    }
                },

                velocity: {
                    period: '60 months',
                    totalEmissions: monthlyEmission * 60,
                    totalRecaptured: totalRecaptured * 60,
                    averageRecaptureRate: parseFloat(recaptureRate),
                    netCirculationAdded: (monthlyEmission - totalRecaptured) * 60,
                    projectedSupply: {
                        tge: CONFIG.SUPPLY.TGE_CIRCULATING,
                        month60: CONFIG.SUPPLY.TGE_CIRCULATING + ((monthlyEmission - totalRecaptured) * 60)
                    },
                    // Calculate dynamic velocity
                    averageVelocity: (() => {
                        const tgeSupply = CONFIG.SUPPLY.TGE_CIRCULATING;
                        const month60Supply = tgeSupply + ((monthlyEmission - totalRecaptured) * 60);
                        const avgCirculatingSupply = (tgeSupply + month60Supply) / 2;
                        const recapturePercent = parseFloat(recaptureRate);
                        const month60Users = Math.round(params.startingUsers * Math.pow(1 + (params.growthRate * 0.7), 60));

                        // Activity multiplier based on recapture rate
                        let activityMultiplier;
                        if (recapturePercent < 10) {
                            activityMultiplier = 2 + (recapturePercent / 10) * 2;
                        } else if (recapturePercent < 30) {
                            activityMultiplier = 4 + ((recapturePercent - 10) / 20) * 6;
                        } else {
                            activityMultiplier = 10 + ((recapturePercent - 30) / 70) * 10;
                        }

                        // User growth bonus
                        const userGrowthFactor = Math.min(month60Users / params.startingUsers, 50);
                        const growthBonus = 1 + Math.log10(userGrowthFactor) * 0.5;
                        const finalMultiplier = activityMultiplier * growthBonus;

                        const monthlyTxVolume = monthlyEmission * finalMultiplier;
                        const monthlyVelocity = monthlyTxVolume / avgCirculatingSupply;
                        const annualVelocity = monthlyVelocity * 12;  // Convert to annual
                        return parseFloat(annualVelocity.toFixed(1));
                    })(),
                    velocityStatus: (() => {
                        const tgeSupply = CONFIG.SUPPLY.TGE_CIRCULATING;
                        const month60Supply = tgeSupply + ((monthlyEmission - totalRecaptured) * 60);
                        const avgCirculatingSupply = (tgeSupply + month60Supply) / 2;
                        const recapturePercent = parseFloat(recaptureRate);
                        const month60Users = Math.round(params.startingUsers * Math.pow(1 + (params.growthRate * 0.7), 60));

                        let activityMultiplier;
                        if (recapturePercent < 10) {
                            activityMultiplier = 2 + (recapturePercent / 10) * 2;
                        } else if (recapturePercent < 30) {
                            activityMultiplier = 4 + ((recapturePercent - 10) / 20) * 6;
                        } else {
                            activityMultiplier = 10 + ((recapturePercent - 30) / 70) * 10;
                        }

                        const userGrowthFactor = Math.min(month60Users / params.startingUsers, 50);
                        const growthBonus = 1 + Math.log10(userGrowthFactor) * 0.5;
                        const finalMultiplier = activityMultiplier * growthBonus;
                        const monthlyTxVolume = monthlyEmission * finalMultiplier;
                        const monthlyVelocity = monthlyTxVolume / avgCirculatingSupply;
                        const annualVelocity = monthlyVelocity * 12;  // Convert to annual

                        if (annualVelocity < 2) return 'Low';
                        if (annualVelocity <= 10) return 'Healthy';
                        if (annualVelocity <= 50) return 'High';
                        return 'Excessive';
                    })(),
                    userGrowth: {
                        month1: params.startingUsers,
                        month12: Math.round(params.startingUsers * Math.pow(1 + params.growthRate, 12)),
                        month60: Math.round(params.startingUsers * Math.pow(1 + (params.growthRate * 0.7), 60))
                    }
                },

                summary: {
                    profitableModules: 5,
                    totalMonthlyRevenue: totalRevenue,
                    totalMonthlyCosts: totalCosts,
                    totalMonthlyProfit: totalProfit,
                    profitMargin: parseFloat(totalMargin),
                    emissionsValue: monthlyEmission * params.tokenPrice,
                    recaptureValue: totalRecaptured * params.tokenPrice,
                    sustainability: {
                        recaptureRate: parseFloat(recaptureRate),
                        netInflation: netEmission,
                        status: parseFloat(recaptureRate) < 10 ? 'Low' : parseFloat(recaptureRate) < 20 ? 'Moderate' : parseFloat(recaptureRate) < 40 ? 'High' : 'Excellent'
                    },
                    projections: {
                        month1: {
                            users: params.startingUsers,
                            revenue: totalRevenue,
                            costs: totalCosts,
                            profit: totalProfit,
                            margin: parseFloat(totalMargin),
                            recaptured: totalRecaptured,
                            recaptureRate: parseFloat(recaptureRate)
                        },
                        month12: {
                            users: Math.round(params.startingUsers * Math.pow(1 + params.growthRate, 12)),
                            revenue: totalRevenue * CONFIG.PROJECTIONS.MONTH_12.REVENUE,
                            costs: totalCosts * CONFIG.PROJECTIONS.MONTH_12.COSTS,
                            profit: (totalRevenue * CONFIG.PROJECTIONS.MONTH_12.REVENUE) - (totalCosts * CONFIG.PROJECTIONS.MONTH_12.COSTS),
                            margin: parseFloat((((totalRevenue * CONFIG.PROJECTIONS.MONTH_12.REVENUE) - (totalCosts * CONFIG.PROJECTIONS.MONTH_12.COSTS)) / (totalRevenue * CONFIG.PROJECTIONS.MONTH_12.REVENUE) * 100).toFixed(1)),
                            recaptured: totalRecaptured * CONFIG.PROJECTIONS.MONTH_12.RECAPTURE,
                            recaptureRate: parseFloat(((totalRecaptured * CONFIG.PROJECTIONS.MONTH_12.RECAPTURE / monthlyEmission) * 100).toFixed(1))
                        },
                        month60: {
                            users: Math.round(params.startingUsers * Math.pow(1 + (params.growthRate * 0.7), 60)),
                            revenue: totalRevenue * CONFIG.PROJECTIONS.MONTH_60.REVENUE,
                            costs: totalCosts * CONFIG.PROJECTIONS.MONTH_60.COSTS,
                            profit: (totalRevenue * CONFIG.PROJECTIONS.MONTH_60.REVENUE) - (totalCosts * CONFIG.PROJECTIONS.MONTH_60.COSTS),
                            margin: parseFloat((((totalRevenue * CONFIG.PROJECTIONS.MONTH_60.REVENUE) - (totalCosts * CONFIG.PROJECTIONS.MONTH_60.COSTS)) / (totalRevenue * CONFIG.PROJECTIONS.MONTH_60.REVENUE) * 100).toFixed(1)),
                            recaptured: totalRecaptured * CONFIG.PROJECTIONS.MONTH_60.RECAPTURE,
                            recaptureRate: parseFloat(((totalRecaptured * CONFIG.PROJECTIONS.MONTH_60.RECAPTURE / monthlyEmission) * 100).toFixed(1))
                        }
                    }
                }
            };

            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `viwo-full-report-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(' Full report exported successfully!');
        }

        // Scroll-based navbar highlighting
        function updateActiveNavOnScroll() {
            const sections = [
                'overview',
                'module-identity',
                'module-content',
                'module-community',
                'module-advertising',
                'module-messaging',
                'module-rewards',
                'reward-flow',
                'liquidity',
                'velocity',
                'system-summary'
            ];

            const navLinks = document.querySelectorAll('.module-nav-link');

            // Find which section is currently most visible in viewport
            let currentSection = null;
            let maxVisibleHeight = 0;

            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (!section) return;

                const rect = section.getBoundingClientRect();
                const viewportHeight = window.innerHeight;

                // Calculate how much of the section is visible
                const visibleTop = Math.max(0, Math.min(rect.bottom, viewportHeight) - Math.max(rect.top, 0));

                // Prioritize sections in the upper half of viewport
                const distanceFromTop = Math.abs(rect.top);
                const score = visibleTop - (distanceFromTop * 0.3);

                if (score > maxVisibleHeight && rect.top < viewportHeight * 0.5) {
                    maxVisibleHeight = score;
                    currentSection = sectionId;
                }
            });

            // Update active class
            if (currentSection) {
                navLinks.forEach(link => {
                    const href = link.getAttribute('href').substring(1); // Remove '#'
                    if (href === currentSection) {
                        link.classList.add('active');
                    } else {
                        link.classList.remove('active');
                    }
                });
            }
        }

        // Throttle scroll event for performance
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            if (scrollTimeout) {
                window.cancelAnimationFrame(scrollTimeout);
            }
            scrollTimeout = window.requestAnimationFrame(() => {
                updateActiveNavOnScroll();
            });
        });

        // Also update on page load
        window.addEventListener('load', updateActiveNavOnScroll);
    </script>
</body>
</html>